let e="oqoa";class t{constructor(e){this.storeName=e}openDB(){return new Promise((t,r)=>{let a=indexedDB.open(e,1);a.onupgradeneeded=e=>{this.initStore(e)},a.onsuccess=e=>{t(e.target.result)},a.onerror=e=>{r(e.target.error)}})}async insert(e){let t=await this.openDB();return new Promise((r,a)=>{let n=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).add(e);n.onsuccess=()=>r(n.result),n.onerror=()=>a(n.error)})}async update(e){let t=await this.openDB();return new Promise((r,a)=>{let n=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(e);n.onsuccess=()=>r(n.result),n.onerror=()=>a(n.error)})}async deleteById(e){let t=await this.openDB();return new Promise((r,a)=>{let n=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);n.onsuccess=()=>r(n.result),n.onerror=()=>a(n.error)})}async selectById(e){let t=await this.openDB();return new Promise((r,a)=>{let n=t.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);n.onsuccess=e=>{let t=e.target.result;void 0!==t?r(this.convertRow(t)):a(Error("No data found"))},n.onerror=()=>a(n.error)})}async selectAll(){let e=await this.openDB();return new Promise((t,r)=>{let a=e.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();a.onsuccess=e=>{t(e.target.result.map(e=>this.convertRow(e)))},a.onerror=()=>r(a.error)})}async selectExample(e,t){let r=await this.openDB();return new Promise((a,n)=>{let s=r.transaction([this.storeName],"readonly").objectStore(this.storeName).index(e).getAll(t);s.onsuccess=e=>{a(e.target.result.map(e=>this.convertRow(e)))},s.onerror=()=>n(s.error)})}}class r{constructor(e,t,r,a,n,s){e&&(this.id=e),this.practiceHistoryId=t,this.questionId=r,this.isCorrect=a,this.selectChoice=n,this.answerDate=s}static fromRow(e){return new r(e.id,e.practice_history_id,e.question_id,e.is_correct,e.select_choice,e.answer_date)}static fromRequiredArgs(e,t,a,n,s){return new r(void 0,e,t,a,n,s)}setId(e){this.id=e}setPracticeHistoryId(e){this.practiceHistoryId=e}setQuestionId(e){this.questionId=e}setIsCorrect(e){this.isCorrect=e}setSelectChoice(e){this.selectChoice=e}setAnswerDate(e){this.answerDate=e}getId(){return this.id}getPracticeHistoryId(){return this.practiceHistoryId}getQuestionId(){return this.questionId}getIsCorrect(){return this.isCorrect}getSelectChoice(){return this.selectChoice}getAnswerDate(){return this.answerDate}generateRow(){let e={practice_history_id:this.practiceHistoryId,question_id:this.questionId,is_correct:this.isCorrect,select_choice:this.selectChoice,answer_date:this.answerDate};return void 0!==this.id&&(e.id=this.id),e}}let a=new class extends t{constructor(){super("ans_history")}initStore(e){let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});e.createIndex("practice_history_id","practice_history_id",{unique:!1}),e.createIndex("question_id","question_id",{unique:!1}),e.createIndex("is_current","is_current",{unique:!1}),e.createIndex("select_choice","select_choice",{unique:!1,multiEntry:!0}),e.createIndex("answer_date","answer_date",{unique:!1})}}convertRow(e){return r.fromRow(e)}async selectByPracticeHistoryId(e){return await this.selectExample("practice_history_id",e)}async selectByQuestionId(e){return await this.selectExample("question_id",e)}async selectAllOrderDesc(){return(await this.selectAll()).sort((e,t)=>t.getId()-e.getId())}async hasAnsHistory(e,t){return(await this.selectExample("practice_history_id",e)).some(e=>e.getQuestionId()===t)}async hasCorrectAnsHistory(e,t){return(await this.selectExample("practice_history_id",e)).some(e=>e.getIsCorrect()&&e.getQuestionId()===t)}async deleteByPracticeHistoryId(e){for(let t of(await this.selectExample("practice_history_id",e)))await this.deleteById(t.getId())}};class n{constructor(e,t,r){e&&(this.id=e),this.questionId=t,this.tagId=r}static fromRow(e){return new n(e.id,e.question_id,e.tag_id)}static fromRequiredArgs(e,t){return new n(void 0,e,t)}generateRow(){let e={question_id:this.questionId,tag_id:this.tagId};return void 0!==this.id&&(e.id=this.id),e}setId(e){this.id=e}setQuestionId(e){this.questionId=e}setTagId(e){this.tagId=e}getId(){return this.id}getQuestionId(){return this.questionId}getTagId(){return this.tagId}}let s=new class extends t{constructor(){super("favorite")}initStore(e){let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});e.createIndex("question_id","question_id",{unique:!1}),e.createIndex("tag_id","tag_id",{unique:!1})}}convertRow(e){return n.fromRow(e)}async selectByQuestionId(e){return await this.selectExample("question_id",e)}async selectByTagId(e){return await this.selectExample("tag_id",e)}};class i{constructor(e,t,r,a,n,s,i){e&&(this.id=e),this.qListId=t,this.isReview=r,this.isAnswered=a,this.isRandomQ=n,this.isRandomC=s,this.createAt=i}static fromRow(e){return new i(e.id,e.q_list_id,e.is_review,e.is_answered,e.is_random_q,e.is_random_c,e.create_at)}static fromRequiredArgs(e,t,r,a){return new i(void 0,e,t,!1,r,a,new Date().toISOString())}static fromCsvRow(e,t,r,a,n,s){return new i(void 0,e,t,r,a,n,s)}setId(e){this.id=e}setQListId(e){this.qListId=e}setIsAnswered(e){this.isAnswered=e}getId(){return this.id}getQListId(){return this.qListId}getIsReview(){return this.isReview}getIsAnswered(){return this.isAnswered}getIsRandomQ(){return this.isRandomQ}getIsRandomC(){return this.isRandomC}getCreateAt(){return this.createAt}generateRow(){let e={q_list_id:this.qListId,is_review:this.isReview,is_answered:this.isAnswered,is_random_q:this.isRandomQ,is_random_c:this.isRandomC,create_at:this.createAt};return void 0!==this.id&&(e.id=this.id),e}}let d=new class extends t{constructor(){super("practice_history")}initStore(e){let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});e.createIndex("q_list_id","q_list_id",{unique:!1}),e.createIndex("is_review","is_review",{unique:!1}),e.createIndex("is_answered","is_answered",{unique:!1}),e.createIndex("is_random_q","is_random_q",{unique:!1}),e.createIndex("is_random_c","is_random_c",{unique:!1}),e.createIndex("create_at","create_at",{unique:!1})}}convertRow(e){return i.fromRow(e)}async selectAllOrderDesc(){return(await this.selectAll()).sort((e,t)=>Date.parse(t.getCreateAt())-Date.parse(e.getCreateAt()))}async selectByQListId(e){return await this.selectExample("q_list_id",e)}async selectByQListIdAndCreateAt(e,t){let r=(await this.selectByQListId(e)).filter(e=>e.getCreateAt()===t);if(0!==r.length)return r[0]}};class l{constructor(e,t,r,a,n){e&&(this.id=e),this.uuid=t,this.name=r,this.questions=a,this.isDefault=n}static fromRow(e){return new l(e.id,e.uuid,e.name,e.questions,e.is_default)}static fromRequiredArgs(e,t,r,a){return new l(void 0,e,t,r,a)}static fromCreateNew(e,t,r){return new l(void 0,crypto.randomUUID(),e,t,r)}setId(e){this.id=e}setUuid(e){this.uuid=e}setName(e){this.name=e}setQuestions(e){this.questions=e}setIsDefault(e){this.isDefault=e}getId(){return this.id}getUuid(){return this.uuid}getName(){return this.name}getQuestions(){return this.questions}getIsDefault(){return this.isDefault}generateRow(){let e={uuid:this.uuid,name:this.name,questions:this.questions,is_default:this.isDefault};return void 0!==this.id&&(e.id=this.id),e}getIndexOfQuestionId(e){return this.questions?this.questions.indexOf(e):-1}}let o=new class extends t{constructor(){super("q_list")}initStore(e){let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});e.createIndex("uuid","uuid",{unique:!1}),e.createIndex("name","name",{unique:!1}),e.createIndex("questions","questions",{unique:!1,multiEntry:!0}),e.createIndex("is_default","is_default",{unique:!1})}}convertRow(e){return l.fromRow(e)}async bulkInsert(e){let t=new Set((await this.selectAll()).map(e=>e.getUuid())),r=0,a=0;for(let n of e){let e=n.getUuid();if(t.has(e)){a++;continue}await this.insert(n.generateRow()),t.add(e),r++}return console.log(`QListDB.bulkInsert: inserted=${r}, skipped=${a}`),{inserted:r,skipped:a}}async selectByStandard(){return(await this.selectAll()).filter(e=>e.getIsDefault())}async selectByUuid(e){let t=await this.selectExample("uuid",e);if(0!==t.length)return t[0]}async selectByNameAndQuestions(e,t){let r=(await this.selectExample("name",e)).filter(e=>{let r=e.getQuestions();return r.length===t.length&&r.every((e,r)=>e===t[r])});if(0!==r.length)return r[0]}};class c{constructor(e){this.setRow(e)}setRow(e){this.id=e.id,this.url=e.url,this.problem=e.problem,this.choice=e.choice,this.selectionFormat=e.selectionFormat,this.answer=e.answer,this.explanation=e.explanation}setId(e){this.id=e}setUrl(e){this.url=e}setProblem(e){this.problem=e}setChoice(e){this.choice=e}setSelectionFormat(e){this.selectionFormat=e}setAnswer(e){this.answer=e}setExplanation(e){this.explanation=e}getId(){return this.id}getUrl(){return this.url}getProblem(){return this.problem}getChoice(){return this.choice}getSelectionFormat(){return this.selectionFormat}getAnswer(){return this.answer}getExplanation(){return this.explanation}}let u=new class{async loadDataFromObjects(e){if(this.dataLoaded)throw Error("Question data has already been loaded");try{this.questions=e.flatMap(e=>e.questions.map(e=>new c(e))),this.dataLoaded=!0,console.log(`Loaded ${this.questions.length} questions from ${e.length} JSON files.`)}catch(e){throw console.error("Error loading questions:",e),e}}async bulkInsert(e){try{let t=new Set(this.questions.map(e=>e.getId())),r=0,a=0;for(let n of e){let e=n.getId();if(t.has(e)){a++;continue}this.questions.push(n),t.add(e),r++}this.questions.sort((e,t)=>e.getId()-t.getId()),console.log(`bulkInsert: inserted=${r}, skipped=${a}, total=${this.questions.length}`)}catch(e){throw console.error("Error in bulkInsert:",e),e}}selectAll(){return this.questions}selectById(e){return this.questions.find(t=>t.getId()===e)}selectByWord(e,t=!1){return this.questions.filter(r=>t?r.getId().toString().includes(e)||r.getProblem().includes(e)||r.getChoice().join().includes(e)||r.getExplanation().includes(e):r.getId().toString().includes(e.toLowerCase())||r.getProblem().toLowerCase().includes(e.toLowerCase())||r.getChoice().join().toLowerCase().includes(e.toLowerCase())||r.getExplanation().toLowerCase().includes(e.toLowerCase()))}constructor(){this.questions=[],this.dataLoaded=!1}};async function m(){try{await new Promise((t,r)=>{let n=indexedDB.open(e,1);n.onupgradeneeded=e=>{a.initStore(e),s.initStore(e),d.initStore(e),o.initStore(e)},n.onsuccess=async e=>{console.log("DB connected successfully");try{await u.loadDataFromObjects([]),console.log("Questions loaded successfully")}catch(e){console.error("Failed to load questions data:",e)}t()},n.onerror=e=>{console.error("DB connection error:",e.target.error),r(e.target.error)}}),console.log("Database initialized.")}catch(e){throw console.error("Database initialization failed:",e),e}}async function h(){return new Promise((t,r)=>{let a=indexedDB.deleteDatabase(e);a.onsuccess=()=>{console.log("Database deleted successfully."),t()},a.onerror=e=>{console.error("Error deleting database:",e),r(e)},a.onblocked=()=>{console.warn("Database deletion is blocked. Please close all other tabs using this site.")}})}function g(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}}function p(e){let t=new Date(e),r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),d=String(t.getSeconds()).padStart(2,"0");return`${r}/${a}/${n} ${s}:${i}:${d}`}function y(e){let t=new Date(e),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return`${r}/${a} ${n}:${s}`}function x(e){return e.replace(/<.*?>/g,"")}async function b(e){try{await navigator.clipboard.writeText(e)}catch(e){console.error("Clipboard copy failed:",e)}}let f=new class{get createAt(){return this.practiceHistory.getCreateAt()}get qListTitle(){return this.qList.getName()}get practiceHistoryId(){if(this.practiceHistory)return this.practiceHistory.getId()}get isRandomC(){return this.practiceHistory.getIsRandomC()}get currentQuestionDetail(){return this.questionDetails[this.currentIndex]}get currentQuestionNumber(){return this.currentIndex+1}get totalQuestion(){return this.questionDetails.length}get isAllQuestionsSolved(){return this.questionDetails.every(e=>void 0!==e.ansHistory)}get correctAnswerCount(){return this.questionDetails.filter(e=>e.ansHistory&&e.ansHistory.getIsCorrect()).length}get incorrectQuestions(){return this.questionDetails.filter(e=>e.ansHistory&&!e.ansHistory.getIsCorrect()).map(e=>e.question.getId())}async createAndStartPractice(e,t,r,a=!1){let n=i.fromRequiredArgs(e,a,t,r),s=await d.insert(n.generateRow());n.setId(s),this.practiceHistory=n,this.qList=await o.selectById(this.practiceHistory.getQListId());let l=this.qList.getQuestions().map(e=>u.selectById(e)).filter(e=>void 0!==e);this.practiceHistory.getIsRandomQ()&&g(l),this.questionDetails=l.map(e=>({question:e})),this.currentIndex=0}async startPractice(e){this.practiceHistory=await d.selectById(e),this.qList=await o.selectById(this.practiceHistory.getQListId());let t=await a.selectByPracticeHistoryId(this.practiceHistory.getId()),r=this.qList.getQuestions().map(e=>u.selectById(e)).filter(e=>void 0!==e).filter(e=>!t.some(t=>t.getQuestionId()===e.getId()));this.practiceHistory.getIsRandomQ()&&g(r);let n=t.map(e=>({question:u.selectById(e.getQuestionId()),ansHistory:e})),s=r.map(e=>({question:e}));this.questionDetails=n.concat(s),this.currentIndex=this.isAllQuestionsSolved?t.length-1:t.length}getNextQuestionDetail(){let e=this.currentIndex+1;return e>=this.questionDetails.length?null:(this.currentIndex=e,this.currentQuestionDetail)}getPrevQuestionDetail(){let e=this.currentIndex-1;return e<0?null:(this.currentIndex=e,this.currentQuestionDetail)}async entryAnsHistory(e,t){let n=this.questionDetails[this.currentIndex],s=r.fromRequiredArgs(this.practiceHistory.getId(),n.question.getId(),e,t,new Date().toISOString()),i=await a.insert(s.generateRow());return s.setId(i),n.ansHistory=s,this.questionDetails[this.currentIndex]=n,i}async cancelAnsHistory(e){0!==e&&this.currentQuestionDetail.ansHistory?.getId()===e&&(await a.deleteById(e),this.currentQuestionDetail.ansHistory=void 0)}generateQuestionResultDetails(){return this.questionDetails.filter(e=>e.ansHistory).map(e=>({question:e.question,ansHistory:e.ansHistory}))}async markAsAnswered(){this.practiceHistory.setIsAnswered(!0),await d.update(this.practiceHistory.generateRow())}},w=document.getElementById("practiceContainer"),C=document.getElementById("qListTitle"),E=document.getElementById("currentQuestionNumber"),v=document.getElementById("totalQuestions"),k=document.getElementById("practiceQuestionContainer"),I=document.getElementById("practciceResultContainer");var N,L,q,A,S=((N={}).DEFAULT="md",N.LG="lg",N.XL="xl",N.XXL="4xl",N.FULL="full",N);class D{constructor(e){this.isShown=!1,void 0!==e&&(this.modalElem=e)}initModal(e){this.modalElem||(this.modalElem=e)}setModal(e,t="md",r=!0,a=!0,n=!0){this.setModalContent(e),this.setModalFade(a),this.setModalSize(t),this.isShown&&this.hide(),r&&this.show(),n&&this.modalElem.addEventListener("click",this.handleOutsideClick.bind(this))}setModalContent(e){let t=this.generateDialogElem();t.appendChild(this.generateCloseBtn()),t.appendChild(e),this.modalElem.innerHTML="",this.modalElem.appendChild(t)}setModalSize(e){let t=this.modalElem.firstElementChild;if(t)switch(t.classList.forEach(e=>{(e.startsWith("max-w-")||"w-full"===e)&&t.classList.remove(e)}),e){case"lg":t.classList.add("w-full","max-w-lg");break;case"xl":t.classList.add("w-full","max-w-xl");break;case"4xl":t.classList.add("w-full","max-w-4xl");break;case"full":t.classList.add("w-full")}}setModalFade(e){e?this.modalElem?.classList.add("transition-opacity","duration-300"):this.modalElem?.classList.remove("transition-opacity","duration-300")}show(){this.modalElem.classList.remove("hidden"),setTimeout(()=>{this.modalElem.classList.remove("opacity-0"),this.modalElem.classList.add("opacity-100")},10),this.isShown=!0}hide(){this.modalElem.classList.remove("opacity-100"),this.modalElem.classList.add("opacity-0"),setTimeout(()=>{this.modalElem.classList.add("hidden")},300),this.isShown=!1}handleOutsideClick(e){e.target===this.modalElem&&this.hide()}generateDialogElem(){let e=document.createElement("div");return e.className="relative bg-white dark:bg-gray-800 p-6 rounded shadow-lg max-h-[90vh] overflow-y-auto",e}generateCloseBtn(){let e=document.createElement("div");e.className="flex justify-end mb-2";let t=document.createElement("button");return t.className="w-8 h-8 rounded-[1vw] border border-gray-400 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-700 flex items-center justify-center transition-colors",t.innerText="✕",t.addEventListener("click",()=>{this.hide()}),e.appendChild(t),e}}let Q=(e,t,r)=>{let a=document.createElement("div");if(a.className="text-center p-6","string"==typeof e){let t=document.createElement("p");t.className="mb-6 text-sm sm:text-base",t.textContent=e,a.appendChild(t)}else e.classList.add("mb-6"),a.appendChild(e);let n=document.createElement("div");n.className="flex justify-center gap-4";let s=document.createElement("button");if(s.type="button",s.textContent="OK",s.className="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors",s.addEventListener("click",()=>{t()}),r){let e=document.createElement("button");e.type="button",e.textContent="Cancel",e.className="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 transition-colors",e.addEventListener("click",()=>{r()}),n.appendChild(e)}return n.appendChild(s),a.appendChild(n),a},B=new D;function H(e,t){let r=document.createElement("div");r.className="flex justify-center space-x-2 my-2";let a=e=>{r.innerHTML="";let n=Math.max(1,e-Math.floor(3.5)),s=n+7-1;s>t&&(n=Math.max(1,(s=t)-7+1));for(let t=n;t<=s;t++){let n=document.createElement("button");n.textContent=t.toString(),n.className="px-3 py-1 border rounded "+(t===e?"bg-blue-500 dark:bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-blue-500 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-gray-700"),n.addEventListener("click",()=>{let e=new CustomEvent("pageChange",{detail:{page:t}});r.dispatchEvent(e),a(t)}),r.appendChild(n)}};return a(e),r}function R(e,t){let r=document.createElement("label");r.className="flex items-center space-x-2 cursor-pointer";let a=document.createElement("input");a.type="checkbox",a.id=e,a.className="form-checkbox h-4 w-4 text-blue-600";let n=document.createElement("span");return n.className="text-gray-700 dark:text-gray-100",n.textContent=t,r.appendChild(a),r.appendChild(n),r}function _(e=!0){e?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo(0,0)}let T=document.getElementById("sideMenuContent");function M(){T?.classList.remove("translate-x-full"),T?.classList.add("translate-x-0")}function F(){T?.classList.add("translate-x-full"),T?.classList.remove("translate-x-0")}var $=((L={}).INCLUDE="含む",L.EXCLUDES="除外",L),P=((q={}).NONE="---",q.RATE_25="25%",q.RATE_40="40%",q.RATE_50="50%",q.RATE_70="70%",q.RATE_85="85%",q);let j=new class{constructor(){this.questions=[],this.qListSize=0,this.query={}}async initQuery(){let e=await o.selectByStandard();this.qListSize=e.length,this.query={qLists:e}}async executeSearch(){let e=void 0===this.query.word||""===this.query.word?u.selectAll():u.selectByWord(this.query.word,this.query.wordCaseSensitive),t=new Set(this.includesQuestionIdsForQList),r=t.size>0?e.filter(e=>t.has(e.getId())):e;if(this.query.isFavorite){let e=await s.selectAll();r=r.filter(t=>e.some(e=>e.getQuestionId()===t.getId()))}if(!this.shouldCheckAnsHistory)return this.questions=r,this.questions;let n=new Map,i=new Map,d=r.map(async e=>{if(!n.has(e.getId())){let t=await a.selectByQuestionId(e.getId());n.set(e.getId(),{question:e,ansHistories:t})}});await Promise.all(d);let l=this.query.answerStartDate;if(l)for(let[e,t]of n)t.ansHistories=t.ansHistories.filter(e=>new Date(e.getAnswerDate())>=l),0===t.ansHistories.length&&(i.set(e,t),n.delete(e));let o=this.query.answerEndDate;if(o)for(let[e,t]of n)t.ansHistories=t.ansHistories.filter(e=>new Date(e.getAnswerDate())<=o),0===t.ansHistories.length&&(i.set(e,t),n.delete(e));let c=this.query.answerCountMin??0,m=this.query.answerCountMax??1/0;for(let[e,t]of n)t.ansHistories.length<c&&(i.set(e,t),n.delete(e)),t.ansHistories.length>m&&(i.set(e,t),n.delete(e));let h=this.query.recentWrongThreshold??0;if(h>0)for(let[e,t]of n)0===t.ansHistories.length?(i.set(e,t),n.delete(e)):t.ansHistories.slice(-h).every(e=>e.getIsCorrect())&&(i.set(e,t),n.delete(e));let g=this.query.recentCorrectRateCutoff??"---";if("---"!==g){let e=function(e){switch(e){case"25%":return .25;case"40%":return .4;case"50%":return .5;case"70%":return .7;case"85%":return .85;default:return 0}}(g);for(let[t,r]of n)if(0!==r.ansHistories.length){let a=r.ansHistories;a.filter(e=>e.getIsCorrect()).length/a.length<e&&(i.set(t,r),n.delete(t))}}return"除外"===this.query.answerStatus?this.questions=Array.from(i.values()).map(e=>e.question):this.questions=Array.from(n.values()).map(e=>e.question),this.questions}get includesQuestionIdsForQList(){if(void 0===this.query.qLists||0===this.query.qLists.length||this.query.qLists.length===this.qListSize)return[];let e=[];return this.query.qLists.forEach(t=>e.push(...t.getQuestions())),e}get shouldCheckAnsHistory(){return void 0!==this.query.answerCountMin&&this.query.answerCountMin>0||void 0!==this.query.answerCountMax&&this.query.answerCountMax<1/0||!!this.query.recentWrongThreshold&&this.query.recentWrongThreshold>0||!!this.query.recentCorrectRateCutoff&&"---"!==this.query.recentCorrectRateCutoff||!!this.query.answerStartDate||!!this.query.answerEndDate||!1}};async function U(e){let t=await j.executeSearch(),r=Math.floor(t.length/30)+ +(t.length%30!=0),a=(e-1)*30,n=t.slice(a,a+30),s=document.createElement("div");if(s.className="flex flex-col",0===t.length){let e=document.createElement("div");return e.className="text-gray-500 dark:text-gray-400 italic text-center my-4",e.textContent="表示する設問がありません。",s.appendChild(e),s}let i=H(e,r);i.id="paginationContentForQuestions",s.appendChild(i);let d=document.createElement("div");d.className="mb-2 text-sm text-right text-gray-600 dark:text-gray-300",d.textContent=`\u{5168} ${t.length} \u{4EF6}`,s.appendChild(d);let l=O(n.map(e=>({question:e})));return s.appendChild(l),s}function O(e){let t=document.createElement("div");return e.forEach(({question:e,ansHistory:r})=>{let a=document.createElement("button");a.className="w-full flex items-center justify-between px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-700 rounded shadow cursor-pointer";let n=document.createElement("span");if(n.className="flex-1 min-w-0 text-left truncate",n.textContent=`#${e.getId()}: ${x(e.getProblem())}`,a.appendChild(n),r){let e=document.createElement("span");e.className="ml-2 flex-shrink-0";let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","20"),t.setAttribute("height","20"),t.setAttribute("fill","currentColor");let n=document.createElementNS("http://www.w3.org/2000/svg","use");r.getIsCorrect()?(n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#circle"),e.classList.add("text-green-600","dark:text-green-400")):(n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#close"),e.classList.add("text-red-600","dark:text-red-400")),t.appendChild(n),e.appendChild(t),a.appendChild(e)}a.addEventListener("click",()=>{B.setModal(z(e,r),S.XL)}),t.appendChild(a)}),t}function z(e,t,r=!1,i){let l=0,o=document.createElement("div");o.className="bg-white dark:bg-gray-800 p-4 shadow rounded mb-4 whitespace-normal break-all";let c=document.createElement("div");c.className="flex items-center justify-between mb-2";let u=document.createElement("div");u.className="flex items-center";let m=document.createElement("p");if(m.className="text-lg font-medium text-gray-900 dark:text-gray-100",m.textContent="問題",u.appendChild(m),t){let e=document.createElement("span");e.className="ml-2 text-sm font-semibold rounded-full px-3 py-1 border",t.getIsCorrect()?(e.textContent="正解",e.classList.add("bg-green-100","text-green-700","border-green-300","dark:bg-green-200","dark:text-green-800","dark:border-green-400")):(e.textContent="不正解",e.classList.add("bg-red-100","text-red-700","border-red-300","dark:bg-red-200","dark:text-red-800","dark:border-red-400")),u.appendChild(e)}c.appendChild(u);let h=document.createElement("div");h.className="flex items-center justify-end gap-1 text-right text-xs text-gray-500 dark:text-gray-400 cursor-pointer";let x=document.createElement("span");x.textContent="設問ID:";let w=document.createElement("span");w.textContent=String(e.getId()),w.className=`ml-1 inline-block select-none transition duration-150 ease-in-out filter ${t??"blur"}`,w.addEventListener("click",()=>{let e=w.textContent??"";C(!1),b(e)}),h.append(x,w);let C=e=>{void 0===e?w.classList.toggle("blur"):e?w.classList.add("blur"):w.classList.remove("blur")};x.addEventListener("click",()=>C()),c.appendChild(h),o.appendChild(c);let E=document.createElement("div");if(E.className="mb-6 text-md text-gray-800 dark:text-gray-300",E.toggleAttribute("data-auto-tailwind",!0),E.innerHTML=e.getProblem(),o.appendChild(E),t){let e=document.createElement("div");e.className="text-right text-xs text-gray-500 dark:text-gray-400 mb-6",e.textContent=`\u{56DE}\u{7B54}\u{65E5}\u{6642}: ${p(t.getAnswerDate())}`,o.appendChild(e)}let v=document.createElement("div");v.className="mb-6 space-y-3";let k="radio"===e.getSelectionFormat()?"radio":"checkbox",I=t?t.getSelectChoice():[],N=[];e.getChoice().forEach((t,r)=>{let a=document.createElement("label");a.className="flex items-center space-x-2 cursor-pointer min-w-0",a.dataset.index=r.toString();let n=document.createElement("input");n.type=k,"radio"===k&&(n.name=`question-${e.getId()}`),n.dataset.index=r.toString(),I.includes(r)&&(n.checked=!0);let s=document.createElement("span");s.className="text-gray-800 dark:text-gray-200 flex-1 min-w-0",s.toggleAttribute("data-auto-tailwind",!0),s.innerHTML=t,a.appendChild(n),a.appendChild(s),N.push(a),n.addEventListener("change",async()=>{await ee(v,e,i)})}),r&&g(N),N.forEach(e=>{v.appendChild(e)}),o.appendChild(v);let L=document.createElement("div");L.className="flex justify-between items-center";let q=document.createElement("button");q.className="px-4 py-2 bg-blue-500 dark:bg-blue-600 text-white rounded hover:bg-blue-600 dark:hover:bg-blue-700",q.textContent="正解を表示する",L.appendChild(q);let A=document.createElement("button");A.className="hidden px-4 py-2 bg-fuchsia-500 dark:bg-fuchsia-600 text-white rounded hover:bg-fuchsia-600 dark:hover:bg-fuchsia-700",A.textContent="回答を取り消す",L.appendChild(A),o.appendChild(L);let Q=document.createElement("div");Q.className="mt-4 hidden";let H=document.createElement("hr");H.className="border-t border-gray-200 dark:border-gray-700 my-6",Q.appendChild(H);let R=e.getAnswer().map(t=>e.getChoice()[t]),T=document.createElement("p");T.className="mb-2 text-lg font-medium text-green-600 dark:text-green-400",T.textContent="正解",Q.appendChild(T);let M=document.createElement("div");M.className="p-2 rounded border border-green-500 dark:border-green-400 space-y-3",R.forEach(e=>{let t=document.createElement("p");t.className="text-green-600 dark:text-green-400 font-semibold",t.toggleAttribute("data-auto-tailwind",!0),t.innerHTML=e,M.appendChild(t)}),Q.appendChild(M);let $=document.createElement("div");$.className="mt-6 text-gray-700 dark:text-gray-300",$.toggleAttribute("data-auto-tailwind",!0),$.innerHTML=e.getExplanation(),Q.appendChild($);let P=document.createElement("div");P.className="mt-6 flex justify-between items-center text-xs text-gray-700 dark:text-gray-300";let j=document.createElement("button");j.setAttribute("type","button"),j.id="favoriteBtn",j.className="w-8 h-8 flex items-center justify-center border border-gray-500 text-gray-500 dark:border-gray-400 dark:text-gray-400 rounded hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer";let U=document.createElementNS("http://www.w3.org/2000/svg","svg");U.classList.add("w-5","h-5"),U.setAttribute("fill","currentColor");let O=document.createElementNS("http://www.w3.org/2000/svg","use");O.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#star"),U.appendChild(O),j.appendChild(U),P.appendChild(j),s.selectByQuestionId(e.getId()).then(e=>{e.length>0?j.querySelector("svg")?.classList.add("text-yellow-500"):j.querySelector("svg")?.classList.remove("text-yellow-500")}),j.addEventListener("click",async()=>{let t=await s.selectByQuestionId(e.getId());if(t.length>0)await s.deleteById(t[0].getId()),j.querySelector("svg")?.classList.remove("text-yellow-500");else{let t=n.fromRequiredArgs(e.getId(),1);await s.insert(t.generateRow()),j.querySelector("svg")?.classList.add("text-yellow-500")}}),Q.appendChild(P),o.appendChild(Q);let W=document.createElement("div");W.className="mt-4";let X=document.createElement("h3");X.className="text-lg font-medium text-gray-900 dark:text-gray-100",X.textContent="解答履歴",W.appendChild(X);let G=document.createElement("button");G.className="text-sm text-blue-600 dark:text-blue-400 hover:underline ml-2",G.textContent="履歴を表示",X.appendChild(G);let K=document.createElement("div");K.className="flex items-center gap-2 my-2",K.style.display="none",a.selectByQuestionId(e.getId()).then(e=>{e.sort((e,t)=>e.getId()-t.getId()).slice(-5).forEach(e=>{let t=document.createElement("div");t.className="flex flex-col items-center px-2 py-1 rounded bg-gray-100 dark:bg-gray-700";let r=document.createElement("span");r.className="my-1";let a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("width","16"),a.setAttribute("height","16"),a.setAttribute("fill","currentColor");let n=document.createElementNS("http://www.w3.org/2000/svg","use");e.getIsCorrect()?(n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#circle"),r.classList.add("text-green-600","dark:text-green-400")):(n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#close"),r.classList.add("text-red-600","dark:text-red-400"));let s=document.createElement("span");s.className="text-xs text-center text-gray-500 dark:text-gray-400",s.textContent=y(e.getAnswerDate()),a.appendChild(n),r.appendChild(a),t.addEventListener("click",async()=>{let t=await d.selectById(e.getPracticeHistoryId());await f.startPractice(t.getId()),t.getIsAnswered()?Z():V(),B.hide(),F(),_()}),t.appendChild(r),t.appendChild(s),K.appendChild(t)})}),W.appendChild(K),G.addEventListener("click",()=>{"none"===K.style.display||""===K.style.display?(K.style.display="flex",G.textContent="履歴を非表示"):(K.style.display="none",G.textContent="履歴を表示")}),o.appendChild(W);let J=document.createElement("div");J.className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden",o.appendChild(J);let Y=new D(J);async function ee(e,r,a){let n=e.querySelectorAll("input"),s=[];if(n.forEach(e=>{e.checked&&s.push(Number(e.dataset.index))}),s.length!==r.getAnswer().length)return;let i=[...r.getAnswer()].sort((e,t)=>e-t),d=[...s].sort((e,t)=>e-t),o=i.every((e,t)=>e===d[t]);void 0===t&&0===l&&a&&(l=await a(o,s),A.classList.remove("hidden"),A.disabled=!1);let c=document.createElement("div");c.className=`shadow rounded py-12 px-24 text-center text-2xl font-bold ${o?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,c.textContent=o?"正解":"不正解",Y.setModal(c),setTimeout(()=>{Y.hide()},800),o&&(et(),C())}function et(){N.forEach(t=>{if(e.getAnswer().includes(Number(t.dataset.index))){let e=t.querySelector("span");e?.classList.add("text-green-600","dark:text-green-400")}}),Q.classList.remove("hidden")}return q.addEventListener("click",()=>{et()}),A.addEventListener("click",async()=>{await f.cancelAnsHistory(l),A.disabled=!0,l=0;let e=document.createElement("div");e.className="shadow rounded py-12 px-24 text-center text-2xl font-bold text-fuchsia-600 dark:text-fuchsia-400",e.textContent="回答を取り消ししました。",Y.setModal(e,S.LG)}),t&&t.getIsCorrect()&&et(),o}async function W(){let e=await o.selectByStandard(),t=document.createElement("div");return t.id="qListBtnList",t.className="grid grid-cols-2 gap-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5",e.forEach(e=>{let r=document.createElement("button");r.textContent=e.getName()||"Unnamed",void 0!==e.getId()&&(r.dataset.id=e.getId().toString()),r.className="w-full text-left px-4 py-2 bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-700 rounded shadow cursor-pointer",r.addEventListener("click",()=>{B.setModal(X(e),S.XL)}),t.appendChild(r)}),t}function X(e){let t=document.createElement("div");t.className="bg-white dark:bg-gray-800 p-6 shadow rounded mb-6";let r=document.createElement("h2");r.className="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100",r.textContent=e.getName(),t.appendChild(r);let a=document.createElement("div");a.className="mb-6 space-y-2 border-b dark:border-gray-700 pb-4";let n=document.createElement("p");n.className="text-sm text-gray-700 dark:text-gray-300",n.textContent=`\u{554F}\u{984C}\u{6570}\u{FF1A} ${e.getQuestions().length}\u{554F}`,a.appendChild(n);let s=document.createElement("p");s.className="text-sm text-gray-700 dark:text-gray-300",s.textContent=`\u{554F}\u{984C}\u{96C6}\u{7A2E}\u{5225}\u{FF1A} ${e.getIsDefault()?"標準問題":"カスタム問題"}`,a.appendChild(s),t.appendChild(a);let i=document.createElement("div");i.className="space-y-4 mb-6";let d=R("shuffleQuestionsCheckbox","問題の出題順を並び替えるか");i.appendChild(d);let l=R("shuffleChoicesCheckbox","選択肢を並び替えるか");i.appendChild(l),t.appendChild(i);let o=document.createElement("button");return o.className="w-full px-4 py-2 bg-blue-500 dark:bg-blue-600 text-white rounded hover:bg-blue-600 dark:hover:bg-blue-700",o.textContent="演習開始",o.addEventListener("click",async()=>{let t=document.getElementById("shuffleQuestionsCheckbox").checked,r=document.getElementById("shuffleChoicesCheckbox").checked;await f.createAndStartPractice(e.getId(),t,r,!1),B.hide(),V(),_()}),t.appendChild(o),t}function V(){C.textContent=f.qListTitle,v.textContent=`${f.totalQuestion}`;let{question:e,ansHistory:t}=f.currentQuestionDetail;G(Y(e,t)),I.classList.add("hidden"),w.classList.remove("hidden")}function G(e){E.textContent=`${f.currentQuestionNumber}`,k.replaceChildren(),k.appendChild(e)}function K(){let e=f.getNextQuestionDetail();if(null!==e){let{question:t,ansHistory:r}=e;G(Y(t,r));return}if(f.isAllQuestionsSolved){f.markAsAnswered(),Z();return}let t=document.createElement("div");t.className="shadow rounded py-12 px-4 text-center text-2xl",t.textContent="この問題が最後の問題です",B.setModal(t)}function J(){let e=f.getPrevQuestionDetail();if(null!==e){let{question:t,ansHistory:r}=e;G(Y(t,r));return}let t=document.createElement("div");t.className="shadow rounded py-12 px-4 text-center text-2xl",t.textContent="この問題が最初の問題です",B.setModal(t)}function Y(e,t){return z(e,t,f.isRandomC,f.entryAnsHistory.bind(f))}function Z(){var e;let t,r,a,n,s,i,d,c,u,m,h,g,p,x,b,C,E,v,k;I.replaceChildren(),I.appendChild(((t=document.createElement("div")).className="space-y-6",(r=document.createElement("h2")).className="text-3xl font-bold text-center text-gray-900 dark:text-gray-100",r.textContent=f.qListTitle,t.appendChild((e=f.qList,a=document.createElement("div"),n=document.createElement("h2"),e.getIsDefault()||(n.style.cursor="pointer"),n.className="text-3xl font-bold text-center text-gray-900 dark:text-gray-100",n.textContent=e.getName(),a.appendChild(n),(s=document.createElement("input")).type="text",s.value=e.getName(),s.style.display="none",s.className="mt-2 w-full p-2 rounded border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500",a.appendChild(s),n.addEventListener("click",()=>{e.getIsDefault()||(n.style.display="none",s.style.display="block",s.focus())}),s.addEventListener("blur",()=>{let t=s.value.trim();t&&(n.textContent=t,e.setName(t),o.update(e.generateRow())),n.textContent=t,n.style.display="block",s.style.display="none"}),a)),(i=document.createElement("div")).className="flex items-center mb-6",d=f.correctAnswerCount,m=Math.round(100*(u=(c=f.totalQuestion)>0?d/c:0)),(h=document.createElement("div")).className="w-1/3 flex justify-center",g=function(e,t=100){let r="http://www.w3.org/2000/svg",a=document.createElementNS(r,"svg");a.setAttribute("width",t.toString()),a.setAttribute("height",t.toString());let n=t/2,s=t/2,i=t/2-10,d=2*Math.PI*i,l=document.createElementNS(r,"circle");l.setAttribute("cx",n.toString()),l.setAttribute("cy",s.toString()),l.setAttribute("r",i.toString()),l.setAttribute("fill","none"),l.setAttribute("stroke","#e5e7eb"),l.setAttribute("stroke-width","20"),a.appendChild(l);let o=document.createElementNS(r,"circle");return o.setAttribute("cx",n.toString()),o.setAttribute("cy",s.toString()),o.setAttribute("r",i.toString()),o.setAttribute("fill","none"),o.setAttribute("stroke","#34d399"),o.setAttribute("stroke-width","20"),o.setAttribute("stroke-dasharray",d.toString()),o.setAttribute("stroke-dashoffset",(d*(1-e)).toString()),o.setAttribute("transform",`rotate(-90 ${n} ${s})`),a.appendChild(o),a}(u,100),h.appendChild(g),(p=document.createElement("div")).className="w-2/3",(x=document.createElement("div")).className="rounded-lg shadow text-center p-6 space-y-4 w-full bg-white dark:bg-gray-800",x.innerHTML=`
    <p class="text-xl text-gray-800 dark:text-gray-200">
      \u{6B63}\u{7B54}\u{7387}<span class="font-bold text-4xl text-blue-600 dark:text-blue-400 ml-2">${m}%</span>
    </p>
    <p class="text-lg text-gray-900 dark:text-gray-100 mb-2">
      \u{6B63}\u{89E3}\u{6570}<span class="font-bold text-green-600 dark:text-green-400 text-xl ml-2">${d}</span> / 
      <span class="font-bold text-gray-700 dark:text-gray-300 text-xl">${c}</span> \u{554F}
    </p>
  `,p.appendChild(x),i.appendChild(h),i.appendChild(p),t.appendChild(i),(b=document.createElement("div")).className="flex justify-center space-x-6",(C=document.createElement("button")).textContent="再試",C.className="px-6 py-2 bg-yellow-500 dark:bg-yellow-600 text-white rounded hover:bg-yellow-600 dark:hover:bg-yellow-700",C.addEventListener("click",()=>{B.setModal(X(f.qList),S.XL)}),b.appendChild(C),(E=document.createElement("button")).textContent="復習",E.className=`px-6 py-2 bg-blue-500 dark:bg-blue-600 text-white rounded ${d===c?"disabled:cursor-not-allowed":"hover:bg-blue-600 dark:hover:bg-blue-700"}`,E.addEventListener("click",()=>{let e,t,r,a,n,s,i,d,c,u;B.setModal(((e=document.createElement("div")).className="bg-white dark:bg-gray-800 p-6 shadow rounded mb-6",t=`\u{3010}\u{5FA9}\u{7FD2}\u{3011}${f.qListTitle} - ${y(new Date().toISOString())}`,(r=document.createElement("h2")).className="text-2xl font-bold mb-4 text-gray-900 dark:text-gray-100",r.textContent=t,e.appendChild(r),(a=document.createElement("div")).className="mb-6 space-y-2 border-b dark:border-gray-700 pb-4",(n=document.createElement("p")).className="text-sm text-gray-700 dark:text-gray-300",n.textContent=`\u{554F}\u{984C}\u{6570}\u{FF1A} ${f.totalQuestion-f.correctAnswerCount}\u{554F}`,a.appendChild(n),(s=document.createElement("p")).className="text-sm text-gray-700 dark:text-gray-300",s.textContent="問題集種別： カスタム問題",a.appendChild(s),e.appendChild(a),(i=document.createElement("div")).className="space-y-4 mb-6",d=R("shuffleQuestionsCheckbox","問題の出題順を並び替えるか"),i.appendChild(d),c=R("shuffleChoicesCheckbox","選択肢を並び替えるか"),i.appendChild(c),e.appendChild(i),(u=document.createElement("button")).className="w-full px-4 py-2 bg-blue-500 dark:bg-blue-600 text-white rounded hover:bg-blue-600 dark:hover:bg-blue-700",u.textContent="復習開始",u.addEventListener("click",async()=>{let e=document.getElementById("shuffleQuestionsCheckbox").checked,r=document.getElementById("shuffleChoicesCheckbox").checked,a=l.fromCreateNew(t,f.incorrectQuestions,!1),n=await o.insert(a.generateRow());await f.createAndStartPractice(n,e,r,!0),B.hide(),V(),_()}),e.appendChild(u),e),S.XL)}),d===c&&(E.disabled=!0),b.appendChild(E),t.appendChild(b),(v=document.createElement("div")).className="mt-6",k=O(f.generateQuestionResultDetails()),v.appendChild(k),t.appendChild(v),t)),w.classList.add("hidden"),I.classList.remove("hidden")}async function ee(){let e=document.createElement("div"),t=await d.selectAllOrderDesc(),r=1,a=Math.floor(t.length/10)+ +(t.length%10!=0);if(a>1){let t=H(r,a);t.addEventListener("pageChange",e=>{({page:r}=e.detail),s()}),e.appendChild(t)}let n=document.createElement("div");async function s(){n.innerHTML="";let a=(r-1)*10;for(let e of t.slice(a,a+10)){let t=await et(e);t&&n.appendChild(t)}e.appendChild(n)}return n.className="space-y-2",s(),e}async function et(e){let t=document.createElement("div");t.className="bg-white dark:bg-gray-800 p-4 rounded shadow border dark:border-gray-700";let r=await o.selectById(e.getQListId()),n=document.createElement("div");n.className="flex items-center justify-between mb-2";let s=document.createElement("h3");s.className="text-xl font-bold mb-2 text-gray-900 dark:text-gray-100 cursor-pointer",s.textContent=r.getName(),n.appendChild(s);let i=document.createElement("span");i.className="px-2 py-1 rounded text-xs font-semibold cursor-pointer bg-red-500 text-white dark:bg-red-600";let l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width","18"),l.setAttribute("height","18"),l.setAttribute("fill","currentColor");let c=document.createElementNS("http://www.w3.org/2000/svg","use");c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#trash"),l.appendChild(c),i.appendChild(l),i.addEventListener("click",async()=>{let t=f.practiceHistoryId===e.getId()?Q("現在の演習中の問題集は削除できません",()=>{B.hide()}):Q("この問題集を削除しますか？",async()=>{await d.deleteById(e.getId()),await a.deleteByPracticeHistoryId(e.getId()),B.hide(),F(),_()},()=>{B.hide()});B.setModal(t,S.DEFAULT)}),n.appendChild(i),t.appendChild(n);let u=document.createElement("div");u.className="flex items-center justify-between text-sm text-gray-700 dark:text-gray-300";let m=document.createElement("div");m.className="flex items-center space-x-2";let h=document.createElement("span");h.className="px-2 py-1 rounded text-xs font-semibold",e.getIsAnswered()?(h.textContent="回答済み",h.classList.add("bg-green-500","text-white","dark:bg-green-600")):(h.textContent="演習中",h.classList.add("bg-yellow-500","text-white","dark:bg-yellow-600")),m.appendChild(h);let g=document.createElement("span");g.className="px-2 py-1 rounded text-xs font-semibold cursor-pointer",r.getIsDefault()?(g.textContent="標準問題",g.classList.add("bg-blue-500","text-white","dark:bg-blue-600"),g.addEventListener("click",async()=>{if(void 0===r.getUuid()){let e=Q("この問題集を標準問題に切り替えることはできません。",()=>{B.hide()});B.setModal(e,S.DEFAULT)}else{let e=er(r,!0);B.setModal(e,S.DEFAULT)}})):(g.textContent="カスタム問題",g.classList.add("bg-purple-500","text-white","dark:bg-purple-600"),g.addEventListener("click",async()=>{let e=er(r,!1);B.setModal(e,S.DEFAULT)})),m.appendChild(g),u.appendChild(m);let y=document.createElement("span");return y.textContent=p(e.getCreateAt()),u.appendChild(y),t.appendChild(u),s.addEventListener("click",async()=>{await f.startPractice(e.getId()),e.getIsAnswered()?Z():V(),F(),_()}),t}function er(e,t){return Q(t?"この問題集をカスタム問題に切り替えますか？":"この問題集を標準問題に切り替えますか？",async()=>{e.setIsDefault(!t),await o.update(e.generateRow()),B.hide(),F(),_()},()=>{B.hide()})}async function ea(){var e;let t,r,n,s,i,d,l=document.createElement("div"),o=await a.selectAll(),c="date",u=!1,m=1,h=Math.floor(o.length/20)+ +(o.length%20!=0),g=document.createElement("div");g.className="flex justify-end";let p=(e=[{key:"id",displayName:"ID順"},{key:"date",displayName:"回答日時順",default:!0,isAscendingDefault:!1}],(t=document.createElement("div")).className="flex gap-2 mb-4",n=(r=e.find(e=>e.default)||e[0]).key,s=r.isAscendingDefault??!0,i=new Map,d=()=>{i.forEach(({arrow:e},t)=>{e.textContent=t===n?s?" ▲":" ▼":""})},e.forEach(({key:e,displayName:r})=>{let a=document.createElement("button");a.className="px-3 py-1 rounded border hover:bg-gray-100 dark:hover:bg-gray-700";let l=document.createElement("span");l.textContent=r;let o=document.createElement("span");o.textContent="",a.appendChild(l),a.appendChild(o),a.addEventListener("click",()=>{n===e?s=!s:(n=e,s=!0),d(),t.dispatchEvent(new CustomEvent("sortChange",{detail:{key:n,isAsc:s},bubbles:!0}))}),i.set(e,{button:a,arrow:o}),t.appendChild(a)}),d(),t);if(p.addEventListener("sortChange",e=>{({key:c,isAsc:u}=e.detail),x()}),g.appendChild(p),l.appendChild(g),h>1){let e=H(m,h);e.addEventListener("pageChange",e=>{({page:m}=e.detail),x()}),l.appendChild(e)}let y=document.createElement("div");y.className="space-y-2";let x=async()=>{y.innerHTML="";let e=(m-1)*20;for(let t of o.sort((e,t)=>"id"===c?u?e.getQuestionId()-t.getQuestionId():t.getQuestionId()-e.getQuestionId():u?new Date(e.getAnswerDate()).getTime()-new Date(t.getAnswerDate()).getTime():new Date(t.getAnswerDate()).getTime()-new Date(e.getAnswerDate()).getTime()).slice(e,e+20)){let e=await en(t);e&&y.appendChild(e)}l.appendChild(y)};return x(),l}async function en(e){let t=u.selectById(e.getQuestionId());if(!t)return null;let r=await d.selectById(e.getPracticeHistoryId()),a=await o.selectById(r.getQListId()),n=document.createElement("div");n.className="bg-white dark:bg-gray-800 p-4 rounded shadow border dark:border-gray-700";let s=document.createElement("div");s.className="flex items-center justify-between cursor-pointer hover:font-bold";let i=document.createElement("span");i.className="flex-1 min-w-0 text-left truncate",i.textContent=`#${t.getId()}: ${x(t.getProblem())}`,s.appendChild(i);let l=document.createElement("span");l.className="ml-2 flex-shrink-0";let c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width","20"),c.setAttribute("height","20"),c.setAttribute("fill","currentColor");let m=document.createElementNS("http://www.w3.org/2000/svg","use");e.getIsCorrect()?(m.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#circle"),l.classList.add("text-green-600","dark:text-green-400")):(m.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#close"),l.classList.add("text-red-600","dark:text-red-400")),c.appendChild(m),l.appendChild(c),s.appendChild(l),n.appendChild(s),s.addEventListener("click",()=>{B.setModal(z(t,e),S.XL)});let h=document.createElement("p");h.className="mt-2 text-sm text-gray-600 dark:text-gray-300 cursor-pointer hover:text-blue-600 dark:hover:text-blue-400",h.textContent=`\u{554F}\u{984C}\u{96C6}\u{540D}: ${a.getName()}`,n.appendChild(h),h.addEventListener("click",async()=>{await f.startPractice(r.getId()),r.getIsAnswered()?Z():V(),F(),_()});let g=document.createElement("div");return g.className="mt-2 text-right text-xs text-gray-500 dark:text-gray-400",g.textContent=p(e.getAnswerDate()),n.appendChild(g),n}async function es(){let e,t,r,a,n,s,i,d,l,o,c,u,m,h,g,p,y,x,b,f,w,C,E,v,k,I,N,L,q,A=document.createElement("div");A.className="space-y-4",A.appendChild(await ei()),A.appendChild(((e=document.createElement("div")).className="flex items-center space-x-2",(t=document.createElement("input")).type="checkbox",t.id="favoriteCheckbox",t.className="form-checkbox h-4 w-4 text-blue-600 dark:text-blue-400",t.checked=j.query.isFavorite??!1,t.addEventListener("change",()=>{j.query.isFavorite=t.checked}),(r=document.createElement("label")).className="block text-md font-medium text-gray-700 dark:text-gray-300",r.setAttribute("for","favoriteCheckbox"),r.textContent="お気に入りの設問のみ",e.appendChild(t),e.appendChild(r),e)),A.appendChild(document.createElement("hr")),A.appendChild(((a=document.createElement("div")).className="flex flex-col space-y-2",(n=document.createElement("div")).className="flex space-x-4",(s=document.createElement("div")).className="flex-1",(i=document.createElement("label")).className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",i.textContent="最小回答数",s.appendChild(i),(d=document.createElement("input")).type="number",d.min="0",d.step="1",d.placeholder="x回以上の回答",d.className="w-full p-2 rounded border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500",d.value=j.query.answerCountMin?.toString()??"",d.addEventListener("change",()=>{j.query.answerCountMin=Number(d.value)}),s.appendChild(d),(l=document.createElement("div")).className="flex-1",(o=document.createElement("label")).className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",o.textContent="最大回答数",l.appendChild(o),(c=document.createElement("input")).type="number",c.min="0",c.step="1",c.value=j.query.answerCountMax?.toString()??"",c.placeholder="x回以下の回答",c.className="w-full p-2 rounded border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500",c.addEventListener("change",()=>{j.query.answerCountMax=Number(c.value)}),l.appendChild(c),n.appendChild(s),n.appendChild(l),a.appendChild(n),a)),A.appendChild(((u=document.createElement("div")).className="grid grid-cols-1 md:grid-cols-2 gap-2",(m=document.createElement("div")).className="flex flex-col",(h=document.createElement("label")).className="block text-md font-medium text-gray-700 dark:text-gray-300 mb-2",h.setAttribute("for","recentWrongThreshold"),h.textContent="直近誤答閾値 (直近?回以内の誤答有無で抽出)",m.appendChild(h),(g=document.createElement("input")).type="number",g.id="recentWrongThreshold",g.className="w-full p-2 rounded border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500",g.min="0",g.step="1",g.value=j.query.recentWrongThreshold?.toString()??"0",g.addEventListener("change",()=>{j.query.recentWrongThreshold=Number(g.value)}),m.appendChild(g),u.appendChild(m),(p=document.createElement("div")).className="flex flex-col",(y=document.createElement("label")).className="block text-md font-medium text-gray-700 dark:text-gray-300 mb-2",y.setAttribute("for","correctRateThreshold"),y.textContent="直近正答率の閾値",p.appendChild(y),(x=document.createElement("select")).id="correctRateThreshold",x.className="w-full p-2 rounded border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500",Object.values(P).forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e,e===j.query.recentCorrectRateCutoff?.toString()&&(t.selected=!0),x.appendChild(t)}),x.addEventListener("change",()=>{j.query.recentCorrectRateCutoff=x.value}),p.appendChild(x),u.appendChild(p),u)),A.appendChild(((b=document.createElement("div")).className="flex flex-row space-x-4 items-center",(f=document.createElement("div")).className="flex-1",(w=document.createElement("label")).className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",w.textContent="回答開始日",f.appendChild(w),(C=document.createElement("input")).type="date",C.value=j.query.answerStartDate?.toISOString().split("T")[0]??"",C.className="w-full p-2 rounded border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500",C.addEventListener("change",()=>{let e=C.value?new Date(C.value):void 0;j.query.answerStartDate=e}),f.appendChild(C),(E=document.createElement("div")).className="flex-1",(v=document.createElement("label")).className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",v.textContent="回答終了日",E.appendChild(v),(k=document.createElement("input")).type="date",k.value=j.query.answerEndDate?.toISOString().split("T")[0]??"",k.className="w-full p-2 rounded border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500",k.addEventListener("change",()=>{let e,t=k.value?((e=new Date(k.value)).setHours(23,59,59,999),e):void 0;j.query.answerEndDate=t}),E.appendChild(k),b.appendChild(f),b.appendChild(E),b)),A.appendChild(((I=document.createElement("div")).className="space-y-2",(N=document.createElement("label")).className="block text-md font-medium text-gray-700 dark:text-gray-300 mb-2",N.textContent="フィルター条件",I.appendChild(N),(L=document.createElement("div")).className="flex space-x-4",q=j.query.answerStatus||$.INCLUDE,[$.INCLUDE,$.EXCLUDES].forEach(e=>{let t=document.createElement("label");t.className="inline-flex items-center cursor-pointer";let r=document.createElement("input");r.type="radio",r.name="answerStatus",r.value=e,r.className="form-radio text-blue-600 dark:text-blue-400",e===q&&(r.checked=!0),r.addEventListener("change",()=>{j.query.answerStatus=r.value});let a=document.createElement("span");a.className="ml-2 text-sm text-gray-700 dark:text-gray-300",a.textContent=e,t.appendChild(r),t.appendChild(a),L.appendChild(t)}),I.appendChild(L),I));let S=document.createElement("a");return S.id="hideDetailedSearchBtn",S.textContent="詳細検索を隠す",S.className="flex items-center text-blue-500 dark:text-blue-400 underline cursor-pointer mb-2",A.appendChild(S),A}async function ei(){let e=document.createElement("div"),t=document.createElement("div");t.className="flex justify-between items-center mb-2";let r=document.createElement("label");r.className="block text-md font-medium text-gray-700 dark:text-gray-300",r.textContent="出題範囲とする問題集",t.appendChild(r);let a=document.createElement("div");a.className="flex items-center space-x-4";let n=document.createElement("label");n.className="inline-flex items-center cursor-pointer";let s=document.createElement("input");s.type="checkbox",s.className="form-checkbox h-4 w-4 text-blue-600",s.id="selectAllCheckbox",n.appendChild(s);let i=document.createElement("span");i.className="ml-1 text-sm text-gray-700 dark:text-gray-300",i.textContent="全選択",n.appendChild(i),a.appendChild(n);let d=document.createElement("label");d.className="inline-flex items-center cursor-pointer";let l=document.createElement("input");l.type="checkbox",l.className="form-checkbox h-4 w-4 text-blue-600",l.id="deselectAllCheckbox",d.appendChild(l);let c=document.createElement("span");c.className="ml-1 text-sm text-gray-700 dark:text-gray-300",c.textContent="全解除",d.appendChild(c),a.appendChild(d),t.appendChild(a),e.appendChild(t);let u=document.createElement("div");u.className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-1";let m=await o.selectByStandard(),h=[];function g(e,t,r){let a=j.query.qLists?.some(t=>t.getId()===e.getId())??!1,n=void 0!==r?r:!a;n?(t.classList.add("bg-blue-500","dark:bg-blue-600","text-white"),t.classList.remove("bg-white","dark:bg-gray-800","text-black","dark:text-gray-300")):(t.classList.add("bg-white","dark:bg-gray-800","text-black","dark:text-gray-300"),t.classList.remove("bg-blue-500","dark:bg-blue-600","text-white")),n?a||j.query.qLists?.push(e):j.query.qLists=j.query.qLists?.filter(t=>t.getId()!==e.getId())??[]}return m.forEach(e=>{let t=document.createElement("button");t.type="button",t.textContent=e.getName(),t.className="w-full h-full p-2 border rounded transition-colors bg-white dark:bg-gray-800 text-black dark:text-blue-100 flex items-center justify-center text-center break-words",t.addEventListener("click",()=>{g(e,t)}),g(e,t,j.query.qLists?.some(t=>t.getId()===e.getId())),h.push({qList:e,btn:t}),u.appendChild(t)}),s.addEventListener("click",()=>{s.checked&&(h.forEach(({qList:e,btn:t})=>{g(e,t,!0)}),l.checked=!1)}),l.addEventListener("click",()=>{l.checked&&(h.forEach(({qList:e,btn:t})=>{g(e,t,!1)}),s.checked=!1)}),e.appendChild(u),e}let ed="gdrive.client_id",el="gdrive.folder_id";function eo(e){localStorage.setItem(ed,e.trim())}function ec(e){localStorage.setItem(el,e.trim())}async function eu(e,t){let r=`https://www.googleapis.com/drive/v3/files/${encodeURIComponent(t)}?fields=id,name,mimeType,modifiedTime,size,fileExtension,shortcutDetails`,a=await fetch(r,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok){let e=await a.text().catch(()=>"");throw Error(`files.get(meta) failed: ${a.status} ${a.statusText} ${e}`)}return a.json()}async function em(e,t){let r,a=[],n=encodeURIComponent(`'${t}' in parents and trashed = false`);do{let t=`https://www.googleapis.com/drive/v3/files?q=${n}&fields=nextPageToken,files(id,name,mimeType,modifiedTime,size,fileExtension,shortcutDetails)&orderBy=name`+(r?`&pageToken=${encodeURIComponent(r)}`:""),s=await fetch(t,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok){let e=await s.text().catch(()=>"");throw Error(`files.list failed: ${s.status} ${s.statusText} ${e}`)}let i=await s.json();i.files?.length&&a.push(...i.files),r=i.nextPageToken}while(r)return a}async function eh(e,t){if("application/vnd.google-apps.shortcut"===t.mimeType&&t.shortcutDetails?.targetId){let r=await eu(e,t.shortcutDetails.targetId);return r.mimeType.startsWith("application/vnd.google-apps.")?null:{id:r.id,name:r.name,mimeType:r.mimeType}}return t.mimeType.startsWith("application/vnd.google-apps.")?null:{id:t.id,name:t.name,mimeType:t.mimeType}}async function eg(e,t){let r=await fetch(`https://www.googleapis.com/drive/v3/files/${encodeURIComponent(t)}?alt=media`,{headers:{Authorization:`Bearer ${e}`}});if(!r.ok){let e=await r.text().catch(()=>"");throw Error(`files.get (alt=media) failed: ${r.status} ${r.statusText} ${e}`)}return r.json()}async function ep(e,t){let r=await em(e,t),a=(await Promise.all(r.map(t=>eh(e,t)))).filter(e=>!!e).filter(e=>"application/json"===e.mimeType||"application/octet-stream"===e.mimeType);return await Promise.all(a.map(async t=>{let a=await eg(e,t.id),n=r.find(e=>e.id===t.id||e.shortcutDetails?.targetId===t.id);return{id:t.id,name:t.name,mimeType:t.mimeType,modifiedTime:n?.modifiedTime,content:a}}))}async function ey(e,t){let r=await new Promise((t,r)=>{try{google.accounts.oauth2.initTokenClient({client_id:e,scope:"https://www.googleapis.com/auth/drive.readonly",callback:e=>{e&&e.access_token?t(e.access_token):r(Error("アクセストークンの取得に失敗しました。"))}}).requestAccessToken()}catch(e){r(e)}}),a=await ep(r,t);if(!a.length)return void alert("対象フォルダに JSON ファイルが見つかりませんでした。");let{questions:n,qLists:s}=function(e){let t=new Map,r=[];for(let a of e)if(a&&"object"==typeof a){if(Array.isArray(a.questions))for(let e of a.questions)e&&"object"==typeof e&&"number"==typeof e.id&&t.set(e.id,new c(e));if(Array.isArray(a.qLists))for(let e of a.qLists){if(!e||"string"!=typeof e.name||!Array.isArray(e.questions))continue;let t=l.fromRow(e);r.push(t)}}return{questions:Array.from(t.values()),qLists:r}}(a.map(e=>e.content));console.info(`Imported: questions=${n.length}, qLists=${s.length}`),console.debug({questions:n,qLists:s}),await u.bulkInsert(n),await o.bulkInsert(s)}async function ex(){let e=localStorage.getItem(ed)??"",t=localStorage.getItem(el)??"";if(!e)throw Error("client_id が未設定です。");if(!t)throw Error("folderId が未設定です。");await ey(e,t)}var eb=((A={}).LIGHT="light",A.DARK="dark",A);function ef(){let e=localStorage.getItem("editorTheme");return e?"dark"===e?"dark":"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function ew(e){localStorage.setItem("editorTheme",e),"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}ew(ef());let eC=["practiceHistoryId","questionId","isCorrect","selectChoice","answerDate","qListId","isReview","isAnswered","isRandomQ","isRandomC","createAt","questionUuid","name","questions","isUndeliteable"];class eE{constructor(e,t,r,a,n,s,i,d,l,o,c,u,m,h,g){this.practiceHistoryId=e,this.questionId=t,this.isCorrect=r,this.selectChoice=a,this.answerDate=n,this.qListId=s,this.isReview=i,this.isAnswered=d,this.isRandomQ=l,this.isRandomC=o,this.createAt=c,this.questionUuid=u,this.name=m,this.questions=h,this.isUndeliteable=g}static fromTable(e,t,r){return new eE(r.getPracticeHistoryId(),r.getQuestionId(),r.getIsCorrect(),r.getSelectChoice(),r.getAnswerDate(),t.getQListId(),t.getIsReview(),t.getIsAnswered(),t.getIsRandomQ(),t.getIsRandomC(),t.getCreateAt(),e.getUuid(),e.getName(),e.getQuestions(),e.getIsDefault())}static fromTableForUndefined(e,t){return new eE(t.getId(),0,!1,[],"",t.getQListId(),t.getIsReview(),t.getIsAnswered(),t.getIsRandomQ(),t.getIsRandomC(),t.getCreateAt(),e.getUuid(),e.getName(),e.getQuestions(),e.getIsDefault())}getPracticeHistoryId(){return this.practiceHistoryId}setPracticeHistoryId(e){this.practiceHistoryId=e}getQuestionId(){return this.questionId}setQuestionId(e){this.questionId=e}getIsCorrect(){return this.isCorrect}setIsCorrect(e){this.isCorrect=e}getSelectChoice(){return this.selectChoice}setSelectChoice(e){this.selectChoice=e}getAnswerDate(){return this.answerDate}setAnswerDate(e){this.answerDate=e}getQListId(){return this.qListId}setQListId(e){this.qListId=e}getIsReview(){return this.isReview}setIsReview(e){this.isReview=e}getIsAnswered(){return this.isAnswered}setIsAnswered(e){this.isAnswered=e}getIsRandomQ(){return this.isRandomQ}setIsRandomQ(e){this.isRandomQ=e}getIsRandomC(){return this.isRandomC}setIsRandomC(e){this.isRandomC=e}getCreateAt(){return this.createAt}setCreateAt(e){this.createAt=e}getQuestionUuid(){return this.questionUuid}setQuestionUuid(e){this.questionUuid=e}getName(){return this.name}setName(e){this.name=e}getQuestions(){return this.questions}setQuestions(e){this.questions=e}getIsUndeliteable(){return this.isUndeliteable}setIsUndeliteable(e){this.isUndeliteable=e}}function ev(e){if(null==e)return"";let t=e.toString();return(t.includes(",")||t.includes('"')||t.includes("\n"))&&(t='"'+t.replace(/"/g,'""')+'"'),t}async function ek(){let e=[];for(let t of(await o.selectAll()))for(let r of(await d.selectByQListId(t.getId()))){let n=await a.selectByPracticeHistoryId(r.getId());for(let a of n)e.push(eE.fromTable(t,r,a));console.log(`QList: ${t.getName()}, PracticeHistory: ${r.getId()}, AnsHistories: ${n.length}`),0===n.length&&e.push(eE.fromTableForUndefined(t,r))}return e}async function eI(){let e=await ek(),t=eC.map(ev).join(",")+"\n";return e.forEach(e=>{let r=[e.getPracticeHistoryId(),e.getQuestionId(),e.getIsCorrect(),Array.isArray(e.getSelectChoice())?e.getSelectChoice().join(";"):e.getSelectChoice(),e.getAnswerDate(),e.getQListId(),e.getIsReview(),e.getIsAnswered(),e.getIsRandomQ(),e.getIsRandomC(),e.getCreateAt(),e.getQuestionUuid(),e.getName(),Array.isArray(e.getQuestions())?e.getQuestions().join(";"):e.getQuestions(),e.getIsUndeliteable()];t+=r.map(ev).join(",")+"\n"}),new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"})}async function eN(){let e=await eI(),t=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download","export.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}async function eL(e){var t;let n=await (t=e,new Promise((e,r)=>{let a=new FileReader;a.onload=t=>{try{let a=(t.target?.result).replace(/^\uFEFF/,"").split(/\r?\n/).filter(e=>""!==e.trim());if(0===a.length)return void r(Error("エラー: 空のCSVファイルです"));let n=eA(a[0]).map(e=>e.trim());if(!(eC.length===n.length&&eC.every((e,t)=>e===n[t])))return void r(Error("エラー: CSVのヘッダーが正しくありません"));let s=[];for(let e=1;e<a.length;e++){let t=a[e];if(""===t.trim())continue;let r=eA(t);if(r.length!==eC.length)continue;let n=Number(r[0]),i=Number(r[1]),d="true"===r[2].toLowerCase(),l=r[3]?r[3].split(";").map(e=>Number(e)):[],o=r[4],c=Number(r[5]),u="true"===r[6].toLowerCase(),m="true"===r[7].toLowerCase(),h="true"===r[8].toLowerCase(),g="true"===r[9].toLowerCase(),p=r[10],y=r[11],x=r[12],b=r[13]?r[13].split(";").map(e=>Number(e)):[],f="true"===r[14].toLowerCase(),w=new eE(n,i,d,l,o,c,u,m,h,g,p,y,x,b,f);s.push(w)}e(s)}catch(e){console.error(e),r(Error("エラー: CSVのパース中に問題が発生しました"))}},a.onerror=()=>{r(Error("エラー: CSVファイルの読み込み中に問題が発生しました"))},a.readAsText(t,"utf-8")})),s=new Map;for(let[e,t]of(n.forEach(e=>{let t=e.getQListId(),a=l.fromRequiredArgs(e.getQuestionUuid(),e.getName(),e.getQuestions(),e.getIsUndeliteable()),n=i.fromCsvRow(e.getQListId(),e.getIsReview(),e.getIsAnswered(),e.getIsRandomQ(),e.getIsRandomC(),e.getCreateAt()),d=r.fromRequiredArgs(e.getPracticeHistoryId(),e.getQuestionId(),e.getIsCorrect(),e.getSelectChoice(),e.getAnswerDate()),o=s.get(t);if(!o){let e=new Map([[d.getPracticeHistoryId(),{practiceHistory:n,ansHistories:[d]}]]);s.set(t,{qList:a,practiceHistorySetMap:e});return}let c=o.practiceHistorySetMap,u=c.get(d.getPracticeHistoryId());u?u.ansHistories.push(d):c.set(d.getPracticeHistoryId(),{practiceHistory:n,ansHistories:[d]})}),s)){let e=""===t.qList.getUuid()?await o.selectByNameAndQuestions(t.qList.getName(),t.qList.getQuestions()):await o.selectByUuid(t.qList.getUuid());if(e){let r=e.getId();for(let[e,n]of t.practiceHistorySetMap){let e=await d.selectByQListIdAndCreateAt(r,n.practiceHistory.getCreateAt());if(e){let t=(await a.selectByPracticeHistoryId(e.getId())).map(e=>e.getQuestionId());for(let r of n.ansHistories.filter(e=>!t.includes(e.getQuestionId())))r.setPracticeHistoryId(e.getId()),0!==r.getQuestionId()?await a.insert(r.generateRow()):console.info(`QuestionId\u{304C}0\u{306E}AnsHistory\u{306F}\u{30B9}\u{30AD}\u{30C3}\u{30D7}\u{3055}\u{308C}\u{307E}\u{3057}\u{305F}: ${JSON.stringify(r)}`)}else await eq(r,n)}}else{let e=await o.insert(t.qList.generateRow());for(let[r,a]of t.practiceHistorySetMap)await eq(e,a)}}}async function eq(e,t){let r=t.practiceHistory;r.setQListId(e);let n=await d.insert(r.generateRow());for(let e of t.ansHistories)e.setPracticeHistoryId(n),0!==e.getQuestionId()?await a.insert(e.generateRow()):console.info(`QuestionId\u{304C}0\u{306E}AnsHistory\u{306F}\u{30B9}\u{30AD}\u{30C3}\u{30D7}\u{3055}\u{308C}\u{307E}\u{3057}\u{305F}: ${JSON.stringify(e)}`)}function eA(e){let t=[],r="",a=!1;for(let n=0;n<e.length;n++){let s=e[n];a?'"'===s?n+1<e.length&&'"'===e[n+1]?(r+='"',n++):a=!1:r+=s:'"'===s?a=!0:","===s?(t.push(r),r=""):r+=s}return t.push(r),t}function eS(e,t){let r;e.addEventListener("input",()=>{r&&window.clearTimeout(r),r=window.setTimeout(()=>t(e.value),300)}),e.addEventListener("blur",()=>t(e.value))}async function eD(){let e=await W(),t=document.getElementById("qListContainer");t&&(t.innerHTML="",t.appendChild(e))}async function eQ(e=1){let t=await U(e),r=t.querySelector("#paginationContentForQuestions");r&&r.addEventListener("pageChange",e=>{eQ(e.detail.page)});let a=document.getElementById("questionContainer");a&&(a.innerHTML="",a.appendChild(t))}async function eB(){let e=document.getElementById("searchDetailContainer"),t=document.getElementById("toggleSearchDetailLabel"),r=document.getElementById("toggleSearchDetailIcon");if(e&&t&&r)if(e.classList.contains("hidden")){e.replaceChildren();let a=await es();e.appendChild(a),e.classList.remove("hidden"),t.textContent="詳細検索を隠す",r.classList.add("rotate-180"),a.querySelector("#hideDetailedSearchBtn")?.addEventListener("click",()=>{eB()})}else document.getElementById("questionListContainer")?.scrollIntoView({behavior:"smooth"}),e.classList.add("hidden"),t.textContent="詳細検索を表示",r.classList.remove("rotate-180")}async function eH(){let e=document.getElementById("practiceHistoryList"),t=document.getElementById("practiceHistoryForQListBtn"),r=document.getElementById("practiceHistoryForQuestionBtn");if(e&&t&&r){e.innerHTML="";let a=await ee();e.appendChild(a),e_(t,r)}M()}async function eR(){let e=document.getElementById("practiceHistoryList"),t=document.getElementById("practiceHistoryForQListBtn"),r=document.getElementById("practiceHistoryForQuestionBtn");if(e&&t&&r){e.innerHTML="";let a=await ea();e.appendChild(a),e_(r,t)}M()}function e_(e,t){let r=["text-blue-600","dark:text-blue-400","border-b-2","border-blue-600","dark:border-blue-400"],a=["text-gray-600","dark:text-gray-300","hover:text-blue-600","dark:hover:text-blue-400"];e.classList.remove(...a),e.classList.add(...r),t.classList.remove(...r),t.classList.add(...a)}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("menuBtn"),t=document.getElementById("sideMenuCloseBtn"),r=document.getElementById("practiceHistoryForQListBtn"),a=document.getElementById("practiceHistoryForQuestionBtn");e?.addEventListener("click",async()=>{await eH()}),r?.addEventListener("click",async()=>{await eH()}),a?.addEventListener("click",async()=>{await eR()}),t?.addEventListener("click",()=>{F()}),document.getElementById("settingBtn").addEventListener("click",()=>{let e,t,r,a,n,s,i,d,l,o,c,u;B.setModal(((e=document.createElement("div")).className="bg-white dark:bg-gray-800 p-6 shadow rounded mb-4 space-y-6 w-full max-w-4xl mx-auto",(t=document.createElement("p")).className="text-lg font-medium text-gray-700 dark:text-gray-300 mb-2 border-b-4 dark:border-gray-700",t.textContent="設定",e.appendChild(t),(r=document.createElement("div")).className="space-y-2",(a=document.createElement("label")).className="block text-md font-medium text-gray-700 dark:text-gray-300",a.textContent="テーマ設定",r.appendChild(a),(n=document.createElement("div")).className="flex space-x-4",[{value:eb.LIGHT,label:"ライト"},{value:eb.DARK,label:"ダーク"}].forEach(e=>{let t=document.createElement("label");t.className="inline-flex items-center cursor-pointer";let r=document.createElement("input");r.type="radio",r.name="theme",r.value=e.value,r.className="form-radio text-blue-600",e.value===ef()&&(r.checked=!0),r.addEventListener("click",()=>{r.checked&&ew(e.value)}),t.appendChild(r);let a=document.createElement("span");a.className="ml-2 text-sm text-gray-700 dark:text-gray-300",a.textContent=e.label,t.appendChild(a),n.appendChild(t)}),r.appendChild(n),e.appendChild(r),(s=document.createElement("div")).className="space-y-4",(i=document.createElement("label")).className="block text-md font-medium text-gray-700 dark:text-gray-300",i.textContent="解答履歴",s.appendChild(i),(d=document.createElement("div")).className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden",e.appendChild(d),l=new D(d),(o=document.createElement("button")).type="button",o.className="w-full px-4 py-2 bg-red-500 dark:bg-red-600 text-white rounded hover:bg-red-600 dark:hover:bg-red-700 focus:outline-none",o.textContent="データ削除",o.addEventListener("click",()=>{let e=document.createElement("div");e.className="bg-white dark:bg-gray-800 p-6 rounded shadow-lg max-w-sm w-full";let t=document.createElement("p");t.className="text-lg font-medium text-gray-800 dark:text-gray-100 mb-4",t.textContent="IndexedDB のデータを削除します。よろしいですか？",e.appendChild(t);let r=document.createElement("div");r.className="flex justify-end space-x-4";let a=document.createElement("button");a.className="px-4 py-2 bg-red-500 dark:bg-red-600 text-white rounded hover:bg-red-600 dark:hover:bg-red-700 focus:outline-none",a.textContent="削除",a.addEventListener("click",async()=>{a.disabled=!0,await h().then(()=>{alert("DBを削除しました。")}).catch(e=>{console.log(e)}),a.disabled=!1,l.hide()}),r.appendChild(a),e.appendChild(r),l.setModal(e,S.DEFAULT)}),s.appendChild(o),(c=document.createElement("button")).type="button",c.className="w-full px-4 py-2 bg-green-500 dark:bg-green-600 text-white rounded hover:bg-green-600 dark:hover:bg-green-700 focus:outline-none",c.textContent="データエクスポート",c.addEventListener("click",async()=>{await eN()}),s.appendChild(c),(u=document.createElement("button")).type="button",u.className="w-full px-4 py-2 bg-green-500 dark:bg-green-600 text-white rounded hover:bg-green-600 dark:hover:bg-green-700 focus:outline-none",u.textContent="データインポート",u.addEventListener("click",async()=>{let e,t,r,a,n,s;l.setModal(((e=document.createElement("div")).className="p-6 rounded shadow-lg w-full bg-white dark:bg-gray-800 space-y-4",(t=document.createElement("h1")).textContent="CSV インポート",t.className="text-2xl font-bold text-gray-900 dark:text-gray-100",e.appendChild(t),(r=document.createElement("div")).className="rounded hidden p-2 font-bold text-green-700 dark:text-green-200 border-2 border-green-800 dark:border-green-200",r.innerHTML="正常にインポートが完了しました。<br>ページを再読み込みしてください。",e.appendChild(r),(a=document.createElement("div")).className="rounded hidden p-2 font-bold text-red-700 dark:text-red-200 border-2 border-red-800 dark:border-red-200",e.appendChild(a),(n=document.createElement("input")).type="file",n.id="csvFileInput",n.className="block w-full text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700 focus:outline-none",(s=document.createElement("button")).textContent="インポート実行",s.id="importButton",s.className="w-full bg-blue-500 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-800 text-white font-bold py-2 px-4 rounded",s.disabled=!0,n.addEventListener("change",()=>{n.files&&n.files.length>0&&n.files[0].name.toLowerCase().endsWith(".csv")?s.disabled=!1:s.disabled=!0}),s.addEventListener("click",async()=>{if(!n.files||0===n.files.length)return void console.error("CSVファイルが選択されていません");let e=n.files[0];try{await eL(e),r.classList.remove("hidden"),a.classList.add("hidden")}catch(e){console.error(e),r.classList.add("hidden"),a.classList.remove("hidden"),a.textContent=e instanceof Error?e.message:String(e)}}),e.appendChild(n),e.appendChild(s),e),S.LG)}),s.appendChild(u),e.appendChild(s),e.appendChild(function(){let e=document.createElement("div");e.className="space-y-4";let t=document.createElement("label");t.className="block text-md font-medium text-gray-700 dark:text-gray-300",t.textContent="Google Drive の問題データインポート",e.appendChild(t);let r=document.createElement("div");r.className="space-y-1";let a=document.createElement("label");a.className="block text-sm font-medium text-gray-700 dark:text-gray-300",a.htmlFor="client_id",a.textContent="client_id",r.appendChild(a);let n=document.createElement("input");n.type="text",n.id="client_id",n.name="client_id",n.autocomplete="off",n.placeholder="xxxx-xxxxx.apps.googleusercontent.com",n.className="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100",r.appendChild(n),e.appendChild(r);let s=document.createElement("div");s.className="space-y-1";let i=document.createElement("label");i.className="block text-sm font-medium text-gray-700 dark:text-gray-300",i.htmlFor="folderId",i.textContent="folderId",s.appendChild(i);let d=document.createElement("input");d.type="text",d.id="folderId",d.name="folderId",d.autocomplete="off",d.placeholder="Google Drive のフォルダID",d.className="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-100",s.appendChild(d),e.appendChild(s);let l=localStorage.getItem(ed);l&&(n.value=l);let o=localStorage.getItem(el);o&&(d.value=o),eS(n,eo),eS(d,ec),window.addEventListener("storage",e=>{e.key===ed&&"string"==typeof e.newValue&&(n.value=e.newValue),e.key===el&&"string"==typeof e.newValue&&(d.value=e.newValue)});let c=document.createElement("div");c.className="mt-2 flex justify-center";let u=document.createElement("button");return u.type="button",u.id="importProblemsBtn",u.className="w-full inline-flex items-center justify-center rounded-md border border-gray-300 px-4 py-2 text-sm font-medium bg-indigo-600 text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:border-gray-600",u.textContent="問題をインポート",u.addEventListener("click",async()=>{try{u.disabled=!0;let e=localStorage.getItem(ed)??"",t=localStorage.getItem(el)??"";if(!e)throw Error("client_id が未設定です。");if(!t)throw Error("folderId が未設定です。");await ey(e,t),eD(),eQ(),alert("問題のインポートが完了しました。"),u.disabled=!1}catch(e){console.error(e),alert(e.message||"インポート中にエラーが発生しました。"),u.disabled=!1}}),c.appendChild(u),e.appendChild(c),e}()),e),S.XXL)});let n=document.getElementById("defaultModal");n&&B.initModal(n);let s=document.getElementById("toggleDetailedSearchBtn");s?.addEventListener("click",async()=>{await eB()});let i=document.getElementById("questionSearchInput");i.addEventListener("change",()=>{j.query.word=i.value.trim()}),i.addEventListener("keydown",e=>{"Enter"===e.key&&eQ()});let d=document.getElementById("questionCaseSensitiveCheckbox");d.addEventListener("change",()=>{j.query.wordCaseSensitive=d.checked});let c=document.getElementById("questionSearchBtn");c?.addEventListener("click",()=>{eQ()}),document.getElementById("createCustomQListBtn").addEventListener("click",()=>{B.setModal(function(){let e=[...j.questions],t=document.createElement("div");t.className="bg-white dark:bg-gray-800 p-6 shadow rounded mb-6";let r=document.createElement("div");r.className="mb-4";let a=document.createElement("h2");a.className="text-2xl font-bold text-gray-900 dark:text-gray-100",a.textContent="カスタム問題集の作成",r.appendChild(a);let n=document.createElement("p");n.className="mt-1 text-sm text-gray-600 dark:text-gray-300",n.textContent="設問一覧にて表示されている設問から問題集を作成します。",r.appendChild(n),t.appendChild(r);let s=document.createElement("div");s.className="mb-4";let i=document.createElement("label");i.className="block text-md font-medium text-gray-700 dark:text-gray-300 mb-2",i.setAttribute("for","customQListTitle"),i.textContent="問題集タイトル",s.appendChild(i);let d=document.createElement("input");d.type="text",d.id="customQListTitle",d.className="w-full p-2 rounded border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500",d.value=`\u{30AB}\u{30B9}\u{30BF}\u{30E0}\u{554F}\u{984C}\u{96C6} ${y(new Date().toISOString())}`,s.appendChild(d),t.appendChild(s);let c=document.createElement("div");c.className="mb-6";let u=document.createElement("label");u.className="block text-md font-medium text-gray-700 dark:text-gray-300 mb-2",u.setAttribute("for","customQuestionCount"),u.textContent="出題する問題数",c.appendChild(u);let m=document.createElement("div");m.className="flex items-center";let h=document.createElement("select");h.id="customQuestionCount",h.className="flex-grow p-2 rounded border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500",[5,10,20,30,40,50,65,100,9999].forEach(e=>{let t=document.createElement("option");t.value=e.toString(),t.textContent=`${e}\u{554F}`,h.appendChild(t)}),h.value="50",m.appendChild(h);let p=document.createElement("span");p.className="ml-2 text-sm text-gray-600 dark:text-gray-300",p.textContent=` / ${e.length}`,m.appendChild(p),c.appendChild(m),t.appendChild(c);let x=document.createElement("div");x.className="space-y-4 mb-6";let b=R("shuffleQuestionsCheckbox","問題の出題順を並び替えるか");x.appendChild(b);let w=R("shuffleChoicesCheckbox","選択肢を並び替えるか");x.appendChild(w),t.appendChild(x);let C=document.createElement("button");if(C.className="w-full px-4 py-2 bg-blue-500 dark:bg-blue-600 text-white rounded hover:bg-blue-600 dark:hover:bg-blue-700",C.textContent="演習開始",0===e.length){C.disabled=!0,C.classList.add("disabled:cursor-not-allowed");let e=document.createElement("div");e.className="mb-2",e.innerHTML=`
      <div class="border border-red-400 dark:border-red-500 rounded bg-red-100 dark:bg-red-800 px-4 py-3 text-red-700 dark:text-red-100">
        <p>\u{51FA}\u{984C}\u{3059}\u{308B}\u{8A2D}\u{554F}\u{304C}\u{306A}\u{3044}\u{305F}\u{3081}\u{3001}\u{554F}\u{984C}\u{96C6}\u{3092}\u{4F5C}\u{6210}\u{3067}\u{304D}\u{307E}\u{305B}\u{3093}\u{3002}</p>
      </div>`,t.appendChild(e)}return C.addEventListener("click",async()=>{let t=document.getElementById("shuffleQuestionsCheckbox").checked,r=document.getElementById("shuffleChoicesCheckbox").checked,a=d.value.trim()||"カスタム問題集",n=parseInt(h.value,10);t&&g(e);let s=e.slice(0,n).map(e=>e.getId()),i=l.fromCreateNew(a,s,!1),c=await o.insert(i.generateRow());await f.createAndStartPractice(c,t,r,!0),B.hide(),V(),_()}),t.appendChild(C),t}(),S.XL)});let u=document.getElementById("prevQuestionBtn");u?.addEventListener("click",()=>{J()});let p=document.getElementById("nextQuestionBtn");p?.addEventListener("click",()=>{K()}),m().then(()=>{console.log("App is starting..."),eD(),eQ(),j.initQuery()}).catch(e=>{console.error("Failed to initialize database and migrate:",e)}),ex().then(async()=>{console.log("Google Drive API initialized successfully."),eD(),eQ()}).catch(e=>{console.error("Failed to initialize Google Drive API:",e)}),document.addEventListener("keydown",e=>{e.altKey&&"ArrowRight"===e.key?K():e.altKey&&"ArrowLeft"===e.key&&J()})});
//# sourceMappingURL=index.46a2d9ed.js.map
