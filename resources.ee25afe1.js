function e(e){return e&&e.__esModule?e.default:e}var t,i,s,a,n,r,o,l,d=globalThis,c={},u={},p=d.parcelRequiree581;null==p&&((p=function(e){if(e in c)return c[e].exports;if(e in u){var t=u[e];delete u[e];var i={id:e,exports:{}};return c[e]=i,t.call(i.exports,i,i.exports),i.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){u[e]=t},d.parcelRequiree581=p),(0,p.register)("426T3",function(e,t){var i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function a(e,t){if(!s[e]){s[e]={};for(var i=0;i<e.length;i++)s[e][e.charAt(i)]=i}return s[e][t]}var n={compressToBase64:function(e){if(null==e)return"";var i=n._compress(e,6,function(e){return t.charAt(e)});switch(i.length%4){default:case 0:return i;case 1:return i+"===";case 2:return i+"==";case 3:return i+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:n._decompress(e.length,32,function(i){return a(t,e.charAt(i))})},compressToUTF16:function(t){return null==t?"":n._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:n._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=n.compress(e),i=new Uint8Array(2*t.length),s=0,a=t.length;s<a;s++){var r=t.charCodeAt(s);i[2*s]=r>>>8,i[2*s+1]=r%256}return i},decompressFromUint8Array:function(t){if(null==t)return n.decompress(t);for(var i=Array(t.length/2),s=0,a=i.length;s<a;s++)i[s]=256*t[2*s]+t[2*s+1];var r=[];return i.forEach(function(t){r.push(e(t))}),n.decompress(r.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":n._compress(e,6,function(e){return i.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),n._decompress(e.length,32,function(t){return a(i,e.charAt(t))}))},compress:function(t){return n._compress(t,16,function(t){return e(t)})},_compress:function(e,t,i){if(null==e)return"";var s,a,n,r={},o={},l="",d="",c="",u=2,p=3,h=2,C=[],E=0,I=0;for(n=0;n<e.length;n+=1)if(l=e.charAt(n),Object.prototype.hasOwnProperty.call(r,l)||(r[l]=p++,o[l]=!0),d=c+l,Object.prototype.hasOwnProperty.call(r,d))c=d;else{if(Object.prototype.hasOwnProperty.call(o,c)){if(256>c.charCodeAt(0)){for(s=0;s<h;s++)E<<=1,I==t-1?(I=0,C.push(i(E)),E=0):I++;for(s=0,a=c.charCodeAt(0);s<8;s++)E=E<<1|1&a,I==t-1?(I=0,C.push(i(E)),E=0):I++,a>>=1}else{for(s=0,a=1;s<h;s++)E=E<<1|a,I==t-1?(I=0,C.push(i(E)),E=0):I++,a=0;for(s=0,a=c.charCodeAt(0);s<16;s++)E=E<<1|1&a,I==t-1?(I=0,C.push(i(E)),E=0):I++,a>>=1}0==--u&&(u=Math.pow(2,h),h++),delete o[c]}else for(s=0,a=r[c];s<h;s++)E=E<<1|1&a,I==t-1?(I=0,C.push(i(E)),E=0):I++,a>>=1;0==--u&&(u=Math.pow(2,h),h++),r[d]=p++,c=String(l)}if(""!==c){if(Object.prototype.hasOwnProperty.call(o,c)){if(256>c.charCodeAt(0)){for(s=0;s<h;s++)E<<=1,I==t-1?(I=0,C.push(i(E)),E=0):I++;for(s=0,a=c.charCodeAt(0);s<8;s++)E=E<<1|1&a,I==t-1?(I=0,C.push(i(E)),E=0):I++,a>>=1}else{for(s=0,a=1;s<h;s++)E=E<<1|a,I==t-1?(I=0,C.push(i(E)),E=0):I++,a=0;for(s=0,a=c.charCodeAt(0);s<16;s++)E=E<<1|1&a,I==t-1?(I=0,C.push(i(E)),E=0):I++,a>>=1}0==--u&&(u=Math.pow(2,h),h++),delete o[c]}else for(s=0,a=r[c];s<h;s++)E=E<<1|1&a,I==t-1?(I=0,C.push(i(E)),E=0):I++,a>>=1;0==--u&&(u=Math.pow(2,h),h++)}for(s=0,a=2;s<h;s++)E=E<<1|1&a,I==t-1?(I=0,C.push(i(E)),E=0):I++,a>>=1;for(;;){if(E<<=1,I==t-1){C.push(i(E));break}I++}return C.join("")},decompress:function(e){return null==e?"":""==e?null:n._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,i,s){var a,n,r,o,l,d,c,u=[],p=4,h=4,C=3,E="",I=[],T={val:s(0),position:i,index:1};for(a=0;a<3;a+=1)u[a]=a;for(r=0,l=4,d=1;d!=l;)o=T.val&T.position,T.position>>=1,0==T.position&&(T.position=i,T.val=s(T.index++)),r|=(o>0)*d,d<<=1;switch(r){case 0:for(r=0,l=256,d=1;d!=l;)o=T.val&T.position,T.position>>=1,0==T.position&&(T.position=i,T.val=s(T.index++)),r|=(o>0)*d,d<<=1;c=e(r);break;case 1:for(r=0,l=65536,d=1;d!=l;)o=T.val&T.position,T.position>>=1,0==T.position&&(T.position=i,T.val=s(T.index++)),r|=(o>0)*d,d<<=1;c=e(r);break;case 2:return""}for(u[3]=c,n=c,I.push(c);;){if(T.index>t)return"";for(r=0,l=Math.pow(2,C),d=1;d!=l;)o=T.val&T.position,T.position>>=1,0==T.position&&(T.position=i,T.val=s(T.index++)),r|=(o>0)*d,d<<=1;switch(c=r){case 0:for(r=0,l=256,d=1;d!=l;)o=T.val&T.position,T.position>>=1,0==T.position&&(T.position=i,T.val=s(T.index++)),r|=(o>0)*d,d<<=1;u[h++]=e(r),c=h-1,p--;break;case 1:for(r=0,l=65536,d=1;d!=l;)o=T.val&T.position,T.position>>=1,0==T.position&&(T.position=i,T.val=s(T.index++)),r|=(o>0)*d,d<<=1;u[h++]=e(r),c=h-1,p--;break;case 2:return I.join("")}if(0==p&&(p=Math.pow(2,C),C++),u[c])E=u[c];else{if(c!==h)return null;E=n+n.charAt(0)}I.push(E),u[h++]=n+E.charAt(0),p--,n=E,0==p&&(p=Math.pow(2,C),C++)}}};return n}();"function"==typeof define&&define.amd?define(function(){return i}):null!=e?e.exports=i:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return i})});let h={1:{key:"triangle",className:"bi-triangle-fill"},2:{key:"star",className:"bi-star-fill"},3:{key:"heart",className:"bi-heart-fill"}};var C=((t={}).PRACTICE="PRACTICE",t.QUESTION="QUESTION",t),E=((i={}).SETTING="SETTING",i.PRACTICE_START="PRACTICE_START",i.QLIST_EDIT="QLIST_EDIT",i.QUESTION_DETAIL="QUESTION_DETAIL",i),I=((s={}).DEFAULT="md",s.LG="lg",s.XL="xl",s.XXL="4xl",s.FULL="full",s),T=((a={}).LIGHT="light",a.DARK="dark",a),_=((n={}).SUCCESS="success",n.ERROR="error",n);let S={theme:T.LIGHT,toastMessages:[],googleClientId:null,googleFolderId:null,defailtModalKind:null,preparePracticeStart:null,editQList:null,questionDetailDto:null,qLists:[],qListSearchForm:{standardOnly:!0,currentPage:0,totalSize:0,pages:[]},questions:[],questionSearchForm:{isQListName:!1,keyword:"",isCaseSensitive:!1,correctRate:0,answerDateFrom:null,answerDateTo:null,unansweredFrom:null,unansweredTo:null,checkedFavorites:[],currentPage:0,totalSize:0,pages:[]},practiceDetailDto:null,historyActiveTab:C.PRACTICE,practiceHistoryDtos:[],practiceHistorySearchForm:{currentPage:0,totalSize:0,pages:[]},ansHistoryDtos:[],ansHistorySearchForm:{currentPage:0,totalSize:0,pages:[]}};class m{constructor(e,t,i,s,a,n){e&&(this.id=e),this.practiceHistoryId=t,this.questionId=i,this.isCorrect=s,this.selectChoice=a,this.answerDate=n}static fromRow(e){return new m(e.id,e.practice_history_id,e.question_id,e.is_correct,e.select_choice,e.answer_date)}static fromRequiredArgs(e,t,i,s,a){return new m(void 0,e,t,i,s,a)}setId(e){this.id=e}setPracticeHistoryId(e){this.practiceHistoryId=e}setQuestionId(e){this.questionId=e}setIsCorrect(e){this.isCorrect=e}setSelectChoice(e){this.selectChoice=e}setAnswerDate(e){this.answerDate=e}getId(){return this.id}getPracticeHistoryId(){return this.practiceHistoryId}getQuestionId(){return this.questionId}getIsCorrect(){return this.isCorrect}getSelectChoice(){return this.selectChoice}getAnswerDate(){return this.answerDate}generateRow(){let e={practice_history_id:this.practiceHistoryId,question_id:this.questionId,is_correct:this.isCorrect,select_choice:this.selectChoice,answer_date:this.answerDate};return void 0!==this.id&&(e.id=this.id),e}}class A{constructor(e,t,i){e&&(this.id=e),this.questionId=t,this.tagId=i}static fromRow(e){return new A(e.id,e.question_id,e.tag_id)}static fromRequiredArgs(e,t){return new A(void 0,e,t)}generateRow(){let e={question_id:this.questionId,tag_id:this.tagId};return void 0!==this.id&&(e.id=this.id),e}setId(e){this.id=e}setQuestionId(e){this.questionId=e}setTagId(e){this.tagId=e}getId(){return this.id}getQuestionId(){return this.questionId}getTagId(){return this.tagId}}class g{constructor(e,t,i,s,a,n,r){e&&(this.id=e),this.qListId=t,this.isReview=i,this.isAnswered=s,this.isRandomQ=a,this.isRandomC=n,this.createAt=r}static fromRow(e){return new g(e.id,e.q_list_id,e.is_review,e.is_answered,e.is_random_q,e.is_random_c,e.create_at)}static fromRequiredArgs(e,t,i,s){return new g(void 0,e,t,!1,i,s,new Date().toISOString())}static fromCsvRow(e,t,i,s,a,n){return new g(void 0,e,t,i,s,a,n)}setId(e){this.id=e}setQListId(e){this.qListId=e}setIsAnswered(e){this.isAnswered=e}getId(){return this.id}getQListId(){return this.qListId}getIsReview(){return this.isReview}getIsAnswered(){return this.isAnswered}getIsRandomQ(){return this.isRandomQ}getIsRandomC(){return this.isRandomC}getCreateAt(){return this.createAt}generateRow(){let e={q_list_id:this.qListId,is_review:this.isReview,is_answered:this.isAnswered,is_random_q:this.isRandomQ,is_random_c:this.isRandomC,create_at:this.createAt};return void 0!==this.id&&(e.id=this.id),e}}class R{constructor(e,t,i,s,a){e&&(this.id=e),this.uuid=t,this.name=i,this.questions=s,this.isDefault=a}static fromRow(e){return new R(e.id,e.uuid,e.name,e.questions,e.is_default)}static fromRequiredArgs(e,t,i,s){return new R(void 0,e,t,i,s)}static fromCreateNew(e,t,i){return new R(void 0,crypto.randomUUID(),e,t,i)}setId(e){this.id=e}setUuid(e){this.uuid=e}setName(e){this.name=e}setQuestions(e){this.questions=e}setIsDefault(e){this.isDefault=e}getId(){return this.id}getUuid(){return this.uuid}getName(){return this.name}getQuestions(){return this.questions}getIsDefault(){return this.isDefault}generateRow(){let e={uuid:this.uuid,name:this.name,questions:this.questions,is_default:this.isDefault};return void 0!==this.id&&(e.id=this.id),e}getIndexOfQuestionId(e){return this.questions?this.questions.indexOf(e):-1}}class f{constructor(e){this.id=e.id,this.url=e.url,this.problem=e.problem,this.choice=e.choice,this.selectionFormat=e.selectionFormat,this.answer=e.answer,this.explanation=e.explanation}setId(e){this.id=e}setUrl(e){this.url=e}setProblem(e){this.problem=e}setChoice(e){this.choice=e}setSelectionFormat(e){this.selectionFormat=e}setAnswer(e){this.answer=e}setExplanation(e){this.explanation=e}getId(){return this.id}getUrl(){return this.url}getProblem(){return this.problem}getChoice(){return this.choice}getSelectionFormat(){return this.selectionFormat}getAnswer(){return this.answer}getExplanation(){return this.explanation}}let L="oqoa";class D{constructor(e){this.storeName=e}openDB(){return new Promise((e,t)=>{let i=indexedDB.open(L,2);i.onupgradeneeded=e=>{this.initStore(e)},i.onsuccess=t=>{e(t.target.result)},i.onerror=e=>{t(e.target.error)}})}async insert(e){let t=await this.openDB();return new Promise((i,s)=>{let a=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).add(e);a.onsuccess=()=>i(a.result),a.onerror=()=>s(a.error)})}async update(e){let t=await this.openDB();return new Promise((i,s)=>{let a=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(e);a.onsuccess=()=>i(a.result),a.onerror=()=>s(a.error)})}async deleteById(e){let t=await this.openDB();return new Promise((i,s)=>{let a=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);a.onsuccess=()=>i(a.result),a.onerror=()=>s(a.error)})}async selectById(e){let t=await this.openDB();return new Promise((i,s)=>{let a=t.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);a.onsuccess=e=>{let t=e.target.result;void 0!==t?i(this.convertRow(t)):s(Error("No data found"))},a.onerror=()=>s(a.error)})}async selectAll(){let e=await this.openDB();return new Promise((t,i)=>{let s=e.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();s.onsuccess=e=>{t(e.target.result.map(e=>this.convertRow(e)))},s.onerror=()=>i(s.error)})}async selectExample(e,t){let i=await this.openDB();return new Promise((s,a)=>{let n=i.transaction([this.storeName],"readonly").objectStore(this.storeName).index(e).getAll(t);n.onsuccess=e=>{s(e.target.result.map(e=>this.convertRow(e)))},n.onerror=()=>a(n.error)})}}let y=new class extends D{constructor(){super("q_list")}initStore(e){let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});e.createIndex("uuid","uuid",{unique:!1}),e.createIndex("name","name",{unique:!1}),e.createIndex("questions","questions",{unique:!1,multiEntry:!0}),e.createIndex("is_default","is_default",{unique:!1})}}convertRow(e){return R.fromRow(e)}async bulkInsert(e){let t=new Set((await this.selectAll()).map(e=>e.getUuid())),i=0,s=0;for(let a of e){let e=a.getUuid();if(t.has(e)){s++;continue}await this.insert(a.generateRow()),t.add(e),i++}return console.info(`QListDB.bulkInsert: inserted=${i}, skipped=${s}`),{inserted:i,skipped:s}}async selectByStandard(){return(await this.selectAll()).filter(e=>e.getIsDefault())}async selectByUuid(e){let t=await this.selectExample("uuid",e);if(0!==t.length)return t[0]}async selectByNameAndQuestions(e,t){let i=(await this.selectExample("name",e)).filter(e=>{let i=e.getQuestions();return i.length===t.length&&i.every((e,i)=>e===t[i])});if(0!==i.length)return i[0]}async selectByWord(e,t){return(await this.selectAll()).filter(i=>!!i.getIsDefault()&&(t?i.getName().includes(e):i.getName().toLocaleLowerCase().includes(e.toLocaleLowerCase())))}},P=new class{bulkInsert(e){try{let t=new Set(this.questions.map(e=>e.getId())),i=0,s=0;for(let a of e){let e=a.getId();if(t.has(e)){s++;continue}this.questions.push(a),t.add(e),i++}this.questions.sort((e,t)=>e.getId()-t.getId()),console.info(`bulkInsert: inserted=${i}, skipped=${s}, total=${this.questions.length}`)}catch(e){throw console.error("Error in bulkInsert:",e),e}}selectAll(){return this.questions}selectById(e){return this.questions.find(t=>t.getId()===e)}selectByWord(e,t=!1){return this.questions.filter(i=>t?i.getId().toString().includes(e)||i.getProblem().includes(e)||i.getChoice().join().includes(e)||i.getExplanation().includes(e):i.getId().toString().includes(e.toLowerCase())||i.getProblem().toLowerCase().includes(e.toLowerCase())||i.getChoice().join().toLowerCase().includes(e.toLowerCase())||i.getExplanation().toLowerCase().includes(e.toLowerCase()))}constructor(){this.questions=[]}},w=new class extends D{constructor(){super("ans_history")}initStore(e){let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});e.createIndex("practice_history_id","practice_history_id",{unique:!1}),e.createIndex("question_id","question_id",{unique:!1}),e.createIndex("is_current","is_current",{unique:!1}),e.createIndex("select_choice","select_choice",{unique:!1,multiEntry:!0}),e.createIndex("answer_date","answer_date",{unique:!1})}}convertRow(e){return m.fromRow(e)}async selectByPracticeHistoryId(e){return await this.selectExample("practice_history_id",e)}async selectByQuestionId(e){return await this.selectExample("question_id",e)}async selectAllOrderDesc(){return(await this.selectAll()).sort((e,t)=>t.getId()-e.getId())}async hasAnsHistory(e,t){return(await this.selectExample("practice_history_id",e)).some(e=>e.getQuestionId()===t)}async hasCorrectAnsHistory(e,t){return(await this.selectExample("practice_history_id",e)).some(e=>e.getIsCorrect()&&e.getQuestionId()===t)}async deleteByPracticeHistoryId(e){for(let t of(await this.selectExample("practice_history_id",e)))await this.deleteById(t.getId())}},O=new class extends D{constructor(){super("practice_history")}initStore(e){let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});e.createIndex("q_list_id","q_list_id",{unique:!1}),e.createIndex("is_review","is_review",{unique:!1}),e.createIndex("is_answered","is_answered",{unique:!1}),e.createIndex("is_random_q","is_random_q",{unique:!1}),e.createIndex("is_random_c","is_random_c",{unique:!1}),e.createIndex("create_at","create_at",{unique:!1})}}convertRow(e){return g.fromRow(e)}async selectAllOrderDesc(){return(await this.selectAll()).sort((e,t)=>Date.parse(t.getCreateAt())-Date.parse(e.getCreateAt()))}async selectByQListId(e){return await this.selectExample("q_list_id",e)}async selectByQListIdAndCreateAt(e,t){let i=(await this.selectByQListId(e)).filter(e=>e.getCreateAt()===t);if(0!==i.length)return i[0]}};function v(e,t,i){let s=document.createElement(e);if("string"==typeof t||void 0===t)return t&&(s.className=t),void 0!==i&&(s.textContent=i),s;let{id:a,text:n,attr:r}=t,o=t.class;if(a&&(s.id=a),o&&(s.className=o),void 0!==n&&(s.textContent=n),r)for(let e of r)for(let[t,i]of Object.entries(e))s.setAttribute(t,i);return s}class q{constructor(e){this.modalElem=e,this.isShown=!1,void 0!==e&&(this.modalElem=e)}setModal(e,t,i=I.DEFAULT,s=!0,a=!0,n=!0){this.setModalContent(e,t),this.setModalFade(a),this.setModalSize(i),this.isShown&&this.hide(),s&&this.show(),n&&this.modalElem.addEventListener("click",this.handleOutsideClick.bind(this))}setModalContent(e,t){let i=v("div","app-modal");i.appendChild(this.generateHeader(t)),i.appendChild(e),this.modalElem.innerHTML="",this.modalElem.appendChild(i)}setModalSize(e){let t=this.modalElem.firstElementChild;if(t)switch(t.classList.forEach(e=>{(e.startsWith("max-w-")||"w-full"===e)&&t.classList.remove(e)}),e){case I.LG:t.classList.add("w-full","max-w-lg");break;case I.XL:t.classList.add("w-full","max-w-xl");break;case I.XXL:t.classList.add("w-full","max-w-4xl");break;case I.FULL:t.classList.add("w-full");break;default:t.classList.add("w-full","max-w-64")}}setModalFade(e){e?this.modalElem?.classList.add("transition-opacity","duration-300"):this.modalElem?.classList.remove("transition-opacity","duration-300")}show(){this.modalElem.classList.remove("hidden"),document.body.classList.add("modal-open"),setTimeout(()=>{this.modalElem.classList.remove("opacity-0"),this.modalElem.classList.add("opacity-100")},10),this.isShown=!0}hide(){this.modalElem.classList.remove("opacity-100"),this.modalElem.classList.add("opacity-0"),setTimeout(()=>{this.modalElem.classList.add("hidden"),document.body.classList.remove("modal-open")},300),this.isShown=!1}handleOutsideClick(e){e.target===this.modalElem&&this.hide()}generateHeader(e){let t=v("div","app-modal-header"),i=v("h2","app-modal-title",e??"");t.appendChild(i);let s=v("button","app-modal-close");s.type="button";let a=v("i",{class:"bi bi-x-lg",attr:[{"aria-hidden":"true"}]}),n=v("span",{class:"sr-only",text:"閉じる"});return s.appendChild(a),s.appendChild(n),t.appendChild(s),s.addEventListener("click",()=>{this.hide()}),t}}function N(e,t,i=7){if(t<=0||i<=0)return[];if(1===t)return[0];let s=t-1,a=Math.min(Math.max(e,0),s);if(t<=i)return Array.from({length:t},(e,t)=>t);if(1===i)return[a];let n=i-2;if(n<=0)return[0,s];let r=a-Math.floor(n/2),o=r+n-1;return r<1&&(o=(r=1)+n-1),o>s-1&&(r=(o=s-1)-n+1),[0,...Array.from({length:o-r+1},(e,t)=>r+t),s]}function H(e,t,i,s,a,n){e.innerHTML="";let r=v("div","pagination");for(let e of i){let i=[{type:"button"},{"data-page":String(e)}];e===t&&i.push({"aria-current":"page"});let s=v("button",{class:"page-btn",text:String(e+1),attr:i});s.addEventListener("click",()=>{e!==t&&n(e)}),r.appendChild(s)}let o=v("div",{class:"pagination-total",text:`${s.toLocaleString()} / ${a.toLocaleString()} \u{4EF6}`});e.appendChild(r),e.appendChild(o)}function b(e){return{uuid:crypto.randomUUID(),kind:_.SUCCESS,message:e}}function U(e){return{uuid:crypto.randomUUID(),kind:_.ERROR,message:"string"==typeof e?e:e.message}}function Q(e){for(let t=e.length-1;t>0;t--){let i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}}function M(e){let t=new Date(e),i=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0"),o=String(t.getSeconds()).padStart(2,"0");return`${i}/${s}/${a} ${n}:${r}:${o}`}function k(e,t,i){if(!e)return!1;let s=new Date(e);if(Number.isNaN(s.getTime()))return!1;let a=null,n=null;if(t){let e=new Date(t.getTime());e.setHours(0,0,0,0),a=e}if(i){let e=new Date(i.getTime());e.setHours(23,59,59,999),n=e}let r=s.getTime();return!(a&&r<a.getTime()||n&&r>n.getTime())}let G=e=>e?e.replace(/<[^>]*>/g,"").replace(/&(?:[a-zA-Z][a-zA-Z0-9]+|#\d+|#x[0-9a-fA-F]+);/g,"").replace(/\s+/g," ").trim():"";async function F(e,t,i,s,a){let n=m.fromRequiredArgs(t,i,s,a,new Date().toISOString()),r=await w.insert(n.generateRow());return n.setId(r),e.questionDetailDtos.map(e=>(e.question.getId()===i&&(e.ansHistory=n,e.ansHistories.push(n)),e)),e}async function x(e,t,i){let s=(await w.selectByPracticeHistoryId(t)).find(e=>e.getQuestionId()===i);return s?(await w.deleteById(s.getId()),e.questionDetailDtos.map(e=>(e.question.getId()===i&&(e.ansHistory=null,e.ansHistories.filter(e=>e.getId()!==s.getId())),e)),{practiceDetailDto:e,toastMessage:b("回答を取り消ししました。")}):{practiceDetailDto:e,toastMessage:U("取り消す回答が存在しません。")}}async function B(e){let t=await w.selectAllOrderDesc(),i=Math.floor(t.length/25)+ +(t.length%25!=0),s=i<=e.currentPage?0:e.currentPage,a=25*s,n=t.slice(a,a+25),r=(await Promise.all(n.map(async e=>{let t=await O.selectById(e.getPracticeHistoryId()),i=await y.selectById(t.getQListId()),s=P.selectById(e.getQuestionId());if(s)return{ansHistory:e,qList:i,question:s}}))).filter(e=>void 0!==e),o=N(s,i);return{ansHistoryDtos:r,currentPage:s,totalSize:t.length,pages:o}}let K=new class extends D{constructor(){super("favorite")}initStore(e){let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});e.createIndex("question_id","question_id",{unique:!1}),e.createIndex("tag_id","tag_id",{unique:!1})}}convertRow(e){return A.fromRow(e)}async selectByQuestionId(e){return await this.selectExample("question_id",e)}async selectByTagId(e){return await this.selectExample("tag_id",e)}async selectByQuestionIdAndTagId(e,t){return(await this.selectExample("question_id",e)).find(e=>e.getTagId()===t)}};async function $(e,t,i,s){let a=await K.selectByQuestionIdAndTagId(e,t);if(i&&!a?await K.insert(A.fromRequiredArgs(e,t).generateRow()):!i&&a&&await K.deleteById(a.getId()),s){let t=await K.selectByQuestionId(e);s.questionDetailDtos.map(i=>(i.question.getId()===e&&(i.favorites=t),i))}return s}async function W(e,t){let i=`https://www.googleapis.com/drive/v3/files/${encodeURIComponent(t)}?fields=id,name,mimeType,modifiedTime,size,fileExtension,shortcutDetails`,s=await fetch(i,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok){let e=await s.text().catch(()=>"");throw Error(`files.get(meta) failed: ${s.status} ${s.statusText} ${e}`)}return s.json()}async function V(e,t){let i,s=[],a=encodeURIComponent(`'${t}' in parents and trashed = false`);do{let t=`https://www.googleapis.com/drive/v3/files?q=${a}&fields=nextPageToken,files(id,name,mimeType,modifiedTime,size,fileExtension,shortcutDetails)&orderBy=name`+(i?`&pageToken=${encodeURIComponent(i)}`:""),n=await fetch(t,{headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw Error("フォルダーが見つかりませんでした。");let r=await n.json();r.files?.length&&s.push(...r.files),i=r.nextPageToken}while(i)return s}async function z(e,t){if("application/vnd.google-apps.shortcut"===t.mimeType&&t.shortcutDetails?.targetId){let i=await W(e,t.shortcutDetails.targetId);return i.mimeType.startsWith("application/vnd.google-apps.")?null:{id:i.id,name:i.name,mimeType:i.mimeType}}return t.mimeType.startsWith("application/vnd.google-apps.")?null:{id:t.id,name:t.name,mimeType:t.mimeType}}async function Y(e,t){let i=await fetch(`https://www.googleapis.com/drive/v3/files/${encodeURIComponent(t)}?alt=media`,{headers:{Authorization:`Bearer ${e}`}});if(!i.ok){let e=await i.text().catch(()=>"");throw Error(`files.get (alt=media) failed: ${i.status} ${i.statusText} ${e}`)}return i.json()}async function X(e,t){let i=await V(e,t),s=(await Promise.all(i.map(t=>z(e,t)))).filter(e=>!!e).filter(e=>"application/json"===e.mimeType||"application/octet-stream"===e.mimeType);return await Promise.all(s.map(async t=>{let s=await Y(e,t.id),a=i.find(e=>e.id===t.id||e.shortcutDetails?.targetId===t.id);return{id:t.id,name:t.name,mimeType:t.mimeType,modifiedTime:a?.modifiedTime,content:s}}))}var j=p("426T3");let Z="oqoa-theme",J="oqoa-google-client-id",ee="oqoa-google-folder-id",et="oqoa-last-imported-data",ei="oqoa-last-used-questions";function es(t){let i=JSON.stringify(t),s=e(j).compressToUTF16(i);localStorage.setItem(ei,s)}async function ea(e,t){try{var i;let s=await new Promise((t,i)=>{try{google.accounts.oauth2.initTokenClient({client_id:e,scope:"https://www.googleapis.com/auth/drive.readonly",callback:e=>{e&&e.access_token?t(e.access_token):i(Error("アクセストークンの取得に失敗しました。"))}}).requestAccessToken()}catch(e){i(e)}}),a=await X(s,t);if(!a.length)return{uuid:crypto.randomUUID(),message:"対象フォルダに JSON ファイルが見つかりませんでした。",kind:_.SUCCESS};let{questions:n,qLists:r}=function(e){let t=new Map,i=[];for(let s of e)if(s&&"object"==typeof s){if(Array.isArray(s.questions))for(let e of s.questions)e&&"object"==typeof e&&"number"==typeof e.id&&t.set(e.id,new f(e));if(Array.isArray(s.qLists))for(let e of s.qLists){if(!e||"string"!=typeof e.name||!Array.isArray(e.questions))continue;let t=R.fromRow(e);i.push(t)}}return{questions:Array.from(t.values()),qLists:i}}(a.map(e=>e.content));return console.info(`Imported: questions=${n.length}, qLists=${r.length}`),P.bulkInsert(n),es(P.selectAll()),i=new Date,localStorage.setItem(et,i.toISOString()),await y.bulkInsert(r),{uuid:crypto.randomUUID(),message:"問題のインポートが完了しました。",kind:_.SUCCESS}}catch(e){return{uuid:crypto.randomUUID(),message:String(e),kind:_.ERROR}}}async function en(){return new Promise((e,t)=>{let i=indexedDB.open(L,2);i.onupgradeneeded=e=>{w.initStore(e),K.initStore(e),O.initStore(e),y.initStore(e)},i.onsuccess=()=>{e()},i.onerror=()=>{t(i.error)}})}async function er(e,t=25){let i=await el(e),s=Math.floor(i.length/t)+ +(i.length%t!=0),a=s<=e.currentPage?0:e.currentPage,n=a*t,r=i.slice(n,n+t),o=N(a,s);return{questions:r,currentPage:a,totalSize:i.length,pages:o}}async function eo(e,t){return[...new Set((await y.selectByWord(e,t)).flatMap(e=>e.getQuestions()))].map(e=>P.selectById(e)).filter(e=>null!=e)}async function el(e){var t,i,s=e;let a=[],n=null!==s.answerDateFrom||null!==s.answerDateTo,r=null!==s.unansweredFrom||null!==s.unansweredTo;if(n&&r&&a.push("解答期間と未解答期間は同時に指定できません。"),r&&0!==s.correctRate&&a.push("未解答期間を指定する場合、正答率は 指定なし でなければなりません。"),0!==a.length)throw Error(a.join("<br>"));let{correctRate:o,answerDateFrom:l,answerDateTo:d,unansweredFrom:c,unansweredTo:u,checkedFavorites:p}=e,h=e.isQListName?await eo(e.keyword,e.isCaseSensitive):(t=e.keyword,i=e.isCaseSensitive,""===t?P.selectAll():P.selectByWord(t,i));if(0===o&&null===l&&null===d&&null===c&&null===d&&0===p.length)return h;let C=!!(l||d),E=!!(c||u),I=await Promise.all(h.map(async e=>{let t=await w.selectByQuestionId(e.getId()),i=await K.selectByQuestionId(e.getId());return{question:e,ansHistories:t,favorites:i}}));return C&&(I=I.map(({question:e,ansHistories:t,favorites:i})=>({question:e,ansHistories:t.filter(e=>k(e.getAnswerDate(),l,d)),favorites:i})).filter(({ansHistories:e})=>e.length>0)),E&&(I=I.filter(({ansHistories:e})=>!e.some(e=>k(e.getAnswerDate(),c,u)))),o>0&&(I=I.filter(({ansHistories:e})=>{var t;return(0===(t=e).length?100:t.filter(e=>e.getIsCorrect()).length/t.length*100)<=o})),0!==p.length&&(I=I.filter(({favorites:e})=>p.some(t=>e.map(e=>e.getTagId()).includes(t)))),I.map(e=>e.question)}async function ed(e,t){let i=P.selectById(e);if(!i)throw Error(`Question not found: id=${e}`);let s=await w.selectByQuestionId(e);return{question:i,ansHistory:s.find(e=>e.getPracticeHistoryId()===t)??null,ansHistories:s,favorites:await K.selectByQuestionId(e)}}async function ec(e,t,i,s=!1){let a=g.fromRequiredArgs(e.getId(),s,t,i),n=await O.insert(a.generateRow());a.setId(n);let r=await Promise.all(e.getQuestions().map(e=>ed(e,n)));t&&Q(r);let o=0<r.length?0:-1;return{practiceHistory:a,qList:e,questionDetailDtos:r,currentQuestionIndex:o}}async function eu(e,t,i,s){let a,n=(t?(Q(a=[...e.questionIds]),a):e.questionIds).slice(0,s),r=R.fromCreateNew(e.name,n,!1),o=await y.insert(r.generateRow());return r.setId(o),ec(r,t,i,e.isReview)}async function ep(e){let t=await O.selectById(e),i=await y.selectById(t.getQListId()),s=await Promise.all(i.getQuestions().map(t=>ed(t,e))),a=[],n=[];s.forEach(e=>{e.ansHistory?a.push(e):n.push(e)}),t.getIsRandomQ()&&Q(n);let r=0!==n.length?a.length:a.length-1;return{practiceHistory:t,qList:i,questionDetailDtos:[...a,...n],currentQuestionIndex:r}}async function eh(e){if(e.questionDetailDtos.filter(e=>null===e.ansHistory).length>0)throw Error("全ての問題を解き終えていません");return e.practiceHistory.setIsAnswered(!0),await O.update(e.practiceHistory.generateRow()),e}async function eC(e){let t=await O.selectAllOrderDesc(),i=Math.floor(t.length/25)+ +(t.length%25!=0),s=i<=e.currentPage?0:e.currentPage,a=25*s,n=t.slice(a,a+25),r=await Promise.all(n.map(async e=>{let t=await y.selectById(e.getQListId());return{practiceHistory:e,qList:t}})),o=N(s,i);return{practiceHistoryDtos:r,currentPage:s,totalSize:t.length,pages:o}}async function eE(e){let t=e.standardOnly?await y.selectByStandard():await y.selectAll(),i=Math.floor(t.length/12)+ +(t.length%12!=0),s=i<=e.currentPage?0:e.currentPage,a=12*s,n=t.slice(a,a+12),r=N(s,i);return{qLists:n,currentPage:s,totalSize:t.length,pages:r}}async function eI(e,t,i){e.setName(t),e.setIsDefault(i),await y.update(e.generateRow())}async function eT(e){let t=await O.selectByQListId(e.getId());await Promise.all(t.map(async e=>{await w.deleteByPracticeHistoryId(e.getId()),await O.deleteById(e.getId())})),await y.deleteById(e.getId())}var e_=((r={}).INIT="INIT",r.OPEN_DEFAULT_MODAL="OPEN_DEFAULT_MODAL",r.SEARCH_HISTORY="SEARCH_HISTORY",r.DEFAULT_MODAL_SHOWN="DEFAULT_MODAL_SHOWN",r.TOAST_ADD="TOAST_ADD",r.TOAST_DISMISS_REQUESTED="TOAST_DISMISS_REQUESTED",r.CHANGE_THEME="CHANGE_THEME",r.CHANGE_GOOGLE_CLIENT_ID="CHANGE_GOOGLE_CLIENT_ID",r.CHANGE_GOOGLE_FOLDER_ID="CHANGE_GOOGLE_FOLDER_ID",r.IMPORT_GOOGLE_DRIVE_DATA="IMPORT_GOOGLE_DRIVE_DATA",r.REMOVE_LOCAL_STORAGE_QUESTION="REMOVE_LOCAL_STORAGE_QUESTION",r.UPDATE_QLIST_CONTAINER="UPDATE_QLIST_CONTAINER",r.UPDATE_QUESTION_LIST_CONTAINER="UPDATE_QUESTION_LIST_CONTAINER",r.SEARCH_QUESTION="SEARCH_QUESTION",r.CHANGE_QLIST_PAGE="CHANGE_QLIST_PAGE",r.CHANGE_QUESTIONS_PAGE="CHANGE_QUESTIONS_PAGE",r.PREPARE_PRACTICE_START="PREPARE_PRACTICE_START",r.SHOW_QLIST_EDIT="SHOW_QLIST_EDIT",r.SHOW_PRACTICE_START="SHOW_PRACTICE_START",r.SHOW_CUSTOM_PRACTICE_START="SHOW_CUSTOM_PRACTICE_START",r.UPDATE_QLIST="UPDATE_QLIST",r.PREPARE_PRACTICE="PREPARE_PRACTICE",r.SHOW_PRACTICE="SHOW_PRACTICE",r.PREPARE_QUESTION_DETAIL="PREPARE_QUESTION_DETAIL",r.SHOW_QUESTION_DETAIL="SHOW_QUESTION_DETAIL",r.PRACTICE_PREV="PRACTICE_PREV",r.PRACTICE_NEXT="PRACTICE_NEXT",r.COMPLETE_ANSWER="COMPLETE_ANSWER",r.PRACTICE_ANSWERED="PRACTICE_ANSWERED",r.PRACTICE_ANSWER_CANCELED="PRACTICE_ANSWER_CANCELED",r.UPDATE_PRACTICE_HISTORY_LIST_CONTAINER="UPDATE_PRACTICE_HISTORY_LIST_CONTAINER",r.UPDATE_ANS_HISTORY_LIST_CONTAINER="UPDATE_ANS_HISTORY_LIST_CONTAINER",r.CHANGE_HISTORY_PAGE="CHANGE_HISTORY_PAGE",r.PREPARE_EXIST_PRACTICE="PREPARE_EXIST_PRACTICE",r.TOGGLE_QLISTS_STANDARD_CHECK="TOGGLE_QLISTS_STANDARD_CHECK",r.PREPARE_CUSTOM_PRACTICE="PREPARE_CUSTOM_PRACTICE",r.UPDATE_FAVORITE="UPDATE_FAVORITE",r),eS=((o={}).INIT_REPOSITORY="INIT_REPOSITORY",o.UPDATE_THEME="UPDATE_THEME",o.UPDATE_GOOGLE_CLIENT_ID="UPDATE_GOOGLE_CLIENT_ID",o.UPDATE_GOOGLE_FOLDER_ID="UPDATE_GOOGLE_FOLDER_ID",o.IMPORT_GOOGLE_DRIVE="IMPORT_GOOGLE_DRIVE",o.REMOVE_LOCAL_STORAGE_QUESTION="REMOVE_LOCAL_STORAGE_QUESTION",o.SEARCH_QLIST="SEARCH_QLIST",o.SEARCH_QUESTION="SEARCH_QUESTION",o.PREPARE_PRACTICE_START="PREPARE_PRACTICE_START",o.UPDATE_QLIST="UPDATE_QLIST",o.PREPARE_PRACTICE="PREPARE_PRACTICE",o.PREPARE_EXIST_PRACTICE="PREPARE_EXIST_PRACTICE",o.PREPARE_QUESTION_DETAIL="PREPARE_QUESTION_DETAIL",o.COMPLETE_ANSWER="COMPLETE_ANSWER",o.PRACTICE_ANSWERED="PRACTICE_ANSWERED",o.PRACTICE_ANSWER_CANCELED="PRACTICE_ANSWER_CANCELED",o.SEARCH_PRACTICE_HISTORY="SEARCH_PRACTICE_HISTORY",o.SEARCH_ANS_HISTORY="SEARCH_ANS_HISTORY",o.PREPARE_CUSTOM_PRACTICE="PREPARE_CUSTOM_PRACTICE",o.UPDATE_FAVORITE="UPDATE_FAVORITE",o),em=((l={}).CLICK_SETTING_BTN="CLICK_SETTING_BTN",l.CLICK_MENU_BTN="CLICK_MENU_BTN",l.DEFAULT_MODAL_SHOWN="DEFAULT_MODAL_SHOWN",l.TOAST_DISMISS_REQUESTED="TOAST_DISMISS_REQUESTED",l.CHANGE_THEME="CHANGE_THEME",l.CHANGE_GOOGLE_CLIENT_ID="CHANGE_GOOGLE_CLIENT_ID",l.CHANGE_GOOGLE_FOLDER_ID="CHANGE_GOOGLE_FOLDER_ID",l.CLICK_GOOGLE_DRIVE_IMPORT_BTN="CLICK_GOOGLE_DRIVE_IMPORT_BTN",l.CLICK_REMOVE_QUESTION_BTN="CLICK_REMOVE_QUESTION_BTN",l.CLICK_QUESTION_SEARCH_SUBMIT="CLICK_QUESTION_SEARCH_SUBMIT",l.CHANGE_QUESTIONS_PAGE="CHANGE_QUESTIONS_PAGE",l.CHANGE_QLIST_PAGE="CHANGE_QLIST_PAGE",l.CLICK_START_PRACTICE_SET="CLICK_START_PRACTICE_SET",l.CLICK_RESTART_PRACTICE_SET="CLICK_RESTART_PRACTICE_SET",l.CLICK_QLIST_EDIT="CLICK_QLIST_EDIT",l.CLICK_PRACTICE_START="CLICK_PRACTICE_START",l.CLICK_EDIT_APPLY="CLICK_EDIT_APPLY",l.CLICK_QUESTION_LIST_ROW="CLICK_QUESTION_LIST_ROW",l.CLICK_PRACTICE_PREV="CLICK_PRACTICE_PREV",l.CLICK_PRACTICE_NEXT="CLICK_PRACTICE_NEXT",l.CLICK_COMPLETE_ANSWER="CLICK_COMPLETE_ANSWER",l.PRACTICE_ANSWERED="PRACTICE_ANSWERED",l.PRACTICE_ANSWER_CANCELED="PRACTICE_ANSWER_CANCELED",l.CHANGE_PRACTICE_HISTORY_PAGE="CHANGE_PRACTICE_HISTORY_PAGE",l.CLICK_EXIST_PRACTICE_START="CLICK_EXIST_PRACTICE_START",l.CHANGE_HISTORY_ACTIVE_TAB="CHANGE_HISTORY_ACTIVE_TAB",l.TOGGLE_QLISTS_STANDARD_CHECK="TOGGLE_QLISTS_STANDARD_CHECK",l.CLICK_CUSTOM_PRACTICE_START="CLICK_CUSTOM_PRACTICE_START",l.CLICK_QUESTION_FAVORITE="CLICK_QUESTION_FAVORITE",l);class eA{constructor(e){this.view=e,this.model=structuredClone(S)}async start(){this.registerViewHandlers(),this.dispatch({type:e_.INIT})}registerViewHandlers(){this.view.on(em.CLICK_SETTING_BTN,()=>this.dispatch({type:e_.OPEN_DEFAULT_MODAL,kind:E.SETTING})),this.view.on(em.CLICK_MENU_BTN,()=>this.dispatch({type:e_.SEARCH_HISTORY})),this.view.on(em.DEFAULT_MODAL_SHOWN,()=>this.dispatch({type:e_.DEFAULT_MODAL_SHOWN})),this.view.on(em.TOAST_DISMISS_REQUESTED,({uuid:e})=>this.dispatch({type:e_.TOAST_DISMISS_REQUESTED,uuid:e})),this.view.on(em.CHANGE_THEME,({theme:e})=>this.dispatch({type:e_.CHANGE_THEME,theme:e})),this.view.on(em.CHANGE_GOOGLE_CLIENT_ID,({googleClientId:e})=>this.dispatch({type:e_.CHANGE_GOOGLE_CLIENT_ID,googleClientId:e})),this.view.on(em.CHANGE_GOOGLE_FOLDER_ID,({googleFolderId:e})=>this.dispatch({type:e_.CHANGE_GOOGLE_FOLDER_ID,googleFolderId:e})),this.view.on(em.CLICK_GOOGLE_DRIVE_IMPORT_BTN,()=>this.dispatch({type:e_.IMPORT_GOOGLE_DRIVE_DATA})),this.view.on(em.CLICK_REMOVE_QUESTION_BTN,()=>this.dispatch({type:e_.REMOVE_LOCAL_STORAGE_QUESTION})),this.view.on(em.CLICK_QUESTION_SEARCH_SUBMIT,({isQListName:e,keyword:t,isCaseSensitive:i,correctRate:s,answerDateFrom:a,answerDateTo:n,unansweredFrom:r,unansweredTo:o,checkedFavorites:l})=>this.dispatch({type:e_.SEARCH_QUESTION,isQListName:e,keyword:t,isCaseSensitive:i,correctRate:s,answerDateFrom:a,answerDateTo:n,unansweredFrom:r,unansweredTo:o,checkedFavorites:l})),this.view.on(em.CHANGE_QLIST_PAGE,({page:e})=>this.dispatch({type:e_.CHANGE_QLIST_PAGE,page:e})),this.view.on(em.CHANGE_QUESTIONS_PAGE,({page:e})=>this.dispatch({type:e_.CHANGE_QUESTIONS_PAGE,page:e})),this.view.on(em.CLICK_START_PRACTICE_SET,({qListId:e})=>this.dispatch({type:e_.PREPARE_PRACTICE_START,qListId:e})),this.view.on(em.CLICK_QLIST_EDIT,({qList:e})=>this.dispatch({type:e_.SHOW_QLIST_EDIT,qList:e})),this.view.on(em.CLICK_EDIT_APPLY,({qList:e,name:t,isDefault:i,isDelete:s})=>this.dispatch({type:e_.UPDATE_QLIST,qList:e,name:t,isDefault:i,isDelete:s})),this.view.on(em.CLICK_RESTART_PRACTICE_SET,({name:e,questionIds:t})=>{this.dispatch({type:e_.SHOW_CUSTOM_PRACTICE_START,customPracticeStartDto:{name:e,questionIds:t,isReview:!0}})}),this.view.on(em.CLICK_PRACTICE_START,({preparePracticeStart:e,isShuffleQuestions:t,isShuffleChoices:i,questionCount:s})=>this.dispatch({type:e_.PREPARE_PRACTICE,preparePracticeStart:e,isShuffleQuestions:t,isShuffleChoices:i,questionCount:s})),this.view.on(em.CLICK_QUESTION_LIST_ROW,({questionId:e,practiceHistoryId:t})=>this.dispatch({type:e_.PREPARE_QUESTION_DETAIL,questionId:e,practiceHistoryId:t})),this.view.on(em.CLICK_PRACTICE_PREV,()=>this.dispatch({type:e_.PRACTICE_PREV})),this.view.on(em.CLICK_PRACTICE_NEXT,()=>this.dispatch({type:e_.PRACTICE_NEXT})),this.view.on(em.CLICK_COMPLETE_ANSWER,()=>this.dispatch({type:e_.COMPLETE_ANSWER})),this.view.on(em.PRACTICE_ANSWERED,({practiceHistoryId:e,questionId:t,isCorrect:i,selectChoice:s})=>this.dispatch({type:e_.PRACTICE_ANSWERED,practiceHistoryId:e,questionId:t,isCorrect:i,selectChoice:s})),this.view.on(em.PRACTICE_ANSWER_CANCELED,({practiceHistoryId:e,questionId:t})=>this.dispatch({type:e_.PRACTICE_ANSWER_CANCELED,practiceHistoryId:e,questionId:t})),this.view.on(em.CHANGE_PRACTICE_HISTORY_PAGE,({page:e})=>this.dispatch({type:e_.CHANGE_HISTORY_PAGE,page:e})),this.view.on(em.CLICK_EXIST_PRACTICE_START,({practiceHistoryId:e})=>this.dispatch({type:e_.PREPARE_EXIST_PRACTICE,practiceHistoryId:e})),this.view.on(em.CHANGE_HISTORY_ACTIVE_TAB,({activeTab:e})=>this.dispatch({type:e_.SEARCH_HISTORY,activeTab:e})),this.view.on(em.TOGGLE_QLISTS_STANDARD_CHECK,({standardOnly:e})=>this.dispatch({type:e_.TOGGLE_QLISTS_STANDARD_CHECK,standardOnly:e})),this.view.on(em.CLICK_CUSTOM_PRACTICE_START,()=>this.dispatch({type:e_.PREPARE_CUSTOM_PRACTICE})),this.view.on(em.CLICK_QUESTION_FAVORITE,({questionId:e,tagId:t,checked:i})=>this.dispatch({type:e_.UPDATE_FAVORITE,questionId:e,tagId:t,checked:i}))}dispatch(e){let{model:t,effects:i}=function(e,t){switch(t.type){case e_.INIT:{let t,i=((t=localStorage.getItem(Z))?"dark"===t?T.DARK:T.LIGHT:null)||(window.matchMedia("(prefers-color-scheme: dark)").matches?T.DARK:T.LIGHT),s=localStorage.getItem(J),a=localStorage.getItem(ee);return{model:{...e,theme:i,googleClientId:s,googleFolderId:a},effects:[{kind:eS.INIT_REPOSITORY},{kind:eS.UPDATE_THEME,theme:i}]}}case e_.OPEN_DEFAULT_MODAL:return{model:{...e,defailtModalKind:t.kind},effects:[]};case e_.SEARCH_HISTORY:{let i=t.activeTab??e.historyActiveTab;if(i===C.PRACTICE)return{model:{...e,historyActiveTab:i},effects:[{kind:eS.SEARCH_PRACTICE_HISTORY}]};return{model:{...e,historyActiveTab:i},effects:[{kind:eS.SEARCH_ANS_HISTORY}]}}case e_.DEFAULT_MODAL_SHOWN:return{model:{...e,defailtModalKind:null,preparePracticeStart:null},effects:[]};case e_.TOAST_ADD:return{model:{...e,toastMessages:[...e.toastMessages,t.toastMessage]},effects:[]};case e_.TOAST_DISMISS_REQUESTED:{let i=e.toastMessages.filter(e=>e.uuid!==t.uuid);return{model:{...e,toastMessages:i},effects:[]}}case e_.CHANGE_THEME:return{model:{...e,theme:t.theme},effects:[{kind:eS.UPDATE_THEME,theme:t.theme}]};case e_.CHANGE_GOOGLE_CLIENT_ID:return{model:{...e,googleClientId:t.googleClientId},effects:[{kind:eS.UPDATE_GOOGLE_CLIENT_ID,googleClientId:t.googleClientId}]};case e_.CHANGE_GOOGLE_FOLDER_ID:return{model:{...e,googleFolderId:t.googleFolderId},effects:[{kind:eS.UPDATE_GOOGLE_FOLDER_ID,googleFolderId:t.googleFolderId}]};case e_.IMPORT_GOOGLE_DRIVE_DATA:{let t=e.googleClientId,i=e.googleFolderId;if(t&&i)return{model:e,effects:[{kind:eS.IMPORT_GOOGLE_DRIVE,googleClientId:t,googleFolderId:i}]};return{model:e,effects:[]}}case e_.REMOVE_LOCAL_STORAGE_QUESTION:return{model:e,effects:[{kind:eS.REMOVE_LOCAL_STORAGE_QUESTION}]};case e_.UPDATE_QLIST_CONTAINER:return{model:{...e,qLists:t.qLists,qListSearchForm:{...e.qListSearchForm,currentPage:t.currentPage,totalSize:t.totalSize,pages:t.pages}},effects:[]};case e_.CHANGE_QLIST_PAGE:return{model:{...e,qListSearchForm:{...e.qListSearchForm,currentPage:t.page}},effects:[{kind:eS.SEARCH_QLIST}]};case e_.UPDATE_QUESTION_LIST_CONTAINER:return{model:{...e,questions:t.questions,questionSearchForm:{...e.questionSearchForm,currentPage:t.currentPage,totalSize:t.totalSize,pages:t.pages}},effects:[]};case e_.SEARCH_QUESTION:return{model:{...e,questionSearchForm:{...e.questionSearchForm,isQListName:t.isQListName,keyword:t.keyword,isCaseSensitive:t.isCaseSensitive,correctRate:t.correctRate,answerDateFrom:t.answerDateFrom,answerDateTo:t.answerDateTo,unansweredFrom:t.unansweredFrom,unansweredTo:t.unansweredTo,checkedFavorites:t.checkedFavorites}},effects:[{kind:eS.SEARCH_QUESTION}]};case e_.CHANGE_QUESTIONS_PAGE:return{model:{...e,questionSearchForm:{...e.questionSearchForm,currentPage:t.page}},effects:[{kind:eS.SEARCH_QUESTION}]};case e_.PREPARE_PRACTICE_START:return{model:e,effects:[{kind:eS.PREPARE_PRACTICE_START,qListId:t.qListId}]};case e_.SHOW_QLIST_EDIT:return{model:{...e,defailtModalKind:E.QLIST_EDIT,editQList:t.qList},effects:[]};case e_.UPDATE_QLIST:return{model:e,effects:[{kind:eS.UPDATE_QLIST,qList:t.qList,name:t.name,isDefault:t.isDefault,isDelete:t.isDelete}]};case e_.SHOW_PRACTICE_START:return{model:{...e,defailtModalKind:E.PRACTICE_START,preparePracticeStart:t.qList},effects:[]};case e_.SHOW_CUSTOM_PRACTICE_START:return{model:{...e,defailtModalKind:E.PRACTICE_START,preparePracticeStart:t.customPracticeStartDto},effects:[]};case e_.PREPARE_PRACTICE:return{model:e,effects:[{kind:eS.PREPARE_PRACTICE,preparePracticeStart:t.preparePracticeStart,isShuffleQuestions:t.isShuffleQuestions,isShuffleChoices:t.isShuffleChoices,questionCount:t.questionCount}]};case e_.PREPARE_EXIST_PRACTICE:return{model:e,effects:[{kind:eS.PREPARE_EXIST_PRACTICE,practiceHistoryId:t.practiceHistoryId}]};case e_.SHOW_PRACTICE:return{model:{...e,practiceDetailDto:t.practiceDetailDto},effects:[]};case e_.PREPARE_QUESTION_DETAIL:return{model:e,effects:[{kind:eS.PREPARE_QUESTION_DETAIL,questionId:t.questionId,practiceHistoryId:t.practiceHistoryId}]};case e_.SHOW_QUESTION_DETAIL:return{model:{...e,defailtModalKind:E.QUESTION_DETAIL,questionDetailDto:t.questionDetailDto},effects:[]};case e_.PRACTICE_PREV:if(e.practiceDetailDto)return{model:{...e,practiceDetailDto:{...e.practiceDetailDto,currentQuestionIndex:e.practiceDetailDto.currentQuestionIndex-1}},effects:[]};return{model:e,effects:[]};case e_.PRACTICE_NEXT:if(e.practiceDetailDto)return{model:{...e,practiceDetailDto:{...e.practiceDetailDto,currentQuestionIndex:e.practiceDetailDto.currentQuestionIndex+1}},effects:[]};return{model:e,effects:[]};case e_.COMPLETE_ANSWER:return{model:e,effects:[{kind:eS.COMPLETE_ANSWER}]};case e_.PRACTICE_ANSWERED:return{model:e,effects:[{kind:eS.PRACTICE_ANSWERED,practiceHistoryId:t.practiceHistoryId,questionId:t.questionId,isCorrect:t.isCorrect,selectChoice:t.selectChoice}]};case e_.PRACTICE_ANSWER_CANCELED:return{model:e,effects:[{kind:eS.PRACTICE_ANSWER_CANCELED,practiceHistoryId:t.practiceHistoryId,questionId:t.questionId}]};case e_.UPDATE_PRACTICE_HISTORY_LIST_CONTAINER:return{model:{...e,practiceHistorySearchForm:{...e.practiceHistorySearchForm,currentPage:t.currentPage,totalSize:t.totalSize,pages:t.pages},practiceHistoryDtos:t.practiceHistoryDtos},effects:[]};case e_.UPDATE_ANS_HISTORY_LIST_CONTAINER:return{model:{...e,ansHistorySearchForm:{...e.ansHistorySearchForm,currentPage:t.currentPage,totalSize:t.totalSize,pages:t.pages},ansHistoryDtos:t.ansHistoryDtos},effects:[]};case e_.CHANGE_HISTORY_PAGE:if(e.historyActiveTab===C.PRACTICE)return{model:{...e,practiceHistorySearchForm:{...e.practiceHistorySearchForm,currentPage:t.page}},effects:[{kind:eS.SEARCH_PRACTICE_HISTORY}]};return{model:{...e,ansHistorySearchForm:{...e.ansHistorySearchForm,currentPage:t.page}},effects:[{kind:eS.SEARCH_ANS_HISTORY}]};case e_.TOGGLE_QLISTS_STANDARD_CHECK:return{model:{...e,qListSearchForm:{...e.qListSearchForm,standardOnly:t.standardOnly}},effects:[{kind:eS.SEARCH_QLIST}]};case e_.PREPARE_CUSTOM_PRACTICE:return{model:e,effects:[{kind:eS.PREPARE_CUSTOM_PRACTICE}]};case e_.UPDATE_FAVORITE:return{model:e,effects:[{kind:eS.UPDATE_FAVORITE,questionId:t.questionId,tagId:t.tagId,checked:t.checked}]};default:return{model:e,effects:[]}}}(this.model,e);this.model=t,this.view.render(this.model),this.execEffects(i).catch(console.error)}async execEffects(t){var i,s,a;for(let n of t)switch(n.kind){case eS.INIT_REPOSITORY:{await en().then(()=>{console.info("App is starting...")}).catch(e=>{console.error("indexeddb connection error:",e),this.dispatch({type:e_.TOAST_ADD,toastMessage:U("Indexeddbへの接続に失敗しました")})});let t=function(){let e=localStorage.getItem(et);return e?new Date(e):null}();t&&t.getTime()+2592e5<Date.now()&&es([]);let i=function(){let t=localStorage.getItem(ei);if(!t)return null;let i=e(j).decompressFromUTF16(t);return i?JSON.parse(i).map(e=>new f(e)):null}();i&&i.length>0&&P.bulkInsert(i);let s=await eE(this.model.qListSearchForm);this.dispatch({type:e_.UPDATE_QLIST_CONTAINER,qLists:s.qLists,currentPage:s.currentPage,totalSize:s.totalSize,pages:s.pages});let a=await er(this.model.questionSearchForm);this.dispatch({type:e_.UPDATE_QUESTION_LIST_CONTAINER,questions:a.questions,currentPage:s.currentPage,totalSize:a.totalSize,pages:a.pages});break}case eS.UPDATE_THEME:i=n.theme,localStorage.setItem(Z,i),n.theme===T.DARK?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");break;case eS.UPDATE_GOOGLE_CLIENT_ID:s=n.googleClientId,localStorage.setItem(J,s);break;case eS.UPDATE_GOOGLE_FOLDER_ID:a=n.googleFolderId,localStorage.setItem(ee,a);break;case eS.IMPORT_GOOGLE_DRIVE:{let e=await ea(n.googleClientId,n.googleFolderId);if(this.dispatch({type:e_.TOAST_ADD,toastMessage:e}),e.kind===_.SUCCESS){let e=await eE(this.model.qListSearchForm);this.dispatch({type:e_.UPDATE_QLIST_CONTAINER,qLists:e.qLists,currentPage:e.currentPage,totalSize:e.totalSize,pages:e.pages});let t=await er(this.model.questionSearchForm);this.dispatch({type:e_.UPDATE_QUESTION_LIST_CONTAINER,questions:t.questions,currentPage:e.currentPage,totalSize:t.totalSize,pages:t.pages})}break}case eS.REMOVE_LOCAL_STORAGE_QUESTION:es([]),this.dispatch({type:e_.TOAST_ADD,toastMessage:b("設問データのキャッシュを削除しました。")});break;case eS.SEARCH_QLIST:{let{qLists:e,currentPage:t,totalSize:i,pages:s}=await eE(this.model.qListSearchForm);this.dispatch({type:e_.UPDATE_QLIST_CONTAINER,qLists:e,currentPage:t,totalSize:i,pages:s});break}case eS.SEARCH_QUESTION:try{let{questions:e,currentPage:t,totalSize:i,pages:s}=await er(this.model.questionSearchForm);this.dispatch({type:e_.UPDATE_QUESTION_LIST_CONTAINER,questions:e,currentPage:t,totalSize:i,pages:s})}catch(e){this.dispatch({type:e_.TOAST_ADD,toastMessage:U(e)})}break;case eS.PREPARE_PRACTICE_START:{let e=await y.selectById(n.qListId);this.dispatch({type:e_.SHOW_PRACTICE_START,qList:e});break}case eS.UPDATE_QLIST:{n.isDelete?await eT(n.qList):await eI(n.qList,n.name,n.isDefault);let e=await eE(this.model.qListSearchForm);this.dispatch({type:e_.UPDATE_QLIST_CONTAINER,qLists:e.qLists,currentPage:e.currentPage,totalSize:e.totalSize,pages:e.pages});break}case eS.PREPARE_PRACTICE:{let e=n.preparePracticeStart instanceof R?await ec(n.preparePracticeStart,n.isShuffleQuestions,n.isShuffleChoices):await eu(n.preparePracticeStart,n.isShuffleQuestions,n.isShuffleChoices,n.questionCount);this.dispatch({type:e_.SHOW_PRACTICE,practiceDetailDto:e});break}case eS.PREPARE_EXIST_PRACTICE:{let e=await ep(n.practiceHistoryId);this.dispatch({type:e_.SHOW_PRACTICE,practiceDetailDto:e});break}case eS.PREPARE_QUESTION_DETAIL:try{let e=await ed(n.questionId,n.practiceHistoryId);this.dispatch({type:e_.SHOW_QUESTION_DETAIL,questionDetailDto:e})}catch(e){this.dispatch({type:e_.TOAST_ADD,toastMessage:U(e)})}break;case eS.COMPLETE_ANSWER:if(null===this.model.practiceDetailDto)break;try{let e=await eh(this.model.practiceDetailDto);this.dispatch({type:e_.SHOW_PRACTICE,practiceDetailDto:e})}catch(e){this.dispatch({type:e_.TOAST_ADD,toastMessage:U(e)})}break;case eS.PRACTICE_ANSWERED:{if(null===this.model.practiceDetailDto)break;let e=await F(this.model.practiceDetailDto,n.practiceHistoryId,n.questionId,n.isCorrect,n.selectChoice);this.dispatch({type:e_.SHOW_PRACTICE,practiceDetailDto:e});break}case eS.PRACTICE_ANSWER_CANCELED:{if(null===this.model.practiceDetailDto)break;let{practiceDetailDto:e,toastMessage:t}=await x(this.model.practiceDetailDto,n.practiceHistoryId,n.questionId);this.dispatch({type:e_.SHOW_PRACTICE,practiceDetailDto:e}),this.dispatch({type:e_.TOAST_ADD,toastMessage:t});break}case eS.SEARCH_PRACTICE_HISTORY:{let{practiceHistoryDtos:e,currentPage:t,totalSize:i,pages:s}=await eC(this.model.practiceHistorySearchForm);this.dispatch({type:e_.UPDATE_PRACTICE_HISTORY_LIST_CONTAINER,practiceHistoryDtos:e,currentPage:t,totalSize:i,pages:s});break}case eS.SEARCH_ANS_HISTORY:{let{ansHistoryDtos:e,currentPage:t,totalSize:i,pages:s}=await B(this.model.ansHistorySearchForm);this.dispatch({type:e_.UPDATE_ANS_HISTORY_LIST_CONTAINER,ansHistoryDtos:e,currentPage:t,totalSize:i,pages:s});break}case eS.PREPARE_CUSTOM_PRACTICE:{let{questions:e}=await er(this.model.questionSearchForm,Number.MAX_SAFE_INTEGER);e.length<=0?this.dispatch({type:e_.TOAST_ADD,toastMessage:U("カスタム問題集の作成には、設問一覧に1問以上の設問を表示させる必要があります。")}):this.dispatch({type:e_.SHOW_CUSTOM_PRACTICE_START,customPracticeStartDto:{questionIds:e.map(e=>e.getId()),isReview:!1,name:"カスタム問題集"}});break}case eS.UPDATE_FAVORITE:{let e=await $(n.questionId,n.tagId,n.checked,this.model.practiceDetailDto);e&&this.dispatch({type:e_.SHOW_PRACTICE,practiceDetailDto:e})}}}}function eg(e,t,i=!1,s=!0,a,n){let r=!e.ansHistory,o="radio"===e.question.getSelectionFormat()?"radio":"checkbox",l=v("div","question-card"),d=v("header","question-header"),c=v("div","question-header-left"),u=v("span","question-title","問題");if(c.appendChild(u),e.ansHistory){let t=v("span",`question-result-label question-result-label-${e.ansHistory.getIsCorrect()?"correct":"incorrect"}`,`${e.ansHistory.getIsCorrect()?"正解":"不正解"}`);c.appendChild(t)}let p=v("div","question-id"),C=v("span",{text:"設問ID："}),E=v("span",{id:"questionId",class:"question-id-value blur",text:`#${e.question.getId()}`});p.appendChild(C),p.appendChild(E),p.addEventListener("click",()=>{F()}),d.appendChild(c),d.appendChild(p),l.appendChild(d);let T=v("div"),_=v("p",{id:"questionText",class:"question-text"});_.toggleAttribute("data-auto-tailwind",!0),_.innerHTML=e.question.getProblem(),T.appendChild(_),l.appendChild(T);let S=[],m=v("div",{id:"choices",class:"question-choices"}),A=e.question.getChoice(),g=e.ansHistory?e.ansHistory.getSelectChoice():[];A.forEach((t,i)=>{let s=v("label","question-choice"),n=v("input",{class:"question-choice-input",attr:[{type:o,name:"choice",value:String(i)}]});n.checked=g.includes(i);let l=v("span","w-full");l.toggleAttribute("data-auto-tailwind",!0),l.innerHTML=t,s.appendChild(n),s.appendChild(l),s.addEventListener("change",()=>{!function(){let t=[];if(S.forEach(e=>{let i=e.getElementsByTagName("input")[0];i.checked&&t.push(Number(i.value))}),t.length!==e.question.getAnswer().length)return;let i=[...e.question.getAnswer()].sort((e,t)=>e-t),s=[...t].sort((e,t)=>e-t),n=i.every((e,t)=>e===s[t]),o=v("div","answer-modal"),l=v("p",`answer-modal-text text-${n?"correct ":"incorrect"}`,`${n?"正解":"不正解"}`);o.appendChild(l),G.setModal(o,void 0,I.DEFAULT),n&&(x(),F()),a&&r&&(a.onAnswered(n,s),r=!1)}()}),S.push(s)}),(i||s)&&Q(S),S.forEach(e=>m.appendChild(e)),l.appendChild(m);let R=v("div","question-answer-button-wrapper"),f=v("button",{class:"question-answer-button",text:"正解を表示",attr:[{type:"button"}]});if(R.appendChild(f),f.addEventListener("click",()=>{x()}),e.ansHistory&&!s){let e=v("button",{class:"question-answer-cancel-button",text:"回答を取り消す",attr:[{type:"button"}]});R.appendChild(e),e.addEventListener("click",()=>{a?.onAnswerCanceled()})}l.appendChild(R);let L=v("div",{id:"answerBlock",class:"question-answer-block hidden"}),D=e.question.getAnswer().map(t=>e.question.getChoice()[t]),y=v("div"),P=v("span","question-answer-label","正解"),w=v("p","question-answer-text");D.forEach(e=>{let t=v("p","question-answer-choice");t.toggleAttribute("data-auto-tailwind",!0),t.innerHTML=e,w.appendChild(t)}),y.appendChild(P),y.appendChild(w);let O=v("div"),N=v("span","question-explain-label","解説"),H=v("p","question-explain-text");if(H.toggleAttribute("data-auto-tailwind",!0),H.innerHTML=e.question.getExplanation(),O.appendChild(N),O.appendChild(H),L.appendChild(y),L.appendChild(O),e.ansHistories&&e.ansHistories.length>0){let t=v("div","question-answer-history"),i=v("span","question-answer-history-label","解答履歴");t.appendChild(i);let s=v("div",{class:"question-answer-history-list"});e.ansHistories.slice().sort((e,t)=>new Date(t.getAnswerDate()).getTime()-new Date(e.getAnswerDate()).getTime()).slice(0,5).forEach(e=>{let t,i,a,n,r,o=e.getIsCorrect(),l=e.getAnswerDate(),d=v("div",{class:"question-answer-history-item"}),c=v("span",{class:`question-answer-history-icon ${o?"text-correct":"text-incorrect"}`}),u=v("i",{class:o?"bi bi-circle":"bi bi-x-lg",attr:[{"aria-hidden":"true"}]});c.appendChild(u);let p=v("span",{class:"question-answer-history-date",text:(i=String((t=new Date(l)).getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0"),`${i}/${a} ${n}:${r}`)});d.appendChild(c),d.appendChild(p),s.appendChild(d)}),t.appendChild(s),L.appendChild(t)}l.appendChild(L);let b=v("div","question-favorite"),U=v("span","question-favorite-label","お気に入り");b.appendChild(U);let M=v("div","question-favorite-list");Object.entries(h).forEach(([i,s])=>{let a=Number(i),n=0!==e.favorites.filter(e=>e.getTagId()===a).length,r=v("button",{class:"question-favorite-btn",attr:[{type:"button"},{"data-favorite-key":s.key},{"aria-pressed":String(n)}]});r.classList.toggle("question-favorite-btn--active",n);let o=v("i",{class:`question-favorite-btn-icon bi ${s.className}`,attr:[{"aria-hidden":"true"}]});r.appendChild(o),r.addEventListener("click",()=>{let e="true"!==r.getAttribute("aria-pressed");r.setAttribute("aria-pressed",String(e)),r.classList.toggle("question-favorite-btn--active",e),t(a,e)}),M.appendChild(r)}),b.appendChild(M),l.appendChild(b);let k=v("div","app-modal-overlay hidden");l.appendChild(k);let G=n||new q(k);function F(e){void 0===e?E.classList.toggle("blur"):e?E.classList.add("blur"):E.classList.remove("blur")}function x(){S.forEach(t=>{let i=t.getElementsByTagName("input")[0];e.question.getAnswer().includes(Number(i.value))&&(t.getElementsByTagName("span")[0].classList.add("question-answer-choice"),t.classList.add("question-answer-choice-label"))}),L.classList.remove("hidden")}return e.ansHistory&&e.ansHistory.getIsCorrect()&&(x(),F()),l}function eR(e,t,i){let s=e.getId(),a=G(e.getProblem()),n=v("button",{class:"question-list-row",attr:[{type:"button"},{"data-id":String(s)}]});n.addEventListener("click",()=>{t()});let r=v("span","question-list-row-id",`#${s}`),o=v("span","question-list-row-text",a);if(n.appendChild(r),n.appendChild(o),i){let e=i.getIsCorrect(),t=v("span",{class:`question-list-row-status ${e?"text-correct":"text-incorrect"}`}),s=v("i",{class:e?"bi bi-circle":"bi bi-x-lg",attr:[{"aria-hidden":"true"}]});t.appendChild(s),t.setAttribute("aria-label",e?"正解":"不正解"),n.appendChild(t)}return n}class ef{constructor(e){this.doc=e,this.listeners={},this.TOAST_AUTO_DISMISS=1e4,this.els={settingBtn:this.$("#settingBtn"),menuBtn:this.$("#menuBtn"),sideMenu:this.$("#sideMenu"),defaultModal:this.$("#defaultModal"),toastParent:this.$("#toastParent"),sideMenuCloseBtn:this.$("#sideMenuCloseBtn"),historyForPracticeBtn:this.$("#historyForPracticeBtn"),historyForQuestionBtn:this.$("#historyForQuestionBtn"),practiceHistoryList:this.$("#practiceHistoryList"),practiceContainer:this.$("#practiceContainer"),qListsStandardCheckBox:this.$("#qListsStandardCheckBox"),qListsContainer:this.$("#qListsContainer"),qListPagination:this.$("#qListPagination"),questionsContainer:this.$("#questionsContainer"),questionsPagination:this.$("#questionsPagination"),createCustomQListBtn:this.$("#createCustomQListBtn"),questionSearchIsQListName:this.$("#questionSearchIsQListName"),questionSearchKeyword:this.$("#questionSearchKeyword"),questionSearchIsCaseSensitive:this.$("#questionSearchIsCaseSensitive"),questionAdvancedSearchToggle:this.$("#questionAdvancedSearchToggle"),questionAdvancedSearch:this.$("#questionAdvancedSearch"),questionSearchCorrectRate:this.$("#questionSearchCorrectRate"),questionSearchAnswerDateFrom:this.$("#questionSearchAnswerDateFrom"),questionSearchAnswerDateTo:this.$("#questionSearchAnswerDateTo"),questionSearchUnansweredFrom:this.$("#questionSearchUnansweredFrom"),questionSearchUnansweredTo:this.$("#questionSearchUnansweredTo"),questionSearchFavorites:this.$all('input[name="questionSearchFavorite"]'),questionSearchSubmit:this.$("#questionSearchSubmit")},this.defaultModal=new q(this.els.defaultModal),this.els.settingBtn.addEventListener("click",()=>{this.emit(em.CLICK_SETTING_BTN,void 0)}),this.els.menuBtn.addEventListener("click",()=>{this.emit(em.CLICK_MENU_BTN,void 0),this.showSideMenuContent()}),this.els.sideMenuCloseBtn.addEventListener("click",()=>{this.hideSideMenuContent()}),this.els.historyForPracticeBtn.addEventListener("click",()=>{this.emit(em.CHANGE_HISTORY_ACTIVE_TAB,{activeTab:C.PRACTICE}),this.toggleHistoryTab(this.els.historyForPracticeBtn,this.els.historyForQuestionBtn)}),this.els.historyForQuestionBtn.addEventListener("click",()=>{this.emit(em.CHANGE_HISTORY_ACTIVE_TAB,{activeTab:C.QUESTION}),this.toggleHistoryTab(this.els.historyForQuestionBtn,this.els.historyForPracticeBtn)}),this.els.qListsStandardCheckBox.addEventListener("change",()=>{this.emit(em.TOGGLE_QLISTS_STANDARD_CHECK,{standardOnly:this.els.qListsStandardCheckBox.checked})}),this.els.createCustomQListBtn.addEventListener("click",()=>{this.emit(em.CLICK_CUSTOM_PRACTICE_START,void 0)}),this.els.questionSearchIsQListName.addEventListener("click",()=>{let e="true"===this.els.questionSearchIsQListName.getAttribute("aria-pressed");this.els.questionSearchIsQListName.setAttribute("aria-pressed",String(!e))}),this.els.questionSearchIsCaseSensitive.addEventListener("click",()=>{let e="true"===this.els.questionSearchIsCaseSensitive.getAttribute("aria-pressed");this.els.questionSearchIsCaseSensitive.setAttribute("aria-pressed",String(!e))}),this.els.questionAdvancedSearchToggle.addEventListener("click",()=>{this.els.questionAdvancedSearch.classList.toggle("hidden")}),this.els.questionSearchSubmit.addEventListener("click",()=>{let e="true"===this.els.questionSearchIsQListName.getAttribute("aria-pressed"),t=this.els.questionSearchKeyword.value,i="true"===this.els.questionSearchIsCaseSensitive.getAttribute("aria-pressed"),s=Number(this.els.questionSearchCorrectRate.value),a=this.els.questionSearchAnswerDateFrom.value?new Date(this.els.questionSearchAnswerDateFrom.value):null,n=this.els.questionSearchAnswerDateTo.value?new Date(this.els.questionSearchAnswerDateTo.value):null,r=this.els.questionSearchUnansweredFrom.value?new Date(this.els.questionSearchUnansweredFrom.value):null,o=this.els.questionSearchUnansweredTo.value?new Date(this.els.questionSearchUnansweredTo.value):null,l=[...this.els.questionSearchFavorites].filter(e=>e.checked).map(e=>Number(e.value));this.emit(em.CLICK_QUESTION_SEARCH_SUBMIT,{isQListName:e,keyword:t,isCaseSensitive:i,correctRate:s,answerDateFrom:a,answerDateTo:n,unansweredFrom:r,unansweredTo:o,checkedFavorites:l})})}on(e,t){(this.listeners[e]??=[]).push(t)}emit(e,t){let i=this.listeners[e];i?.forEach(e=>e(t))}render(e){this.applyToastMessages(e.toastMessages),this.applyDefaultModal(e),null!==e.practiceDetailDto&&this.applyPracticeContent(e.practiceDetailDto),this.applyQListsContent(e.qListSearchForm,e.qLists),this.applyQuestionsContent(e.questions),this.applyQuestionSearchForm(e.questionSearchForm,e.questions.length),this.applyHistoryContent(e)}applyToastMessages(e){for(let t of e){let e=this.generateToastMessage(t);this.els.toastParent.appendChild(e),this.emit(em.TOAST_DISMISS_REQUESTED,{uuid:t.uuid})}}generateToastMessage(e){let t=v("div",`toast toast--${e.kind.toLocaleLowerCase()}`),i=e.kind===_.SUCCESS?v("i",{class:"bi bi-check-circle-fill app-modal-button-icon",attr:[{"aria-hidden":"true"}]}):v("i",{class:"bi bi-exclamation-triangle-fill app-modal-button-icon",attr:[{"aria-hidden":"true"}]}),s=v("div","toast-body"),a=v("p","toast-desc");a.innerHTML=e.message,s.appendChild(a);let n=v("button",`toast-close toast-close--${e.kind.toLocaleLowerCase()}`),r=v("i",{class:"bi bi-x-lg app-modal-button-icon",attr:[{"aria-hidden":"true"}]});n.appendChild(r),t.appendChild(i),t.appendChild(s),t.appendChild(n);let o=window.setTimeout(()=>{t.isConnected&&t.remove()},this.TOAST_AUTO_DISMISS);return n.addEventListener("click",()=>{clearTimeout(o),t.isConnected&&t.remove()}),t}applyDefaultModal(e){if(e.defailtModalKind===E.SETTING){let t=function(e,t,i,s){let a=v("div","app-modal-body"),n=v("section","app-modal-section"),r=v("h3","app-modal-section-title","テーマ"),o=v("p","app-modal-section-description","ライト / ダーク から選択できます。"),l=v("div","app-modal-radio-group");function d(e,t,i=!1){let a=v("label","app-modal-radio"),n=v("input");n.type="radio",n.name="theme",n.value=e,i&&(n.checked=!0),n.addEventListener("change",()=>{n.checked&&s.onThemeChange(e)});let r=v("span",void 0,t);return a.appendChild(n),a.appendChild(r),a}l.appendChild(d(T.LIGHT,"ライト",T.LIGHT===e)),l.appendChild(d(T.DARK,"ダーク",T.DARK===e)),n.appendChild(r),n.appendChild(o),n.appendChild(l);let c=v("section","app-modal-section"),u=v("h3","app-modal-section-title","Google Drive 連携"),p=v("p","app-modal-section-description","Google Drive に保存した問題ファイルをインポートします。"),h=v("div","app-modal-field-group"),C=v("div","app-modal-field"),E=v("label",{class:"app-modal-field-label",text:"Client ID",attr:[{for:"driveClientIdInput"}]}),I=v("input",{class:"app-modal-input",id:"driveClientIdInput",attr:[{type:"text"},{name:"driveClientId"},{value:t},{placeholder:"Google API Client ID"},{autocomplete:"off"}]});I.addEventListener("input",()=>{s.onGoogleClientIdChange(I.value)}),C.appendChild(E),C.appendChild(I);let _=v("div","app-modal-field"),S=v("label",{class:"app-modal-field-label",text:"フォルダID",attr:[{for:"driveFolderIdInput"}]}),m=v("input",{class:"app-modal-input",id:"driveFolderIdInput",attr:[{type:"text"},{name:"driveFolderId"},{value:i},{placeholder:"Google Drive Folder ID"},{autocomplete:"off"}]});m.addEventListener("input",()=>{s.onGoogleFolderIdChange(m.value)}),_.appendChild(S),_.appendChild(m),h.appendChild(C),h.appendChild(_);let A=v("div","app-modal-actions"),g=v("button",{class:"app-modal-button w-full mt-2",id:"driveImportBtn"});g.type="button";let R=v("i",{class:"bi bi-cloud-arrow-down app-modal-button-icon",attr:[{"aria-hidden":"true"}]});g.appendChild(R),g.append("問題をインポート"),g.addEventListener("click",()=>{s.onGoogleDriveImport()}),A.appendChild(g),c.appendChild(u),c.appendChild(p),c.appendChild(h),c.appendChild(A),a.appendChild(n),a.appendChild(c);let f=v("section","app-modal-section"),L=v("h3","app-modal-section-title","設問削除"),D=v("p","app-modal-section-description");D.innerHTML="ローカルにキャッシュされた設問データの削除を行います。<br>次回のアクセス時には設問データの再インポートが必要となります。";let y=v("div","app-modal-actions"),P=v("button",{class:"app-modal-button app-modal-button-danger",id:"historyDeleteBtn"});P.type="button";let w=v("i",{class:"bi bi-trash app-modal-button-icon",attr:[{"aria-hidden":"true"}]});return P.appendChild(w),P.append("キャッシュデータの削除"),P.addEventListener("click",()=>{s.onRemoveQuestions()}),y.appendChild(P),f.appendChild(L),f.appendChild(D),f.appendChild(y),a.appendChild(f),a}(e.theme,e.googleClientId??"",e.googleFolderId??"",{onThemeChange:e=>{this.emit(em.CHANGE_THEME,{theme:e})},onGoogleClientIdChange:e=>{this.emit(em.CHANGE_GOOGLE_CLIENT_ID,{googleClientId:e})},onGoogleFolderIdChange:e=>{this.emit(em.CHANGE_GOOGLE_FOLDER_ID,{googleFolderId:e})},onGoogleDriveImport:()=>{this.emit(em.CLICK_GOOGLE_DRIVE_IMPORT_BTN,void 0)},onRemoveQuestions:()=>{this.emit(em.CLICK_REMOVE_QUESTION_BTN,void 0)}});this.defaultModal.setModal(t,"設定",I.XL),this.emit(em.DEFAULT_MODAL_SHOWN,void 0)}else if(e.defailtModalKind===E.PRACTICE_START&&e.preparePracticeStart){let t=function(e,t){let i=e instanceof R,s=e instanceof R&&e.getIsDefault(),a=Number.MAX_SAFE_INTEGER,n=v("div","app-modal-body"),r=v("section","app-modal-section"),o=v("h3","app-modal-section-title","演習情報");r.appendChild(o);let l=v("div","app-modal-field"),d=v("span","app-modal-field-label","問題集名");if(l.appendChild(d),i){let t=v("p","practice-info-name",e.getName());l.appendChild(t)}else{let t=`${e.isReview?"【復習】":""}${e.name} ${M(new Date)}`,i=v("input",{id:"customPracticeName",class:"practice-info-name-input",attr:[{type:"text"},{name:"customPracticeName"},{value:t}]});e.name=t,i.addEventListener("change",()=>{e.name=i.value}),l.appendChild(i)}r.appendChild(l);let c=v("div","practice-info-grid"),u=v("div","practice-info-stat"),p=v("span","font-medium","問題数："),h=i?e.getQuestions().length:e.questionIds.length,C=v("span",void 0,`${h}\u{554F}`);u.appendChild(p),u.appendChild(C),c.appendChild(u);let E=v("div","practice-info-type"),I=v("span","font-medium","問題集種別："),T=v("span",`q-list-card-badge ${s?"default-badge":"custom-badge"}`,s?"標準":"カスタム");E.appendChild(I),E.appendChild(T),c.appendChild(E),r.appendChild(c),n.appendChild(r);let _=v("section","app-modal-section"),S=v("h3","app-modal-section-title","出題設定"),m=v("p","app-modal-section-description","出題順や選択肢の並び順を変更するか選択できます。");_.appendChild(S),_.appendChild(m);let A=v("div","practice-setting-group"),g=v("label","practice-setting-checkbox"),f=v("input",{id:"shuffleQuestions",class:"practice-setting-checkbox-input",attr:[{type:"checkbox"}]}),L=v("span",void 0,"問題の出題順を並び替える");g.appendChild(f),g.appendChild(L),A.appendChild(g);let D=v("label","practice-setting-checkbox"),y=v("input",{id:"shuffleChoices",class:"practice-setting-checkbox-input",attr:[{type:"checkbox"}]}),P=v("span",void 0,"選択肢の並び順を並び替える");if(D.appendChild(y),D.appendChild(P),A.appendChild(D),!i){let e=v("div","practice-setting-field"),t=v("span","app-modal-field-label","出題数"),i=v("select",{id:"practiceQuestionLimit",class:"practice-setting-select"});[{value:"5",label:"5問"},{value:"10",label:"10問"},{value:"20",label:"20問"},{value:"30",label:"30問"},{value:"40",label:"40問"},{value:"50",label:"50問"},{value:"60",label:"60問"},{value:"65",label:"65問"},{value:"100",label:"100問"},{value:"130",label:"130問"},{value:a.toString(),label:"すべての問題"}].forEach(({value:e,label:t})=>{let s=v("option",{attr:[{value:e}],text:t});e===a.toString()&&(s.selected=!0),i.appendChild(s)}),i.addEventListener("change",()=>{a=Number(i.value)}),e.appendChild(t),e.appendChild(i),A.appendChild(e)}_.appendChild(A),n.appendChild(_);let w=v("div","app-modal-actions"),O=v("button",{id:"practiceStartButton",class:"app-modal-button practice-start-button",text:"演習を開始する",attr:[{type:"button"}]});return O.addEventListener("click",()=>{t(e,f.checked,y.checked,a)}),w.appendChild(O),n.appendChild(w),n}(e.preparePracticeStart,(e,t,i,s)=>{this.emit(em.CLICK_PRACTICE_START,{preparePracticeStart:e,isShuffleQuestions:t,isShuffleChoices:i,questionCount:s}),this.defaultModal.hide(),function(e=!0){e?window.scrollTo({top:0,behavior:"smooth"}):window.scrollTo(0,0)}(),this.hideSideMenuContent()});this.defaultModal.setModal(t,"演習開始",I.XL),this.emit(em.DEFAULT_MODAL_SHOWN,void 0)}else if(e.defailtModalKind===E.QLIST_EDIT&&e.editQList){var t;let i,s,a,n,r,o,l,d,c,u,p,h,C,E,T,_,S,m,A,g,R,f,L=e.editQList,D=(t=(e,t,i)=>{this.emit(em.CLICK_EDIT_APPLY,{qList:L,name:e,isDefault:t,isDelete:i}),this.defaultModal.hide()},i=L.getName(),s=L.getIsDefault(),a=v("div","app-modal-body"),n=v("section","app-modal-section"),r=v("h3","app-modal-section-title","問題集の編集"),n.appendChild(r),o=v("div","app-modal-field"),l=v("span","app-modal-field-label","タイトル"),d=v("input",{id:"qListEditName",class:"practice-info-name-input",attr:[{type:"text"},{name:"qListName"},{value:i}]}),o.appendChild(l),o.appendChild(d),c=v("div","app-modal-field"),u=v("span","app-modal-field-label","問題集種別"),p=v("div","app-modal-radio-group"),h=v("label","app-modal-radio"),(C=v("input",{attr:[{type:"radio"},{name:"qListType"},{value:"default"}]})).checked=s,E=v("span",void 0,"標準"),h.appendChild(C),h.appendChild(E),T=v("label","app-modal-radio"),(_=v("input",{attr:[{type:"radio"},{name:"qListType"},{value:"custom"}]})).checked=!s,S=v("span",void 0,"カスタム"),T.appendChild(_),T.appendChild(S),p.appendChild(h),p.appendChild(T),c.appendChild(u),c.appendChild(p),m=v("div","app-modal-actions"),(A=v("button",{id:"qListEditButton",class:"app-modal-button qlist-edit-button",text:"編集",attr:[{type:"button"}]})).addEventListener("click",()=>{let e=C.checked;t(d.value,e,!1)}),g=v("div","app-modal-overlay hidden"),a.appendChild(g),R=new q(g),(f=v("button",{id:"qListEditButton",class:"app-modal-button qlist-remove-button",text:"削除",attr:[{type:"button"}]})).addEventListener("click",()=>{var e,i;let s,a,n,r,o,l,c=C.checked,u=(e=()=>t(d.value,c,!0),i=()=>R.hide(),s=v("div","app-modal-body"),a=v("div","app-modal-section"),n=v("p","app-modal-section-description","この問題集を削除すると、関連する演習履歴もすべて削除されます。削除した内容は元に戻せません。本当に削除してもよろしいですか？"),a.appendChild(n),s.appendChild(a),r=v("div","app-modal-actions"),(o=v("button",{class:"app-modal-button app-modal-button-danger",text:"削除",attr:[{type:"button"}]})).addEventListener("click",()=>{e()}),(l=v("button",{class:"app-modal-button",text:"キャンセル",attr:[{type:"button"}]})).addEventListener("click",()=>{i()}),r.appendChild(o),r.appendChild(l),s.appendChild(r),s);R.setModal(u,"問題集を削除",I.LG)}),m.appendChild(A),m.appendChild(f),n.appendChild(o),n.appendChild(c),n.appendChild(m),a.appendChild(n),a);this.defaultModal.setModal(D,`\u{554F}\u{984C}\u{96C6}\u{300C}${L.getName()}\u{300D} \u{7DE8}\u{96C6}`,I.XL),this.emit(em.DEFAULT_MODAL_SHOWN,void 0)}else if(e.defailtModalKind===E.QUESTION_DETAIL&&e.questionDetailDto){let t=e.questionDetailDto.question.getId(),i=eg(e.questionDetailDto,(e,i)=>{this.emit(em.CLICK_QUESTION_FAVORITE,{questionId:t,tagId:e,checked:i})});this.defaultModal.setModal(i,"",I.XXL),this.emit(em.DEFAULT_MODAL_SHOWN,void 0)}}applyPracticeContent(e){this.els.practiceContainer.innerHTML="";let t=e.practiceHistory.getIsAnswered()?function(e,t){let i=e.questionDetailDtos.filter(e=>!!(e.ansHistory&&e.ansHistory.getIsCorrect())),s=e.questionDetailDtos.length,a=0===s?0:i.length/s*100,n=a.toFixed(2),r=`${n}%`,o=v("div","practice-body practice-result"),l=v("header","practice-result-header"),d=v("h2","practice-result-title",e.qList.getName());l.appendChild(d);let c=v("section","practice-result-main"),u=v("div","practice-result-grid"),p=v("div","practice-result-chart-wrapper"),h=v("div","practice-result-chart-circle");h.setAttribute("role","img"),h.setAttribute("aria-label",`\u{6B63}\u{7B54}\u{7387} ${r}`),p.appendChild(h);let C=Math.max(0,Math.min(100,a));h.style.setProperty("--practice-result-rate-deg",`${3.6*C}deg`),p.appendChild(h);let E=v("div","practice-result-summary"),I=v("div","practice-result-summary-row"),T=v("span","practice-result-summary-label","正答率"),_=v("span","practice-result-summary-rate",r);I.appendChild(T),I.appendChild(_);let S=v("p","practice-result-summary-count");S.append("正答数 ");let m=v("span","practice-result-summary-count-strong",String(i.length)),A=v("span","practice-result-summary-count-total",`/ ${s}\u{554F}`);S.appendChild(m),S.appendChild(A),E.appendChild(I),E.appendChild(S),u.appendChild(p),u.appendChild(E),c.appendChild(u);let g=v("section","practice-result-actions"),R=v("button",{class:"practice-result-btn-re-practice",text:"再演習",attr:[{type:"button"}]});R.addEventListener("click",()=>{t.onClickRetryBtn()});let f=v("button",{class:"practice-result-btn-review",text:"誤答の復習",attr:[{type:"button"}]});f.disabled=i.length===s,f.addEventListener("click",()=>{if(i.length!==s){let i=e.questionDetailDtos.filter(e=>!(!e.ansHistory||e.ansHistory.getIsCorrect())).map(e=>e.question.getId());t.onClickReviewBtn(i)}}),g.appendChild(R),g.appendChild(f);let L=v("section","practice-result-list");for(let i of e.questionDetailDtos){let e=eR(i.question,()=>t.onClickQuestionResult(i.question.getId()),i.ansHistory??void 0);L.appendChild(e)}return o.appendChild(l),o.appendChild(c),o.appendChild(g),o.appendChild(L),o}(e,{onClickRetryBtn:()=>{this.emit(em.CLICK_START_PRACTICE_SET,{qListId:e.qList.getId()})},onClickReviewBtn:t=>{this.emit(em.CLICK_RESTART_PRACTICE_SET,{name:e.qList.getName(),questionIds:t})},onClickQuestionResult:t=>{this.emit(em.CLICK_QUESTION_LIST_ROW,{questionId:t,practiceHistoryId:e.practiceHistory.getId()})}}):function(e,t,i){let s=e.questionDetailDtos[e.currentQuestionIndex],a=v("div","practice-body"),n=v("div","practice-header"),r=v("h2","practice-title",e.qList.getName());if(n.appendChild(r),0===e.questionDetailDtos.filter(e=>null===e.ansHistory).length){let e=v("div","practice-header-actions"),i=v("button",{class:"practice-submit-button",text:"回答を提出",attr:[{type:"button"}]});i.addEventListener("click",()=>{t.onClickCompleteAnswer()}),e.appendChild(i),n.appendChild(e)}let o=v("div","practice-nav-row"),l=v("button","practice-nav-button","前の問題"),d=v("div","practice-progress",`${e.currentQuestionIndex+1} \u{554F}\u{76EE} / ${e.questionDetailDtos.length} \u{554F}\u{4E2D}`),c=v("button","practice-nav-button","次の問題");o.append(l,d,c);let u=eg(s,(e,i)=>t.onFavoriteToggled(s.question.getId(),e,i),e.practiceHistory.getIsRandomC(),e.practiceHistory.getIsAnswered(),{onAnswered:(i,a)=>t.onAnswered(e.practiceHistory.getId(),s.question.getId(),i,a),onAnswerCanceled:()=>t.onAnswerCanceled(e.practiceHistory.getId(),s.question.getId())},i);a.append(n,o,u);let p=v("div","app-modal-overlay hidden"),h=new q(p);return a.appendChild(p),l.addEventListener("click",()=>{if(e.currentQuestionIndex<=0){let e=v("div","answer-modal"),t=v("p","answer-modal-text","前の問題はありません");e.appendChild(t),h.setModal(e,void 0,I.LG)}else t.onClickPrevBtn()}),c.addEventListener("click",()=>{if(e.questionDetailDtos.length<=e.currentQuestionIndex+1){let e=v("div","answer-modal"),t=v("p","answer-modal-text","次の問題はありません");e.appendChild(t),h.setModal(e,void 0,I.LG)}else t.onClickNextBtn()}),a}(e,{onClickPrevBtn:()=>{this.emit(em.CLICK_PRACTICE_PREV,void 0)},onClickNextBtn:()=>{this.emit(em.CLICK_PRACTICE_NEXT,void 0)},onClickCompleteAnswer:()=>{this.emit(em.CLICK_COMPLETE_ANSWER,void 0)},onAnswered:(e,t,i,s)=>{this.emit(em.PRACTICE_ANSWERED,{practiceHistoryId:e,questionId:t,isCorrect:i,selectChoice:s})},onAnswerCanceled:(e,t)=>{this.emit(em.PRACTICE_ANSWER_CANCELED,{practiceHistoryId:e,questionId:t})},onFavoriteToggled:(e,t,i)=>{this.emit(em.CLICK_QUESTION_FAVORITE,{questionId:e,tagId:t,checked:i})}},this.defaultModal);this.els.practiceContainer.appendChild(t)}applyQListsContent(e,t){this.els.qListsStandardCheckBox.checked=e.standardOnly,this.els.qListsContainer.innerHTML="",t.forEach(e=>{var t;let i,s,a,n,r,o,l,d,c,u,p,h,C,E,I,T,_,S=(t={onClickSolve:e=>{this.emit(em.CLICK_START_PRACTICE_SET,{qListId:e})},onClickEdit:()=>{this.emit(em.CLICK_QLIST_EDIT,{qList:e})}},i=e.getId(),s=e.getUuid(),a=e.getName(),n=e.getQuestions(),r=e.getIsDefault(),o=n?n.length:0,l=v("article",{class:"q-list-card",attr:[{"data-id":String(i)},{"data-uuid":s}]}),d=v("div","q-list-card-header"),c=v("div","q-list-card-header-main"),u=v("h3","q-list-card-title",a),p=v("p","q-list-card-subtitle","登録問題数："),h=v("span","q-list-card-count",String(o)),p.appendChild(h),p.append(" 問"),c.appendChild(u),c.appendChild(p),d.appendChild(c),C=v("span",`q-list-card-badge ${r?"default-badge":"custom-badge"}`,r?"標準":"カスタム"),d.appendChild(C),E=v("div","q-list-card-meta",`UUID: ${s}`),I=v("div","q-list-card-actions"),(T=v("button",{class:"q-list-card-btn-primary",text:"この問題集を解く",attr:[{type:"button"}]})).addEventListener("click",()=>{t.onClickSolve(e.getId())}),(_=v("button",{class:"q-list-card-btn-secondary",text:"編集",attr:[{type:"button"}]})).addEventListener("click",()=>{t.onClickEdit()}),I.appendChild(T),I.appendChild(_),l.appendChild(d),l.appendChild(E),l.appendChild(I),l);this.els.qListsContainer.appendChild(S)}),H(this.els.qListPagination,e.currentPage,e.pages,t.length,e.totalSize,e=>this.emit(em.CHANGE_QLIST_PAGE,{page:e}))}applyQuestionsContent(e){this.els.questionsContainer.innerHTML="",e.forEach(e=>{let t=eR(e,()=>{this.emit(em.CLICK_QUESTION_LIST_ROW,{questionId:e.getId()})});this.els.questionsContainer.appendChild(t)})}applyQuestionSearchForm(e,t){H(this.els.questionsPagination,e.currentPage,e.pages,t,e.totalSize,e=>{this.emit(em.CHANGE_QUESTIONS_PAGE,{page:e})})}applyHistoryContent(e){let t=v("div");if(this.els.practiceHistoryList.innerHTML="",this.els.practiceHistoryList.appendChild(t),e.historyActiveTab===C.PRACTICE){let i=e.practiceHistoryDtos,s=e.practiceHistorySearchForm;i.forEach(e=>{var t;let i,s,a,n,r,o,l,d,c,u,p=(t=()=>{this.emit(em.CLICK_EXIST_PRACTICE_START,{practiceHistoryId:e.practiceHistory.getId()}),this.hideSideMenuContent()},i=v("div","practice-history-list-row"),s=v("div","practice-history-list-header"),(a=v("h4","practice-history-list-title",e.qList.getName())).addEventListener("click",()=>{t()}),s.appendChild(a),n=v("div","practice-history-list-detail"),r=v("div","practice-history-list-badges"),o=e.practiceHistory.getIsAnswered(),l=v("span",`practice-history-list-badge ${o?"answered-badge":"answering-badge"}`,o?"回答済み":"演習途中"),r.appendChild(l),d=e.qList.getIsDefault(),c=v("span",`practice-history-list-badge ${d?"default-badge":"custom-badge"}`,d?"標準":"カスタム"),r.appendChild(c),n.appendChild(r),u=v("span",{text:M(e.practiceHistory.getCreateAt())}),n.appendChild(u),i.appendChild(s),i.appendChild(n),i);this.els.practiceHistoryList.appendChild(p)}),H(t,s.currentPage,s.pages,i.length,s.totalSize,e=>this.emit(em.CHANGE_PRACTICE_HISTORY_PAGE,{page:e}))}else{let i=e.ansHistoryDtos,s=e.ansHistorySearchForm;i.forEach(e=>{let t=function(e,t){let{ansHistory:i,qList:s,question:a}=e,n=v("div","ans-history-row"),r=v("div","ans-history-header"),o=v("span","question-list-row-id",`#${a.getId()}`),l=v("span","question-list-row-text",G(a.getProblem()));l.addEventListener("click",()=>{t.onClickQuestion()});let d=i.getIsCorrect(),c=v("span",{class:`question-list-row-status ${d?"text-correct":"text-incorrect"}`}),u=v("i",{class:d?"bi bi-circle":"bi bi-x-lg",attr:[{"aria-hidden":"true"}]});c.appendChild(u),r.appendChild(o),r.appendChild(l),r.appendChild(c);let p=v("p","ans-history-q-list-name",`\u{554F}\u{984C}\u{96C6}\u{540D}: ${s.getName()}`);p.addEventListener("click",()=>{t.onClickPractice()});let h=v("div","ans-history-date",M(i.getAnswerDate()));return n.appendChild(r),n.appendChild(p),n.appendChild(h),n}(e,{onClickPractice:()=>{this.emit(em.CLICK_EXIST_PRACTICE_START,{practiceHistoryId:e.ansHistory.getPracticeHistoryId()}),this.hideSideMenuContent()},onClickQuestion:()=>{this.emit(em.CLICK_QUESTION_LIST_ROW,{questionId:e.question.getId(),practiceHistoryId:e.ansHistory.getPracticeHistoryId()})}});this.els.practiceHistoryList.appendChild(t)}),H(t,s.currentPage,s.pages,i.length,s.totalSize,e=>this.emit(em.CHANGE_PRACTICE_HISTORY_PAGE,{page:e}))}}showSideMenuContent(){this.els.sideMenu.classList.remove("translate-x-full"),this.els.sideMenu.classList.add("translate-x-0"),document.body.classList.add("modal-open")}hideSideMenuContent(){this.els.sideMenu.classList.add("translate-x-full"),this.els.sideMenu.classList.remove("translate-x-0"),document.body.classList.remove("modal-open")}toggleHistoryTab(e,t){e.classList.remove("side-menu-tab--inactive"),e.classList.add("side-menu-tab--active"),t.classList.remove("side-menu-tab--active"),t.classList.add("side-menu-tab--inactive")}$(e){let t=this.doc.querySelector(e);if(!t)throw Error(`[PanelView] Missing element: ${e}`);return t}$all(e){return this.doc.querySelectorAll(e)}}async function eL(){let e=new eA(new ef(document));await e.start()}"complete"===document.readyState||"interactive"===document.readyState?eL().catch(e=>{console.error("Panel bootstrap failed:",e)}):document.addEventListener("DOMContentLoaded",()=>void eL().catch(e=>{console.error("Panel bootstrap failed:",e)}));
//# sourceMappingURL=resources.ee25afe1.js.map
