# ğŸ’¾ 6. æ°¸ç¶šåŒ–ã¨ãƒªãƒã‚¸ãƒˆãƒª

## IndexedDB
IndexedDB ã¯ Repository çµŒç”±ã§æ“ä½œã•ã‚Œã€åˆæœŸåŒ–æ™‚ã«ã‚¹ãƒˆã‚¢ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

### ã‚¹ãƒˆã‚¢ä¸€è¦§
| store | repository | entity |
| --- | --- | --- |
| ans_history | ans_history_repository | AnsHistory |
| favorite | favorite_repository | Favorite |
| practice_history | practice_history_repositoriy | PracticeHistory |
| q_list | qlist_repositoriy | QList |

â€» è¨­å•ã¯ `src/app/repositories/question_repositoriy.ts:3-58` ã®ãƒ¡ãƒ¢ãƒªå†…ãƒªãƒã‚¸ãƒˆãƒªã§ä¿æŒã—ã¾ã™ã€‚

## localStorage
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šã¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆçµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ localStorage ã«ä¿æŒã—ã¾ã™ã€‚
å‚ç…§: `src/app/storages/index.ts:6-65`

## æ°¸ç¶šåŒ–ãƒ•ãƒ­ãƒ¼
```mermaid
flowchart LR
  View --> Controller
  Controller --> Service
  Service --> Repository
  Repository --> IndexedDB[(IndexedDB)]
  Service --> Storage[(localStorage)]
```

## é–¢é€£ãƒªãƒ³ã‚¯
- å…¨ä½“è¨­è¨ˆã¯ [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](./03-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£) ã‚’å‚ç…§

## ğŸ” å‚ç…§ã‚³ãƒ¼ãƒ‰
å‚ç…§: `src/app/services/indexeddb_service.ts:7-16`ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã¯èª¬æ˜ç”¨ã«è¿½è¨˜ï¼‰

```ts
// NOTE: DB åˆæœŸåŒ–æ™‚ã«å„ã‚¹ãƒˆã‚¢ã‚’ä½œæˆã™ã‚‹
export async function initDatabase(): Promise<void> {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);

    request.onupgradeneeded = (event: IDBVersionChangeEvent) => {
      ansHistoryRepository.initStore(event);
      favoriteRepository.initStore(event);
      practiceHistoryRepository.initStore(event);
      qListRepository.initStore(event);
    };
```
