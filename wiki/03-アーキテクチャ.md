# ğŸ—ï¸ 3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## æ§‹æˆæ–¹é‡
- MVUï¼ˆModel-View-Updateï¼‰ã‚’åŸºç›¤ã«ã€Controller/Service/Repository ã‚’è¿½åŠ ã—ãŸæ§‹æˆ
- View ãŒ UIEvent ã‚’ç™ºè¡Œã—ã€Controller ãŒ Action ã«å¤‰æ›ã—ã¦ Update ã‚’å®Ÿè¡Œ
- Update ã¯ Model æ›´æ–°ã¨å‰¯ä½œç”¨ï¼ˆEffectï¼‰ã‚’è¿”ã—ã€Controller ãŒå®Ÿè¡Œ

## ãƒ¬ã‚¤ãƒ¤æ¦‚è¦
| ãƒ¬ã‚¤ãƒ¤ | å½¹å‰² | ä»£è¡¨ãƒ•ã‚¡ã‚¤ãƒ« |
| --- | --- | --- |
| View | DOM æç”»ã¨ UIEvent ç™ºè¡Œ | `src/app/views/*` |
| Controller | UIEvent â†’ Action å¤‰æ› / Effect å®Ÿè¡Œ | `src/app/controllers/controller.ts` |
| Update | Model æ›´æ–° / Effect ç”Ÿæˆ | `src/app/updates/update.ts` |
| Service | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å‡¦ç† | `src/app/services/*` |
| Repository | æ°¸ç¶šåŒ–ã‚¢ã‚¯ã‚»ã‚¹ | `src/app/repositories/*` |
| Storage | localStorage ä¿æŒ | `src/app/storages/index.ts` |

## å‡¦ç†ãƒ•ãƒ­ãƒ¼
```mermaid
flowchart TD
  View -->|UIEvent| Controller
  Controller -->|Action| Update
  Update -->|Model| View
  Update -->|Effect| Service
  Service --> Repository
  Repository --> IndexedDB
  Service --> Storage[localStorage]
```

## é–¢é€£ãƒªãƒ³ã‚¯
- çŠ¶æ…‹å®šç¾©ã¯ [çŠ¶æ…‹ãƒ¢ãƒ‡ãƒ«ã¨DTO](./05-çŠ¶æ…‹ãƒ¢ãƒ‡ãƒ«ã¨DTO.md) ã‚’å‚ç…§
- æ°¸ç¶šåŒ–ã®è©³ç´°ã¯ [æ°¸ç¶šåŒ–ã¨ãƒªãƒã‚¸ãƒˆãƒª](./06-æ°¸ç¶šåŒ–ã¨ãƒªãƒã‚¸ãƒˆãƒª.md) ã‚’å‚ç…§

## ğŸ” å‚ç…§ã‚³ãƒ¼ãƒ‰
å‚ç…§: `src/app/controllers/controller.ts:217-222`ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã¯èª¬æ˜ç”¨ã«è¿½è¨˜ï¼‰

```ts
// NOTE: update â†’ render â†’ effect ã®é †ã§å‡¦ç†ã™ã‚‹
private dispatch(action: ActionType): void {
  const { model, effects } = update(this.model, action);
  this.model = model;
  this.view.render(this.model);
  void this.execEffects(effects).catch(console.error);
}
```
