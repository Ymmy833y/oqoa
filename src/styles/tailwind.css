@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  [data-auto-tailwind]{
    --tw-font-sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans",
    "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    --tw-font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    /* コード用に CJK も考慮した等幅スタック（環境にあれば先頭を使用） */
    --tw-font-code: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
                    "M PLUS 1 Code", "Source Han Code JP", "Noto Sans Mono CJK JP",
                    "PlemolJP Console", "Cica", "UDEV Gothic 35NF", "Migu 1M",
                    "Ricty Diminished", "Noto Mono", "Courier New", monospace;

    --tw-text:#111827; --tw-muted:#374151; --tw-subtle:#6b7280; --tw-border:#e5e7eb; --tw-soft:#f3f4f6;
    --tw-link:#2563eb; --tw-link-hover:#1d4ed8; --tw-code-bg:#0f172a; --tw-code-text:#e5e7eb;

    /* inline code（インライン）用の配色（ライト） */
    --tw-code-inline-bg:#f1f5f9;  /* slate-100 */
    --tw-code-inline-fg:#111827;  /* gray-900  */

    --tw-radius:.5rem; --tw-leading:1.75; --tw-max-w-prose:72ch;
    color:var(--tw-muted);
  }

  @media (prefers-color-scheme: dark){
    [data-auto-tailwind]{
      --tw-text:#e5e7eb; --tw-muted:#cbd5e1; --tw-subtle:#94a3b8; --tw-border:#334155; --tw-soft:#0b1220;
      --tw-link:#60a5fa; --tw-link-hover:#3b82f6; --tw-code-bg:#0b1220; --tw-code-text:#e5e7eb;

      /* inline code（インライン）用の配色（ダーク） */
      --tw-code-inline-bg:#0b1220;
      --tw-code-inline-fg:#e5e7eb;
    }
    [data-auto-tailwind] :where(tr:nth-child(even) td):not([class]){ background:#0f172a; }
  }

  /* Tailwind の darkMode:'class' にも対応 */
  .dark [data-auto-tailwind]{
    --tw-code-inline-bg:#0b1220;
    --tw-code-inline-fg:#e5e7eb;
  }

  /* 文章系（classが付いていない素の要素のみ） */
  [data-auto-tailwind] :where(p, ul, ol, pre, blockquote, table, hr, figure):not([class]){
    margin-block: 1em;
  }
  [data-auto-tailwind] :where(p, li):not([class]){
    font-family: var(--tw-font-sans);
    line-height: var(--tw-leading);
    overflow-wrap: anywhere;
  }

  [data-auto-tailwind] :where(strong):not([class]){
    color: var(--tw-muted);
  }

  /* 見出し */
  [data-auto-tailwind] :where(h1,h2,h3,h4,h5,h6):not([class]){
    color: var(--tw-text);
    line-height: 1.25;
    font-weight: 700;
    margin-top: 1.6em;
    margin-bottom: .8em;
  }
  [data-auto-tailwind] :where(h1):not([class]){ font-size:1.875rem; } /* text-3xl */
  [data-auto-tailwind] :where(h2):not([class]){ font-size:1.5rem;   } /* text-2xl */
  [data-auto-tailwind] :where(h3):not([class]){ font-size:1.25rem;  } /* text-xl  */
  [data-auto-tailwind] :where(h4):not([class]){ font-size:1.125rem; } /* text-lg  */
  [data-auto-tailwind] :where(h5,h6):not([class]){ font-size:1rem; }

  /* リンク */
  [data-auto-tailwind] :where(a):not([class]){
    color: var(--tw-link);
    text-decoration: underline;
    text-underline-offset: .2em;
  }
  [data-auto-tailwind] :where(a):not([class]):hover{
    color: var(--tw-link-hover);
    text-decoration-thickness: 2px;
  }

  /* リスト */
  [data-auto-tailwind] :where(ul,ol):not([class]){ padding-left: 1.25rem; }
  [data-auto-tailwind] :where(ul):not([class]){ list-style: disc; }
  [data-auto-tailwind] :where(ol):not([class]){ list-style: decimal; }
  [data-auto-tailwind] :where(li ul, li ol):not([class]){ margin-block: .5em; }

  /* 水平線 */
  [data-auto-tailwind] :where(hr):not([class]){
    border: 0; border-top: 1px solid var(--tw-border);
    margin: 2rem 0;
  }

  /* 引用 */
  [data-auto-tailwind] :where(blockquote):not([class]){
    border-left: 4px solid var(--tw-border);
    padding-left: 1rem;
    color: var(--tw-subtle);
    font-style: italic;
    background: linear-gradient(to right, var(--tw-soft), transparent);
  }

  /* 画像 */
  [data-auto-tailwind] :where(img):not([class]){
    max-width: 100%;
    height: auto;
    border-radius: .375rem;
  }

  /* コード（インライン） — 等幅＆ダーク対応 */
  [data-auto-tailwind] :where(code):not([class]){
    font-family: var(--tw-font-code);
    /* 合字無効・数値桁揃え・カーニング無効で見た目を安定 */
    font-variant-ligatures: none;
    font-feature-settings: "liga" 0, "calt" 0, "kern" 0;
    font-kerning: none;
    font-variant-numeric: tabular-nums slashed-zero;

    background: var(--tw-code-inline-bg);
    color: var(--tw-code-inline-fg);
    padding: .15rem .35rem;
    border-radius: .375rem;
    font-size: .9em;
  }

  /* コードブロック（pre） — 等幅＆横スクロール */
  [data-auto-tailwind] :where(pre):not([class]){
    font-family: var(--tw-font-code);
    font-variant-ligatures: none;
    font-feature-settings: "liga" 0, "calt" 0, "kern" 0;
    font-kerning: none;
    font-variant-numeric: tabular-nums slashed-zero;

    background: var(--tw-code-bg);
    color: var(--tw-code-text);
    padding: 1rem;
    border-radius: var(--tw-radius);
    line-height: 1.6;

    width: 100%;
    max-width: 100%;
    overflow-x: auto;          /* 横スクロール */
    overflow-y: hidden;        /* 縦は基本不要 */
    -webkit-overflow-scrolling: touch;
    tab-size: 2; -moz-tab-size: 2;
  }

  /* pre内の OL（行番号用）— prettyprint の有無どちらにも対応（スリム版） */
  [data-auto-tailwind] :where(pre):not([class]) ol:not([class]),
  [data-auto-tailwind] pre.prettyprint ol.linenums,
  [data-auto-tailwind] .prettyprint .linenums{
    margin: 0;
    padding-left: 2rem;        /* ← 以前 2.75rem → スリム化 */
    counter-reset: line;
  }
  [data-auto-tailwind] :where(pre):not([class]) ol:not([class]) > li,
  [data-auto-tailwind] pre.prettyprint ol.linenums > li,
  [data-auto-tailwind] .prettyprint .linenums > li{
    list-style: none;
    position: relative;
    padding-left: .5rem;       /* ← 以前 .75rem → 少しタイトに */
    white-space: pre;          /* 空白やタブを保持して表示 */
  }
  [data-auto-tailwind] :where(pre):not([class]) ol:not([class]) > li::before,
  [data-auto-tailwind] pre.prettyprint ol.linenums > li::before,
  [data-auto-tailwind] .prettyprint .linenums > li::before{
    counter-increment: line;
    content: counter(line);
    position: absolute;
    left: -2rem;               /* ← 以前 -2.5rem */
    width: 1.5rem;             /* ← 以前 2rem → 行番号カラムを狭く */
    text-align: right;
    color: #94a3b8;           /* slate-400 */
    user-select: none;
  }
  /* 行にホバーしたときの視認性向上（任意） */
  [data-auto-tailwind] :where(pre):not([class]) ol > li:hover::before,
  [data-auto-tailwind] .prettyprint .linenums > li:hover::before{
    color: #cbd5e1;           /* slate-300 */
  }

  /* pre内のcodeは二重背景を避けつつ親を継承 */
  [data-auto-tailwind] pre:not([class]) code:not([class]){
    font-family: inherit;
    background: transparent;
    color: inherit;
    padding: 0;
    font-size: .95em;
  }

  /* テーブル */
  [data-auto-tailwind] :where(table):not([class]){
    width: 100%;
    border-collapse: collapse;
    font-family: var(--tw-font-sans);
    overflow: hidden;
    border: 1px solid var(--tw-border);
    border-radius: .5rem;
  }
  [data-auto-tailwind] :where(th, td):not([class]){
    padding: .5rem .75rem;
    border-top: 1px solid var(--tw-border);
    border-right: 1px solid var(--tw-border);
  }
  [data-auto-tailwind] :where(th):not([class]){
    background: var(--tw-soft);
    text-align: left;
    color: var(--tw-text);
    font-weight: 600;
  }
  [data-auto-tailwind] :where(tr:nth-child(even) td):not([class]){
    background: #fafafa;
  }

  /* kbd */
  [data-auto-tailwind] :where(kbd):not([class]){
    font-family: var(--tw-font-mono);
    font-size: .85em;
    background: var(--tw-soft);
    border: 1px solid var(--tw-border);
    border-bottom-width: 2px;
    padding: .1rem .35rem;
    border-radius: .375rem;
  }

  /* details/summary */
  [data-auto-tailwind] :where(details):not([class]){
    background: var(--tw-soft);
    border: 1px solid var(--tw-border);
    border-radius: .5rem;
    padding: .5rem .75rem;
  }
  [data-auto-tailwind] :where(summary):not([class]){
    cursor: pointer;
    font-weight: 600;
    color: var(--tw-text);
  }

  /* mark（ハイライト） */
  [data-auto-tailwind] :where(mark):not([class]){
    background: #fef08a; /* yellow-200 */
    padding: .05rem .25rem;
    border-radius: .2rem;
  }

  /* 先頭・末尾の余白を詰める */
  [data-auto-tailwind] > :first-child{ margin-top: 0 !important; }
  [data-auto-tailwind] > :last-child{  margin-bottom: 0 !important; }

  /* 例に出てきた prettyprint に軽く対応（色は控えめ） */
  [data-auto-tailwind] pre.prettyprint,
  [data-auto-tailwind] .prettyprint{
    background: var(--tw-code-bg);
    color: var(--tw-code-text);
    border-radius: var(--tw-radius);
    overflow: auto;
    padding: 1rem;
  }
}
